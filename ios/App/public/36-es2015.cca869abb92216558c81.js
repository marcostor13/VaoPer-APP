(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{hg08:function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPageModule",(function(){return D}));var n=i("ofXK"),s=i("3Pt+"),c=i("TEn/"),o=i("tyNb"),r=i("mrSG"),a=i("XNiG"),l=i("wd/R"),d=i("fXoL"),h=i("I/3d"),g=i("H+bZ"),b=i("b6Qw");const u=["scrollMe"],f=["scrollMe2"];function p(t,e){if(1&t&&(d.Wb(0,"h6",21),d.Jc(1),d.Vb()),2&t){const t=d.ic().$implicit,e=d.ic();d.Db(1),d.Kc(e.dataUsers[t.receptor].name||"")}}function m(t,e){if(1&t&&(d.Wb(0,"span"),d.Jc(1),d.Vb()),2&t){const t=d.ic().$implicit,e=d.ic();d.Db(1),d.Kc(e.getNotification(t.id))}}const v=function(t){return{"bg-color7":t}};function C(t,e){if(1&t){const t=d.Xb();d.Wb(0,"div",14),d.ec("click",(function(){d.zc(t);const i=e.$implicit;return d.ic().getMessages(i.receptor)})),d.Wb(1,"div",15),d.Sb(2,"img",16),d.Vb(),d.Wb(3,"div",17),d.Hc(4,p,2,1,"h6",18),d.Hc(5,m,2,1,"span",19),d.Wb(6,"p",20),d.Jc(7),d.Vb(),d.Vb(),d.Vb()}if(2&t){const t=e.$implicit,i=d.ic();d.oc("ngClass",d.sc(5,v,t.receptor==i.currentReceptor)),d.Db(2),d.oc("src",i.dataUsers[t.receptor]&&i.dataUsers[t.receptor].imageprofile?i.dataUsers[t.receptor].imageprofile:"/assets/img/partials/user.svg",d.Bc),d.Db(2),d.oc("ngIf",i.dataUsers[t.receptor]),d.Db(1),d.oc("ngIf",0!=i.getNotification(t.id)),d.Db(2),d.Kc(i.formatDate(t.date))}}function M(t,e){if(1&t&&(d.Wb(0,"h6",21),d.Jc(1),d.Vb()),2&t){const t=d.ic().$implicit,e=d.ic(2);d.Db(1),d.Kc(e.dataUsers[t.receptor].name||"")}}function w(t,e){if(1&t&&(d.Wb(0,"span"),d.Jc(1),d.Vb()),2&t){const t=d.ic().$implicit,e=d.ic(2);d.Db(1),d.Kc(e.getNotification(t.id))}}function x(t,e){if(1&t){const t=d.Xb();d.Wb(0,"div",24),d.ec("click",(function(){d.zc(t);const i=e.$implicit;return d.ic(2).getMessages(i.receptor)})),d.Wb(1,"div",15),d.Sb(2,"img",16),d.Vb(),d.Wb(3,"div",17),d.Hc(4,M,2,1,"h6",18),d.Hc(5,w,2,1,"span",19),d.Wb(6,"p",20),d.Jc(7),d.Vb(),d.Vb(),d.Vb()}if(2&t){const t=e.$implicit,i=d.ic(2);d.oc("ngClass",d.sc(5,v,t.receptor==i.currentReceptor)),d.Db(2),d.oc("src",i.dataUsers[t.receptor]&&i.dataUsers[t.receptor].imageprofile?i.dataUsers[t.receptor].imageprofile:"/assets/img/partials/user.svg",d.Bc),d.Db(2),d.oc("ngIf",i.dataUsers[t.receptor]),d.Db(1),d.oc("ngIf",0!=i.getNotification(t.id)),d.Db(2),d.Kc(i.formatDate(t.date))}}function _(t,e){if(1&t&&(d.Wb(0,"div",22),d.Hc(1,x,8,7,"div",23),d.jc(2,"async"),d.Vb()),2&t){const t=d.ic();d.Db(1),d.oc("ngForOf",d.kc(2,1,t.chats))}}const O=function(t,e){return{"justify-content-end":t,"justify-content-start":e}},y=function(t,e){return{"bg-color1":t,"bg-color7":e}};function V(t,e){if(1&t&&(d.Wb(0,"div",25),d.Wb(1,"div",26),d.Wb(2,"div",27),d.Wb(3,"p",28),d.Jc(4),d.Vb(),d.Vb(),d.Wb(5,"div",27),d.Wb(6,"span",29),d.Jc(7),d.Vb(),d.Vb(),d.Vb(),d.Vb()),2&t){const t=e.$implicit,i=d.ic();d.oc("ngClass",d.tc(4,O,i.user.user.id==t.id,i.user.user.id!=t.id)),d.Db(1),d.oc("ngClass",d.tc(7,y,i.user.user.id==t.id,i.user.user.id!=t.id)),d.Db(3),d.Kc(t.message),d.Db(3),d.Kc(i.formatDate(t.date))}}function W(t,e){if(1&t&&(d.Wb(0,"div",25),d.Wb(1,"div",26),d.Wb(2,"div",27),d.Wb(3,"p",28),d.Jc(4),d.Vb(),d.Vb(),d.Wb(5,"div",27),d.Wb(6,"span",29),d.Jc(7),d.Vb(),d.Vb(),d.Vb(),d.Vb()),2&t){const t=e.$implicit,i=d.ic(2);d.oc("ngClass",d.tc(4,O,i.user.user.id==t.id,i.user.user.id!=t.id)),d.Db(1),d.oc("ngClass",d.tc(7,y,i.user.user.id==t.id,i.user.user.id!=t.id)),d.Db(3),d.Kc(t.message),d.Db(3),d.Kc(i.formatDate(t.date))}}function P(t,e){if(1&t){const t=d.Xb();d.Wb(0,"div",30),d.Wb(1,"div",31),d.Wb(2,"button",32),d.ec("click",(function(){return d.zc(t),d.ic().listChatActive=!0})),d.Jc(3,"VOLVER A CHATS"),d.Vb(),d.Vb(),d.Wb(4,"div",33,34),d.Hc(6,W,8,10,"div",7),d.jc(7,"async"),d.Vb(),d.Wb(8,"div",35),d.Wb(9,"div",36),d.Wb(10,"input",10),d.ec("ngModelChange",(function(e){return d.zc(t),d.ic().textMessage=e})),d.Vb(),d.Vb(),d.Wb(11,"div",37),d.Wb(12,"button",38),d.ec("keyup.enter",(function(){return d.zc(t),d.ic().sendMessage()}))("click",(function(){return d.zc(t),d.ic().sendMessage()})),d.hc(),d.Wb(13,"svg",39),d.Wb(14,"g",40),d.Sb(15,"path",41),d.Wb(16,"g",42),d.Sb(17,"path",43),d.Vb(),d.Vb(),d.Vb(),d.Vb(),d.Vb(),d.Vb(),d.Vb()}if(2&t){const t=d.ic();d.Db(6),d.oc("ngForOf",d.kc(7,2,t.messages)),d.Db(4),d.oc("ngModel",t.textMessage)}}const k=[{path:"",component:(()=>{class t{constructor(t,e,i,n,s){this.firestore=t,this.api=e,this.cookie=i,this.router=n,this.route=s,this.dataUsers=[],this.textMessage="",this.listChatActive=!0,this.noti=[],this.eventsSubject=new a.a,this.validateSession(),this.id=this.route.snapshot.paramMap.get("id")?this.route.snapshot.paramMap.get("id"):"0",t.collection("chatnotification_"+this.user.user.id).valueChanges().subscribe(t=>{this.api.c("Notifications",t),this.noti=t}),this.chats=t.collection("chatlist_"+this.user.user.id,t=>t.orderBy("date","desc")).valueChanges(),this.chats.forEach(t=>{this.api.c("Chats",t),t.forEach(t=>{this.api.c("Chats item ",t),this.getNameReceptop(t.receptor)})}),l.locale("es")}invertChatid(t){let e=t.split("_");return e[0]+"_"+e[2]+"_"+e[1]}getNotification(t){var e=0;for(let i=0;i<this.noti.length;i++)this.noti[i].id==this.invertChatid(t)&&e++;return e}ngAfterViewInit(){this.scrollContainer=!!this.scrollMe&&this.scrollMe.nativeElement,this.scrollContainer2=!!this.scrollMe2&&this.scrollMe2.nativeElement}ngOnInit(){0!=this.id&&setTimeout(()=>{this.getMessages(this.id)},2e3)}validateSession(){localStorage.getItem("ud")&&""!=localStorage.getItem("ud")?(this.user=JSON.parse(localStorage.getItem("ud")),this.api.c("user",this.user)):this.router.navigate(["/login"])}formatDate(t){return l(t.toDate()).calendar()}getNameReceptop(t){this.api.api({service:"get-data-user-by-id",token:this.user.token,userid:t}).subscribe(e=>{this.api.c("getNameReceptop",e),this.dataUsers[t]=e,this.dataUsers=this.dataUsers,this.api.c("dataUsers",this.dataUsers)},t=>{this.api.c("getProducts error",t)})}getMessages(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){var e=this;this.listChatActive=!1;let i="chat_"+this.user.user.id+"_"+t,n="chat_"+t+"_"+this.user.user.id,s="chatnotification_"+this.user.user.id;this.firestore.collection(i).get().subscribe(c=>Object(r.__awaiter)(this,void 0,void 0,(function*(){this.firestore.collection(s).get().subscribe(e=>{e.docs.forEach(e=>Object(r.__awaiter)(this,void 0,void 0,(function*(){this.firestore.collection(s).doc(e.id).get().subscribe(e=>Object(r.__awaiter)(this,void 0,void 0,(function*(){e.data().id=="chat_"+t+"_"+this.user.user.id&&(yield this.firestore.collection(s).doc(e.id).delete())})))})))}),this.messages=0!=c.size?this.firestore.collection(i,t=>t.orderBy("date")).valueChanges():this.firestore.collection(n,t=>t.orderBy("date")).valueChanges(),this.messages.subscribe(t=>{setTimeout(()=>{e.scrollToBottom()},2e3)})}))),this.currentReceptor=t}))}sendMessage(){this.api.sendMessage({message:this.textMessage,useridOri:this.user.user.id,useridDes:this.currentReceptor}),this.textMessage="",this.scrollToBottom()}scrollToBottom(){this.scrollContainer=!!this.scrollMe&&this.scrollMe.nativeElement,this.scrollContainer2=!!this.scrollMe2&&this.scrollMe2.nativeElement,this.scrollContainer&&this.scrollContainer.scroll({top:this.scrollContainer.scrollHeight,left:0,behavior:"smooth"}),this.scrollContainer2&&this.scrollContainer2.scroll({top:this.scrollContainer2.scrollHeight,left:0,behavior:"smooth"})}}return t.\u0275fac=function(e){return new(e||t)(d.Rb(h.a),d.Rb(g.a),d.Rb(b.a),d.Rb(o.j),d.Rb(o.a))},t.\u0275cmp=d.Lb({type:t,selectors:[["app-chat"]],viewQuery:function(t,e){var i;1&t&&(d.Oc(u,!0),d.Oc(f,!0)),2&t&&(d.vc(i=d.fc())&&(e.scrollMe=i.first),d.vc(i=d.fc())&&(e.scrollMe2=i.first))},decls:18,vars:9,consts:[[1,"row","m-0","justify-content-center","align-items-start","vw-100"],[1,"d-none","d-xl-flex","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","align-items-start"],["class","itemChatList cursor  rounded p-2 pl-3 pr-3 mt-3 row m-0 justify-content-center align-items-center",3,"ngClass","click",4,"ngFor","ngForOf"],["class","d-flex d-xl-none chats bg-color2 pl-3 pr-3 overflow-auto pb-3 col-12 align-items-start flex-column justify-content-start",4,"ngIf"],[1,"d-none","d-xl-flex","messages","flex-1","overflow-hidden","flex-column","align-items-center","justify-content-between"],[1,"display-chat","overflow-auto","w-100","align-items-center"],["scrollMe",""],["class","row m-0 col-12 mt-3 mb-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-chat","col-12","row","m-0","justify-content-center"],[1,"col-10","mt-3"],["type","text",1,"pl-4","col-12","rounded-pill","shadow-lg",3,"ngModel","ngModelChange"],[1,"flex-1","mt-3"],[1,"btn1","rounded-pill",3,"keyup.enter","click"],["class","d-flex d-xl-none messages flex-1 overflow-hidden d-flex flex-column align-items-center justify-content-between",4,"ngIf"],[1,"itemChatList","cursor","rounded","p-2","pl-3","pr-3","mt-3","row","m-0","justify-content-center","align-items-center",3,"ngClass","click"],[1,"col-2","row","m-0","justify-content-center","align-items-center"],["width","40","alt","",3,"src"],[1,"chatlistitem","flex-1","pl-3"],["class","f-11 font-700",4,"ngIf"],[4,"ngIf"],[1,"f-10","p-0","m-0"],[1,"f-11","font-700"],[1,"d-flex","d-xl-none","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","col-12","align-items-start","flex-column","justify-content-start"],["class","w-100 itemChatList cursor  rounded p-2 pl-3 pr-3 mt-3 row m-0 justify-content-center align-items-center",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"w-100","itemChatList","cursor","rounded","p-2","pl-3","pr-3","mt-3","row","m-0","justify-content-center","align-items-center",3,"ngClass","click"],[1,"row","m-0","col-12","mt-3","mb-3",3,"ngClass"],[1,"parraf","p-2","pr-3","pl-3","rounded","shadow",3,"ngClass"],[1,"row","justify-content-end","m-0"],[1,"f-11"],[1,"f-10"],[1,"d-flex","d-xl-none","messages","flex-1","overflow-hidden","d-flex","flex-column","align-items-center","justify-content-between"],[1,"col-12","bg-color2","row","m-0","justify-content-center","p-4"],[1,"btn2","pt-2","pb-2","pl-5","pr-5","f-17","font-900",3,"click"],[1,"display-chat2","overflow-auto","w-100","align-items-center"],["scrollMe2",""],[1,"input-chat2","col-12","row","m-0","justify-content-center"],[1,"flex-1","mt-3","p-0"],[1,"mt-3","p-0"],[1,"btnSend","bg-color2","pl-2","pr-2","rounded-pill","row","m-0","justify-content-center","align-items-center","border-0","ml-2",3,"keyup.enter","click"],["xmlns","http://www.w3.org/2000/svg","x","0px","y","0px","width","30","height","30","viewBox","0 0 172 172",2,"fill","#000000"],["fill","none","fill-rule","nonzero","stroke","none","stroke-width","1","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","10","stroke-dasharray","","stroke-dashoffset","0","font-family","none","font-weight","none","font-size","none","text-anchor","none",2,"mix-blend-mode","normal"],["d","M0,172v-172h172v172z","fill","none"],["fill","#ffffff"],["d","M149.06667,17.2c-0.55025,0.00377 -1.09709,0.08674 -1.6237,0.24635c-0.15501,0.04207 -0.30818,0.09064 -0.45911,0.14557l-126.05495,40.08854v0.02239c-2.23962,0.83573 -3.72568,2.97333 -3.72891,5.3638c0.00425,2.00222 1.05271,3.85719 2.76589,4.89349l38.30807,30.39114l75.73151,-60.35677l-60.35677,75.73151l30.36875,38.28567c1.0349,1.7286 2.90117,2.78714 4.91589,2.78828c2.39047,-0.00322 4.52807,-1.48928 5.3638,-3.72891h0.02239l40.12214,-126.16692c0.041,-0.11449 0.07834,-0.23027 0.11198,-0.34714c0.15961,-0.52661 0.24258,-1.07345 0.24636,-1.6237c0,-3.16643 -2.5669,-5.73333 -5.73333,-5.73333z"]],template:function(t,e){1&t&&(d.Wb(0,"ion-content"),d.Wb(1,"div",0),d.Wb(2,"div",1),d.Hc(3,C,8,7,"div",2),d.jc(4,"async"),d.Vb(),d.Hc(5,_,3,3,"div",3),d.Wb(6,"div",4),d.Wb(7,"div",5,6),d.Hc(9,V,8,10,"div",7),d.jc(10,"async"),d.Vb(),d.Wb(11,"div",8),d.Wb(12,"div",9),d.Wb(13,"input",10),d.ec("ngModelChange",(function(t){return e.textMessage=t})),d.Vb(),d.Vb(),d.Wb(14,"div",11),d.Wb(15,"button",12),d.ec("keyup.enter",(function(){return e.sendMessage()}))("click",(function(){return e.sendMessage()})),d.Jc(16,"Enviar"),d.Vb(),d.Vb(),d.Vb(),d.Vb(),d.Hc(17,P,18,4,"div",13),d.Vb(),d.Vb()),2&t&&(d.Db(3),d.oc("ngForOf",d.kc(4,5,e.chats)),d.Db(2),d.oc("ngIf",e.listChatActive),d.Db(4),d.oc("ngForOf",d.kc(10,7,e.messages)),d.Db(4),d.oc("ngModel",e.textMessage),d.Db(4),d.oc("ngIf",!e.listChatActive))},directives:[c.d,n.k,n.l,s.b,s.f,s.g,n.j],pipes:[n.b],styles:['.chats[_ngcontent-%COMP%]{height:93.5vh}.itemChatList[_ngcontent-%COMP%]{background-color:#fff}.bg-color7[_ngcontent-%COMP%]{background-color:#d1d1d1!important}.messages[_ngcontent-%COMP%]{position:relative}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]{min-height:80vh;max-height:80vh}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]{min-height:84vh;max-height:84vh;padding-bottom:120px}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]{min-height:15vh}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   .btn1[_ngcontent-%COMP%]{min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]{position:absolute;bottom:4em}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   .btnSend[_ngcontent-%COMP%]{min-height:50px;min-width:50px;max-width:50px}.listItem[_ngcontent-%COMP%]{background-color:"gray"!important}.chatlistitem[_ngcontent-%COMP%]{position:relative}.chatlistitem[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;min-width:18px;max-width:18px;min-height:18px;max-height:18px;background-color:red;color:#fff;z-index:2;top:0;right:0;border-radius:50%;display:flex;justify-content:center;align-items:center}']}),t})()}];let j=(()=>{class t{}return t.\u0275mod=d.Pb({type:t}),t.\u0275inj=d.Ob({factory:function(e){return new(e||t)},imports:[[o.l.forChild(k)],o.l]}),t})(),D=(()=>{class t{}return t.\u0275mod=d.Pb({type:t}),t.\u0275inj=d.Ob({factory:function(e){return new(e||t)},imports:[[n.c,s.c,c.o,j]]}),t})()}}]);