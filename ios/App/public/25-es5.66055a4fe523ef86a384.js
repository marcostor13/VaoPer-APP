function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{rbwS:function(t,e,n){"use strict";n.r(e),n.d(e,"ChatProviderPageModule",(function(){return I}));var i=n("ofXK"),c=n("3Pt+"),s=n("TEn/"),o=n("tyNb"),r=n("mrSG"),a=n("wd/R"),l=n("fXoL"),u=n("I/3d"),f=n("H+bZ"),d=n("b6Qw"),g=["scrollMe"],b=["scrollMe2"];function h(t,e){if(1&t&&(l.Wb(0,"h6",21),l.Jc(1),l.Vb()),2&t){var n=l.ic().$implicit,i=l.ic();l.Db(1),l.Kc(i.dataUsers[n.receptor].name||"")}}function p(t,e){if(1&t&&(l.Wb(0,"span"),l.Jc(1),l.Vb()),2&t){var n=l.ic().$implicit,i=l.ic();l.Db(1),l.Kc(i.getNotification(n.id))}}var m=function(t){return{"bg-color7":t}};function v(t,e){if(1&t){var n=l.Xb();l.Wb(0,"div",14),l.ec("click",(function(){l.zc(n);var t=e.$implicit;return l.ic().getMessages(t.receptor)})),l.Wb(1,"div",15),l.Sb(2,"img",16),l.Vb(),l.Wb(3,"div",17),l.Hc(4,h,2,1,"h6",18),l.Hc(5,p,2,1,"span",19),l.Wb(6,"p",20),l.Jc(7),l.Vb(),l.Vb(),l.Vb()}if(2&t){var i=e.$implicit,c=l.ic();l.oc("ngClass",l.sc(5,m,i.receptor==c.currentReceptor)),l.Db(2),l.oc("src",c.dataUsers[i.receptor]&&c.dataUsers[i.receptor].imageprofile?c.dataUsers[i.receptor].imageprofile:"/assets/img/partials/user.svg",l.Bc),l.Db(2),l.oc("ngIf",c.dataUsers[i.receptor]),l.Db(1),l.oc("ngIf",0!=c.getNotification(i.id)),l.Db(2),l.Kc(c.formatDate(i.date))}}function C(t,e){if(1&t&&(l.Wb(0,"h6",21),l.Jc(1),l.Vb()),2&t){var n=l.ic().$implicit,i=l.ic(2);l.Db(1),l.Kc(i.dataUsers[n.receptor].name||"")}}function w(t,e){if(1&t&&(l.Wb(0,"span"),l.Jc(1),l.Vb()),2&t){var n=l.ic().$implicit,i=l.ic(2);l.Db(1),l.Kc(i.getNotification(n.id))}}function M(t,e){if(1&t){var n=l.Xb();l.Wb(0,"div",14),l.ec("click",(function(){l.zc(n);var t=e.$implicit;return l.ic(2).getMessages(t.receptor)})),l.Wb(1,"div",15),l.Sb(2,"img",16),l.Vb(),l.Wb(3,"div",17),l.Hc(4,C,2,1,"h6",18),l.Hc(5,w,2,1,"span",19),l.Wb(6,"p",20),l.Jc(7),l.Vb(),l.Vb(),l.Vb()}if(2&t){var i=e.$implicit,c=l.ic(2);l.oc("ngClass",l.sc(5,m,i.receptor==c.currentReceptor)),l.Db(2),l.oc("src",c.dataUsers[i.receptor]&&c.dataUsers[i.receptor].imageprofile?c.dataUsers[i.receptor].imageprofile:"/assets/img/partials/user.svg",l.Bc),l.Db(2),l.oc("ngIf",c.dataUsers[i.receptor]),l.Db(1),l.oc("ngIf",0!=c.getNotification(i.id)),l.Db(2),l.Kc(c.formatDate(i.date))}}function x(t,e){if(1&t&&(l.Wb(0,"div",22),l.Hc(1,M,8,7,"div",2),l.jc(2,"async"),l.Vb()),2&t){var n=l.ic();l.Db(1),l.oc("ngForOf",l.kc(2,1,n.chats))}}var y=function(t,e){return{"justify-content-end":t,"justify-content-start":e}},_=function(t,e){return{"bg-color1":t,"bg-color7":e}};function k(t,e){if(1&t&&(l.Wb(0,"div",23),l.Wb(1,"div",24),l.Wb(2,"div",25),l.Wb(3,"p",26),l.Jc(4),l.Vb(),l.Vb(),l.Wb(5,"div",25),l.Wb(6,"span",27),l.Jc(7),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&t){var n=e.$implicit,i=l.ic();l.oc("ngClass",l.tc(4,y,i.user.user.id==n.id,i.user.user.id!=n.id)),l.Db(1),l.oc("ngClass",l.tc(7,_,i.user.user.id==n.id,i.user.user.id!=n.id)),l.Db(3),l.Kc(n.message),l.Db(3),l.Kc(i.formatDate(n.date))}}function O(t,e){if(1&t&&(l.Wb(0,"div",43),l.Wb(1,"div",24),l.Wb(2,"div",25),l.Wb(3,"p",26),l.Jc(4),l.Vb(),l.Vb(),l.Wb(5,"div",25),l.Wb(6,"span",27),l.Jc(7),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&t){var n=e.$implicit,i=l.ic(2);l.oc("ngClass",l.tc(4,y,i.user.user.id==n.id,i.user.user.id!=n.id)),l.Db(1),l.oc("ngClass",l.tc(7,_,i.user.user.id==n.id,i.user.user.id!=n.id)),l.Db(3),l.Kc(n.message),l.Db(3),l.Kc(i.formatDate(n.date))}}function V(t,e){if(1&t){var n=l.Xb();l.Wb(0,"div",28),l.Wb(1,"div",29),l.Wb(2,"button",30),l.ec("click",(function(){return l.zc(n),l.ic().listChatActive=!0})),l.Jc(3,"VOLVER A CHATS"),l.Vb(),l.Vb(),l.Wb(4,"div",31,32),l.Hc(6,O,8,10,"div",33),l.jc(7,"async"),l.Vb(),l.Wb(8,"div",34),l.Wb(9,"div",35),l.Wb(10,"input",10),l.ec("ngModelChange",(function(t){return l.zc(n),l.ic().textMessage=t})),l.Vb(),l.Vb(),l.Wb(11,"div",36),l.Wb(12,"button",37),l.ec("keyup.enter",(function(){return l.zc(n),l.ic().sendMessage()}))("click",(function(){return l.zc(n),l.ic().sendMessage()})),l.hc(),l.Wb(13,"svg",38),l.Wb(14,"g",39),l.Sb(15,"path",40),l.Wb(16,"g",41),l.Sb(17,"path",42),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb()}if(2&t){var i=l.ic();l.Db(6),l.oc("ngForOf",l.kc(7,2,i.messages)),l.Db(4),l.oc("ngModel",i.textMessage)}}var W,P,D,j=[{path:"",component:(W=function(){function t(e,n,i,c,s){var o=this;_classCallCheck(this,t),this.firestore=e,this.api=n,this.cookie=i,this.router=c,this.route=s,this.dataUsers=[],this.textMessage="",this.listChatActive=!0,this.noti=[],this.id=this.route.snapshot.paramMap.get("id"),this.validateSession(this.id),e.collection("chatnotification_"+this.user.user.id).valueChanges().subscribe((function(t){o.api.c("Notifications",t),o.noti=t})),this.chats=e.collection("chatlist_"+this.user.user.id,(function(t){return t.orderBy("date","desc")})).valueChanges(),this.chats.forEach((function(t){o.api.c("Chats",o.notifications),t.forEach((function(t){o.api.c("Chats item ",t),o.getNameReceptop(t.receptor)}))})),a.locale("es")}return _createClass(t,[{key:"getNotification",value:function(t){for(var e=0,n=0;n<this.noti.length;n++)this.noti[n].id==t&&e++;return e}},{key:"ngAfterViewInit",value:function(){this.scrollContainer=this.scrollMe?this.scrollMe.nativeElement:null,this.scrollContainer2=this.scrollMe2?this.scrollMe2.nativeElement:null}},{key:"ngOnInit",value:function(){0!=this.id&&this.getMessages(this.id)}},{key:"validateSession",value:function(t){localStorage.getItem("ud")&&""!=localStorage.getItem("ud")?this.user=JSON.parse(localStorage.getItem("ud")):this.router.navigate(["/login"])}},{key:"formatDate",value:function(t){return a(t.toDate()).calendar()}},{key:"getNameReceptop",value:function(t){var e=this;this.api.api({service:"get-data-user-by-id",token:this.user.token,userid:t}).subscribe((function(n){e.api.c("getNameReceptop",n),e.dataUsers[t]=n,e.dataUsers=e.dataUsers,e.api.c("dataUsers",e.dataUsers)}),(function(t){e.api.c("getProducts error",t)}))}},{key:"getMessages",value:function(t){return Object(r.__awaiter)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,c,s,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,this.listChatActive=!1,i="chat_"+this.user.user.id+"_"+t,c="chat_"+t+"_"+this.user.user.id,s="chatnotification_"+this.user.user.id,e.next=5,this.firestore.collection(i).get().subscribe((function(e){return Object(r.__awaiter)(o,void 0,void 0,regeneratorRuntime.mark((function o(){var a=this;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.firestore.collection(s).get().subscribe((function(e){e.docs.forEach((function(e){return Object(r.__awaiter)(a,void 0,void 0,regeneratorRuntime.mark((function n(){var i=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.firestore.collection(s).doc(e.id).get().subscribe((function(e){return Object(r.__awaiter)(i,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e.data().id=="chat_"+t+"_"+this.user.user.id,!n.t0){n.next=4;break}return n.next=4,this.firestore.collection(s).doc(e.id).delete();case 4:case"end":return n.stop()}}),n,this)})))}));case 1:case"end":return n.stop()}}),n,this)})))}))}));case 2:this.messages=0!=e.size?this.firestore.collection(i,(function(t){return t.orderBy("date")})).valueChanges():this.firestore.collection(c,(function(t){return t.orderBy("date")})).valueChanges(),this.messages.subscribe((function(t){setTimeout((function(){n.scrollToBottom()}),2e3)}));case 4:case"end":return o.stop()}}),o,this)})))}));case 5:this.currentReceptor=t;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"sendMessage",value:function(){this.api.sendMessage({message:this.textMessage,useridOri:this.user.user.id,useridDes:this.currentReceptor}),this.textMessage="",this.scrollToBottom()}},{key:"scrollToBottom",value:function(){this.scrollContainer=this.scrollMe.nativeElement,this.scrollContainer2=this.scrollMe2.nativeElement,this.scrollContainer.scroll({top:this.scrollContainer.scrollHeight,left:0,behavior:"smooth"}),this.scrollContainer2.scroll({top:this.scrollContainer2.scrollHeight,left:0,behavior:"smooth"})}}]),t}(),W.\u0275fac=function(t){return new(t||W)(l.Rb(u.a),l.Rb(f.a),l.Rb(d.a),l.Rb(o.j),l.Rb(o.a))},W.\u0275cmp=l.Lb({type:W,selectors:[["app-chat-provider"]],viewQuery:function(t,e){var n;1&t&&(l.Oc(g,!0),l.Oc(b,!0)),2&t&&(l.vc(n=l.fc())&&(e.scrollMe=n.first),l.vc(n=l.fc())&&(e.scrollMe2=n.first))},decls:18,vars:9,consts:[[1,"row","m-0","justify-content-center","align-items-start","vw-100"],[1,"d-none","d-xl-flex","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","align-items-start","flex-column","mt-2"],["class","w-100 itemChatList cursor  rounded p-2 pl-3 pr-3 mt-3 row m-0 justify-content-center align-items-center",3,"ngClass","click",4,"ngFor","ngForOf"],["class","d-flex d-xl-none chats bg-color2 pl-3 pr-3 overflow-auto pb-3 col-12 align-items-center flex-column justify-content-start",4,"ngIf"],[1,"d-none","d-xl-flex","messages","flex-1","overflow-hidden","flex-column","align-items-center","justify-content-between"],[1,"display-chat","overflow-auto","w-100","align-items-center"],["scrollMe",""],["class","row m-0 col-12 mt-3 mb-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-chat","col-12","row","m-0","justify-content-center"],[1,"col-10","mt-3"],["type","text",1,"pl-4","col-12","rounded-pill","shadow-lg",3,"ngModel","ngModelChange"],[1,"flex-1","mt-3"],[1,"btn1","rounded-pill",3,"keyup.enter","click"],["class","d-flex d-xl-none messages flex-1 overflow-hidden d-flex flex-column align-items-center justify-content-between",4,"ngIf"],[1,"w-100","itemChatList","cursor","rounded","p-2","pl-3","pr-3","mt-3","row","m-0","justify-content-center","align-items-center",3,"ngClass","click"],[1,"col-2","row","m-0","justify-content-center","align-items-center"],["width","40","alt","",3,"src"],[1,"chatlistitem","flex-1","pl-3"],["class","f-11 font-700",4,"ngIf"],[4,"ngIf"],[1,"f-10","p-0","m-0"],[1,"f-11","font-700"],[1,"d-flex","d-xl-none","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","col-12","align-items-center","flex-column","justify-content-start"],[1,"row","m-0","col-12","mt-3","mb-3",3,"ngClass"],[1,"parraf","p-2","pr-3","pl-3","rounded","shadow",3,"ngClass"],[1,"row","justify-content-end","m-0"],[1,"f-11"],[1,"f-10"],[1,"d-flex","d-xl-none","messages","flex-1","overflow-hidden","d-flex","flex-column","align-items-center","justify-content-between"],[1,"col-12","bg-color2","row","m-0","justify-content-center","p-4"],[1,"btn2","pt-2","pb-2","pl-5","pr-5","f-17","font-900",3,"click"],[1,"display-chat2","overflow-auto","w-100","align-items-center"],["scrollMe2",""],["class","row m-0 col-12 mt-4 mb-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-chat2","col-12","row","m-0","justify-content-center"],[1,"flex-1","mt-3","p-0"],[1,"mt-3","p-0"],[1,"btnSend","bg-color2","pl-2","pr-2","rounded-pill","row","m-0","justify-content-center","align-items-center","border-0","ml-2",3,"keyup.enter","click"],["xmlns","http://www.w3.org/2000/svg","x","0px","y","0px","width","30","height","30","viewBox","0 0 172 172",2,"fill","#000000"],["fill","none","fill-rule","nonzero","stroke","none","stroke-width","1","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","10","stroke-dasharray","","stroke-dashoffset","0","font-family","none","font-weight","none","font-size","none","text-anchor","none",2,"mix-blend-mode","normal"],["d","M0,172v-172h172v172z","fill","none"],["fill","#ffffff"],["d","M149.06667,17.2c-0.55025,0.00377 -1.09709,0.08674 -1.6237,0.24635c-0.15501,0.04207 -0.30818,0.09064 -0.45911,0.14557l-126.05495,40.08854v0.02239c-2.23962,0.83573 -3.72568,2.97333 -3.72891,5.3638c0.00425,2.00222 1.05271,3.85719 2.76589,4.89349l38.30807,30.39114l75.73151,-60.35677l-60.35677,75.73151l30.36875,38.28567c1.0349,1.7286 2.90117,2.78714 4.91589,2.78828c2.39047,-0.00322 4.52807,-1.48928 5.3638,-3.72891h0.02239l40.12214,-126.16692c0.041,-0.11449 0.07834,-0.23027 0.11198,-0.34714c0.15961,-0.52661 0.24258,-1.07345 0.24636,-1.6237c0,-3.16643 -2.5669,-5.73333 -5.73333,-5.73333z"],[1,"row","m-0","col-12","mt-4","mb-3",3,"ngClass"]],template:function(t,e){1&t&&(l.Wb(0,"ion-content"),l.Wb(1,"div",0),l.Wb(2,"div",1),l.Hc(3,v,8,7,"div",2),l.jc(4,"async"),l.Vb(),l.Hc(5,x,3,3,"div",3),l.Wb(6,"div",4),l.Wb(7,"div",5,6),l.Hc(9,k,8,10,"div",7),l.jc(10,"async"),l.Vb(),l.Wb(11,"div",8),l.Wb(12,"div",9),l.Wb(13,"input",10),l.ec("ngModelChange",(function(t){return e.textMessage=t})),l.Vb(),l.Vb(),l.Wb(14,"div",11),l.Wb(15,"button",12),l.ec("keyup.enter",(function(){return e.sendMessage()}))("click",(function(){return e.sendMessage()})),l.Jc(16,"Enviar"),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Hc(17,V,18,4,"div",13),l.Vb(),l.Vb()),2&t&&(l.Db(3),l.oc("ngForOf",l.kc(4,5,e.chats)),l.Db(2),l.oc("ngIf",e.listChatActive),l.Db(4),l.oc("ngForOf",l.kc(10,7,e.messages)),l.Db(4),l.oc("ngModel",e.textMessage),l.Db(4),l.oc("ngIf",!e.listChatActive))},directives:[s.d,i.k,i.l,c.b,c.f,c.g,i.j],pipes:[i.b],styles:['.chats[_ngcontent-%COMP%]{height:93.5vh}.itemChatList[_ngcontent-%COMP%]{background-color:#fff}.bg-color7[_ngcontent-%COMP%]{background-color:#d1d1d1!important}.messages[_ngcontent-%COMP%]{position:relative}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]{min-height:80vh;max-height:80vh}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]{min-height:84vh;max-height:84vh;padding-bottom:120px}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]{min-height:15vh}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   .btn1[_ngcontent-%COMP%]{min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]{position:absolute;bottom:4em}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   .btnSend[_ngcontent-%COMP%]{min-height:50px;min-width:50px;max-width:50px}.listItem[_ngcontent-%COMP%]{background-color:"gray"!important}.chatlistitem[_ngcontent-%COMP%]{position:relative}.chatlistitem[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;min-width:18px;max-width:18px;min-height:18px;max-height:18px;background-color:red;color:#fff;z-index:2;top:0;right:0;border-radius:50%;display:flex;justify-content:center;align-items:center}']}),W)}],R=((D=function t(){_classCallCheck(this,t)}).\u0275mod=l.Pb({type:D}),D.\u0275inj=l.Ob({factory:function(t){return new(t||D)},imports:[[o.l.forChild(j)],o.l]}),D),I=((P=function t(){_classCallCheck(this,t)}).\u0275mod=l.Pb({type:P}),P.\u0275inj=l.Ob({factory:function(t){return new(t||P)},imports:[[i.c,c.c,s.o,R]]}),P)}}]);