(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{rbwS:function(t,e,i){"use strict";i.r(e),i.d(e,"ChatProviderPageModule",(function(){return D}));var n=i("ofXK"),s=i("3Pt+"),c=i("TEn/"),o=i("tyNb"),r=i("mrSG"),a=i("wd/R"),l=i("fXoL"),d=i("I/3d"),g=i("H+bZ"),b=i("b6Qw");const h=["scrollMe"],f=["scrollMe2"];function u(t,e){if(1&t&&(l.Wb(0,"h6",21),l.Jc(1),l.Vb()),2&t){const t=l.ic().$implicit,e=l.ic();l.Db(1),l.Kc(e.dataUsers[t.receptor].name||"")}}function p(t,e){if(1&t&&(l.Wb(0,"span"),l.Jc(1),l.Vb()),2&t){const t=l.ic().$implicit,e=l.ic();l.Db(1),l.Kc(e.getNotification(t.id))}}const m=function(t){return{"bg-color7":t}};function v(t,e){if(1&t){const t=l.Xb();l.Wb(0,"div",14),l.ec("click",(function(){l.zc(t);const i=e.$implicit;return l.ic().getMessages(i.receptor)})),l.Wb(1,"div",15),l.Sb(2,"img",16),l.Vb(),l.Wb(3,"div",17),l.Hc(4,u,2,1,"h6",18),l.Hc(5,p,2,1,"span",19),l.Wb(6,"p",20),l.Jc(7),l.Vb(),l.Vb(),l.Vb()}if(2&t){const t=e.$implicit,i=l.ic();l.oc("ngClass",l.sc(5,m,t.receptor==i.currentReceptor)),l.Db(2),l.oc("src",i.dataUsers[t.receptor]&&i.dataUsers[t.receptor].imageprofile?i.dataUsers[t.receptor].imageprofile:"/assets/img/partials/user.svg",l.Bc),l.Db(2),l.oc("ngIf",i.dataUsers[t.receptor]),l.Db(1),l.oc("ngIf",0!=i.getNotification(t.id)),l.Db(2),l.Kc(i.formatDate(t.date))}}function C(t,e){if(1&t&&(l.Wb(0,"h6",21),l.Jc(1),l.Vb()),2&t){const t=l.ic().$implicit,e=l.ic(2);l.Db(1),l.Kc(e.dataUsers[t.receptor].name||"")}}function M(t,e){if(1&t&&(l.Wb(0,"span"),l.Jc(1),l.Vb()),2&t){const t=l.ic().$implicit,e=l.ic(2);l.Db(1),l.Kc(e.getNotification(t.id))}}function w(t,e){if(1&t){const t=l.Xb();l.Wb(0,"div",14),l.ec("click",(function(){l.zc(t);const i=e.$implicit;return l.ic(2).getMessages(i.receptor)})),l.Wb(1,"div",15),l.Sb(2,"img",16),l.Vb(),l.Wb(3,"div",17),l.Hc(4,C,2,1,"h6",18),l.Hc(5,M,2,1,"span",19),l.Wb(6,"p",20),l.Jc(7),l.Vb(),l.Vb(),l.Vb()}if(2&t){const t=e.$implicit,i=l.ic(2);l.oc("ngClass",l.sc(5,m,t.receptor==i.currentReceptor)),l.Db(2),l.oc("src",i.dataUsers[t.receptor]&&i.dataUsers[t.receptor].imageprofile?i.dataUsers[t.receptor].imageprofile:"/assets/img/partials/user.svg",l.Bc),l.Db(2),l.oc("ngIf",i.dataUsers[t.receptor]),l.Db(1),l.oc("ngIf",0!=i.getNotification(t.id)),l.Db(2),l.Kc(i.formatDate(t.date))}}function x(t,e){if(1&t&&(l.Wb(0,"div",22),l.Hc(1,w,8,7,"div",2),l.jc(2,"async"),l.Vb()),2&t){const t=l.ic();l.Db(1),l.oc("ngForOf",l.kc(2,1,t.chats))}}const O=function(t,e){return{"justify-content-end":t,"justify-content-start":e}},y=function(t,e){return{"bg-color1":t,"bg-color7":e}};function _(t,e){if(1&t&&(l.Wb(0,"div",23),l.Wb(1,"div",24),l.Wb(2,"div",25),l.Wb(3,"p",26),l.Jc(4),l.Vb(),l.Vb(),l.Wb(5,"div",25),l.Wb(6,"span",27),l.Jc(7),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&t){const t=e.$implicit,i=l.ic();l.oc("ngClass",l.tc(4,O,i.user.user.id==t.id,i.user.user.id!=t.id)),l.Db(1),l.oc("ngClass",l.tc(7,y,i.user.user.id==t.id,i.user.user.id!=t.id)),l.Db(3),l.Kc(t.message),l.Db(3),l.Kc(i.formatDate(t.date))}}function V(t,e){if(1&t&&(l.Wb(0,"div",43),l.Wb(1,"div",24),l.Wb(2,"div",25),l.Wb(3,"p",26),l.Jc(4),l.Vb(),l.Vb(),l.Wb(5,"div",25),l.Wb(6,"span",27),l.Jc(7),l.Vb(),l.Vb(),l.Vb(),l.Vb()),2&t){const t=e.$implicit,i=l.ic(2);l.oc("ngClass",l.tc(4,O,i.user.user.id==t.id,i.user.user.id!=t.id)),l.Db(1),l.oc("ngClass",l.tc(7,y,i.user.user.id==t.id,i.user.user.id!=t.id)),l.Db(3),l.Kc(t.message),l.Db(3),l.Kc(i.formatDate(t.date))}}function W(t,e){if(1&t){const t=l.Xb();l.Wb(0,"div",28),l.Wb(1,"div",29),l.Wb(2,"button",30),l.ec("click",(function(){return l.zc(t),l.ic().listChatActive=!0})),l.Jc(3,"VOLVER A CHATS"),l.Vb(),l.Vb(),l.Wb(4,"div",31,32),l.Hc(6,V,8,10,"div",33),l.jc(7,"async"),l.Vb(),l.Wb(8,"div",34),l.Wb(9,"div",35),l.Wb(10,"input",10),l.ec("ngModelChange",(function(e){return l.zc(t),l.ic().textMessage=e})),l.Vb(),l.Vb(),l.Wb(11,"div",36),l.Wb(12,"button",37),l.ec("keyup.enter",(function(){return l.zc(t),l.ic().sendMessage()}))("click",(function(){return l.zc(t),l.ic().sendMessage()})),l.hc(),l.Wb(13,"svg",38),l.Wb(14,"g",39),l.Sb(15,"path",40),l.Wb(16,"g",41),l.Sb(17,"path",42),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Vb()}if(2&t){const t=l.ic();l.Db(6),l.oc("ngForOf",l.kc(7,2,t.messages)),l.Db(4),l.oc("ngModel",t.textMessage)}}const P=[{path:"",component:(()=>{class t{constructor(t,e,i,n,s){this.firestore=t,this.api=e,this.cookie=i,this.router=n,this.route=s,this.dataUsers=[],this.textMessage="",this.listChatActive=!0,this.noti=[],this.id=this.route.snapshot.paramMap.get("id"),this.validateSession(this.id),t.collection("chatnotification_"+this.user.user.id).valueChanges().subscribe(t=>{this.api.c("Notifications",t),this.noti=t}),this.chats=t.collection("chatlist_"+this.user.user.id,t=>t.orderBy("date","desc")).valueChanges(),this.chats.forEach(t=>{this.api.c("Chats",this.notifications),t.forEach(t=>{this.api.c("Chats item ",t),this.getNameReceptop(t.receptor)})}),a.locale("es")}getNotification(t){var e=0;for(let i=0;i<this.noti.length;i++)this.noti[i].id==t&&e++;return e}ngAfterViewInit(){this.scrollContainer=this.scrollMe?this.scrollMe.nativeElement:null,this.scrollContainer2=this.scrollMe2?this.scrollMe2.nativeElement:null}ngOnInit(){0!=this.id&&this.getMessages(this.id)}validateSession(t){localStorage.getItem("ud")&&""!=localStorage.getItem("ud")?this.user=JSON.parse(localStorage.getItem("ud")):this.router.navigate(["/login"])}formatDate(t){return a(t.toDate()).calendar()}getNameReceptop(t){this.api.api({service:"get-data-user-by-id",token:this.user.token,userid:t}).subscribe(e=>{this.api.c("getNameReceptop",e),this.dataUsers[t]=e,this.dataUsers=this.dataUsers,this.api.c("dataUsers",this.dataUsers)},t=>{this.api.c("getProducts error",t)})}getMessages(t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){var e=this;this.listChatActive=!1;let i="chat_"+this.user.user.id+"_"+t,n="chat_"+t+"_"+this.user.user.id,s="chatnotification_"+this.user.user.id;yield this.firestore.collection(i).get().subscribe(c=>Object(r.__awaiter)(this,void 0,void 0,(function*(){yield this.firestore.collection(s).get().subscribe(e=>{e.docs.forEach(e=>Object(r.__awaiter)(this,void 0,void 0,(function*(){this.firestore.collection(s).doc(e.id).get().subscribe(e=>Object(r.__awaiter)(this,void 0,void 0,(function*(){e.data().id=="chat_"+t+"_"+this.user.user.id&&(yield this.firestore.collection(s).doc(e.id).delete())})))})))}),this.messages=0!=c.size?this.firestore.collection(i,t=>t.orderBy("date")).valueChanges():this.firestore.collection(n,t=>t.orderBy("date")).valueChanges(),this.messages.subscribe(t=>{setTimeout(()=>{e.scrollToBottom()},2e3)})}))),this.currentReceptor=t}))}sendMessage(){this.api.sendMessage({message:this.textMessage,useridOri:this.user.user.id,useridDes:this.currentReceptor}),this.textMessage="",this.scrollToBottom()}scrollToBottom(){this.scrollContainer=this.scrollMe.nativeElement,this.scrollContainer2=this.scrollMe2.nativeElement,this.scrollContainer.scroll({top:this.scrollContainer.scrollHeight,left:0,behavior:"smooth"}),this.scrollContainer2.scroll({top:this.scrollContainer2.scrollHeight,left:0,behavior:"smooth"})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(d.a),l.Rb(g.a),l.Rb(b.a),l.Rb(o.j),l.Rb(o.a))},t.\u0275cmp=l.Lb({type:t,selectors:[["app-chat-provider"]],viewQuery:function(t,e){var i;1&t&&(l.Oc(h,!0),l.Oc(f,!0)),2&t&&(l.vc(i=l.fc())&&(e.scrollMe=i.first),l.vc(i=l.fc())&&(e.scrollMe2=i.first))},decls:18,vars:9,consts:[[1,"row","m-0","justify-content-center","align-items-start","vw-100"],[1,"d-none","d-xl-flex","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","align-items-start","flex-column","mt-2"],["class","w-100 itemChatList cursor  rounded p-2 pl-3 pr-3 mt-3 row m-0 justify-content-center align-items-center",3,"ngClass","click",4,"ngFor","ngForOf"],["class","d-flex d-xl-none chats bg-color2 pl-3 pr-3 overflow-auto pb-3 col-12 align-items-center flex-column justify-content-start",4,"ngIf"],[1,"d-none","d-xl-flex","messages","flex-1","overflow-hidden","flex-column","align-items-center","justify-content-between"],[1,"display-chat","overflow-auto","w-100","align-items-center"],["scrollMe",""],["class","row m-0 col-12 mt-3 mb-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-chat","col-12","row","m-0","justify-content-center"],[1,"col-10","mt-3"],["type","text",1,"pl-4","col-12","rounded-pill","shadow-lg",3,"ngModel","ngModelChange"],[1,"flex-1","mt-3"],[1,"btn1","rounded-pill",3,"keyup.enter","click"],["class","d-flex d-xl-none messages flex-1 overflow-hidden d-flex flex-column align-items-center justify-content-between",4,"ngIf"],[1,"w-100","itemChatList","cursor","rounded","p-2","pl-3","pr-3","mt-3","row","m-0","justify-content-center","align-items-center",3,"ngClass","click"],[1,"col-2","row","m-0","justify-content-center","align-items-center"],["width","40","alt","",3,"src"],[1,"chatlistitem","flex-1","pl-3"],["class","f-11 font-700",4,"ngIf"],[4,"ngIf"],[1,"f-10","p-0","m-0"],[1,"f-11","font-700"],[1,"d-flex","d-xl-none","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","col-12","align-items-center","flex-column","justify-content-start"],[1,"row","m-0","col-12","mt-3","mb-3",3,"ngClass"],[1,"parraf","p-2","pr-3","pl-3","rounded","shadow",3,"ngClass"],[1,"row","justify-content-end","m-0"],[1,"f-11"],[1,"f-10"],[1,"d-flex","d-xl-none","messages","flex-1","overflow-hidden","d-flex","flex-column","align-items-center","justify-content-between"],[1,"col-12","bg-color2","row","m-0","justify-content-center","p-4"],[1,"btn2","pt-2","pb-2","pl-5","pr-5","f-17","font-900",3,"click"],[1,"display-chat2","overflow-auto","w-100","align-items-center"],["scrollMe2",""],["class","row m-0 col-12 mt-4 mb-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-chat2","col-12","row","m-0","justify-content-center"],[1,"flex-1","mt-3","p-0"],[1,"mt-3","p-0"],[1,"btnSend","bg-color2","pl-2","pr-2","rounded-pill","row","m-0","justify-content-center","align-items-center","border-0","ml-2",3,"keyup.enter","click"],["xmlns","http://www.w3.org/2000/svg","x","0px","y","0px","width","30","height","30","viewBox","0 0 172 172",2,"fill","#000000"],["fill","none","fill-rule","nonzero","stroke","none","stroke-width","1","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","10","stroke-dasharray","","stroke-dashoffset","0","font-family","none","font-weight","none","font-size","none","text-anchor","none",2,"mix-blend-mode","normal"],["d","M0,172v-172h172v172z","fill","none"],["fill","#ffffff"],["d","M149.06667,17.2c-0.55025,0.00377 -1.09709,0.08674 -1.6237,0.24635c-0.15501,0.04207 -0.30818,0.09064 -0.45911,0.14557l-126.05495,40.08854v0.02239c-2.23962,0.83573 -3.72568,2.97333 -3.72891,5.3638c0.00425,2.00222 1.05271,3.85719 2.76589,4.89349l38.30807,30.39114l75.73151,-60.35677l-60.35677,75.73151l30.36875,38.28567c1.0349,1.7286 2.90117,2.78714 4.91589,2.78828c2.39047,-0.00322 4.52807,-1.48928 5.3638,-3.72891h0.02239l40.12214,-126.16692c0.041,-0.11449 0.07834,-0.23027 0.11198,-0.34714c0.15961,-0.52661 0.24258,-1.07345 0.24636,-1.6237c0,-3.16643 -2.5669,-5.73333 -5.73333,-5.73333z"],[1,"row","m-0","col-12","mt-4","mb-3",3,"ngClass"]],template:function(t,e){1&t&&(l.Wb(0,"ion-content"),l.Wb(1,"div",0),l.Wb(2,"div",1),l.Hc(3,v,8,7,"div",2),l.jc(4,"async"),l.Vb(),l.Hc(5,x,3,3,"div",3),l.Wb(6,"div",4),l.Wb(7,"div",5,6),l.Hc(9,_,8,10,"div",7),l.jc(10,"async"),l.Vb(),l.Wb(11,"div",8),l.Wb(12,"div",9),l.Wb(13,"input",10),l.ec("ngModelChange",(function(t){return e.textMessage=t})),l.Vb(),l.Vb(),l.Wb(14,"div",11),l.Wb(15,"button",12),l.ec("keyup.enter",(function(){return e.sendMessage()}))("click",(function(){return e.sendMessage()})),l.Jc(16,"Enviar"),l.Vb(),l.Vb(),l.Vb(),l.Vb(),l.Hc(17,W,18,4,"div",13),l.Vb(),l.Vb()),2&t&&(l.Db(3),l.oc("ngForOf",l.kc(4,5,e.chats)),l.Db(2),l.oc("ngIf",e.listChatActive),l.Db(4),l.oc("ngForOf",l.kc(10,7,e.messages)),l.Db(4),l.oc("ngModel",e.textMessage),l.Db(4),l.oc("ngIf",!e.listChatActive))},directives:[c.d,n.k,n.l,s.b,s.f,s.g,n.j],pipes:[n.b],styles:['.chats[_ngcontent-%COMP%]{height:93.5vh}.itemChatList[_ngcontent-%COMP%]{background-color:#fff}.bg-color7[_ngcontent-%COMP%]{background-color:#d1d1d1!important}.messages[_ngcontent-%COMP%]{position:relative}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]{min-height:80vh;max-height:80vh}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]{min-height:84vh;max-height:84vh;padding-bottom:120px}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]{min-height:15vh}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   .btn1[_ngcontent-%COMP%]{min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]{position:absolute;bottom:4em}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   .btnSend[_ngcontent-%COMP%]{min-height:50px;min-width:50px;max-width:50px}.listItem[_ngcontent-%COMP%]{background-color:"gray"!important}.chatlistitem[_ngcontent-%COMP%]{position:relative}.chatlistitem[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;min-width:18px;max-width:18px;min-height:18px;max-height:18px;background-color:red;color:#fff;z-index:2;top:0;right:0;border-radius:50%;display:flex;justify-content:center;align-items:center}']}),t})()}];let k=(()=>{class t{}return t.\u0275mod=l.Pb({type:t}),t.\u0275inj=l.Ob({factory:function(e){return new(e||t)},imports:[[o.l.forChild(P)],o.l]}),t})(),D=(()=>{class t{}return t.\u0275mod=l.Pb({type:t}),t.\u0275inj=l.Ob({factory:function(e){return new(e||t)},imports:[[n.c,s.c,c.o,k]]}),t})()}}]);