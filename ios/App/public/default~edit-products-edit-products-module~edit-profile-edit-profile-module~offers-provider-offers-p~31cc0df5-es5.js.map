{"version":3,"sources":["webpack:///node_modules/@angular/fire/__ivy_ngcc__/fesm2015/angular-fire-storage.js","webpack:///node_modules/@firebase/storage/dist/index.esm.js","webpack:///node_modules/firebase/storage/dist/index.esm.js"],"names":["fromTask","task","subscriber","progress","snap","next","error","e","complete","on","cancel","AngularFireUploadTask","createUploadTask","inner$","then","bind","pause","resume","snapshotChanges","percentageChanges","pipe","s","bytesTransferred","totalBytes","AngularFireStorageReference","createStorageRef","ref","schedulers","keepUnstableUntilFirst","getDownloadURL","undefined","outsideAngular","getMetadata","child","path","updateMetadata","meta","put","data","metadata","putString","format","listAll","BUCKET","AngularFireStorage","options","nameOrConfig","storageBucket","platformId","zone","storage","runOutsideAngular","app","storageRef","ɵfac","AngularFireStorage_Factory","t","ctorParameters","type","decorators","args","Object","ɵprov","factory","token","providedIn","AngularFireStorageModule","ɵmod","ɵinj","AngularFireStorageModule_Factory","providers","DEFAULT_HOST","CONFIG_STORAGE_BUCKET_KEY","DEFAULT_MAX_OPERATION_RETRY_TIME","DEFAULT_MAX_UPLOAD_RETRY_TIME","MIN_SAFE_INTEGER","FirebaseStorageError","code","message","code_","prependCode","message_","serverResponse_","name_","prototype","codeProp","codeEquals","serverResponseProp","setServerResponseProp","serverResponse","defineProperty","get","enumerable","configurable","Code","UNKNOWN","OBJECT_NOT_FOUND","BUCKET_NOT_FOUND","PROJECT_NOT_FOUND","QUOTA_EXCEEDED","UNAUTHENTICATED","UNAUTHORIZED","RETRY_LIMIT_EXCEEDED","INVALID_CHECKSUM","CANCELED","INVALID_EVENT_NAME","INVALID_URL","INVALID_DEFAULT_BUCKET","NO_DEFAULT_BUCKET","CANNOT_SLICE_BLOB","SERVER_FILE_WRONG_SIZE","NO_DOWNLOAD_URL","INVALID_ARGUMENT","INVALID_ARGUMENT_COUNT","APP_DELETED","INVALID_ROOT_OPERATION","INVALID_FORMAT","INTERNAL_ERROR","unknown","objectNotFound","quotaExceeded","bucket","unauthenticated","unauthorized","retryLimitExceeded","canceled","invalidUrl","url","invalidDefaultBucket","cannotSliceBlob","serverFileWrongSize","noDownloadURL","invalidArgument","index","fnName","invalidArgumentCount","argMin","argMax","real","countPart","plural","appDeleted","invalidRootOperation","name","invalidFormat","internalError","StringFormat","RAW","BASE64","BASE64URL","DATA_URL","formatValidator","stringFormat","StringData","contentType","dataFromString","stringData","utf8Bytes_","base64Bytes_","dataURLBytes_","dataURLContentType_","value","b","i","length","c","charCodeAt","push","valid","hi","lo","Uint8Array","percentEncodedBytes_","decoded","decodeURIComponent","hasMinus","indexOf","hasUnder","invalidChar","hasPlus","hasSlash","replace","bytes","atob","array","DataURLParts","dataURL","base64","matches","match","middle","endsWith","substring","rest","dataUrl","parts","end","longEnough","TaskEvent","STATE_CHANGED","InternalTaskState","RUNNING","PAUSING","PAUSED","SUCCESS","CANCELING","ERROR","TaskState","taskStateFromInternalTaskState","state","isDef","p","isJustDef","isFunction","isObject","isNonNullObject","isNonArrayObject","Array","isArray","isString","String","isInteger","isNumber","Number","isNativeBlob","isNativeBlobDefined","Blob","ErrorCode","NetworkXhrIo","_this","sent_","xhr_","XMLHttpRequest","errorCode_","NO_ERROR","sendPromise_","Promise","resolve","addEventListener","ABORT","NETWORK_ERROR","send","method","body","headers","open","key","hasOwnProperty","setRequestHeader","toString","getErrorCode","getStatus","status","getResponseText","responseText","abort","getResponseHeader","header","addUploadProgressListener","listener","upload","removeUploadProgressListener","removeEventListener","XhrIoPool","createXhrIo","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","getBlob","_i","arguments","bb","append","Error","sliceBlob","blob","start","webkitSlice","mozSlice","slice","FbsBlob","elideCopy","size","blobType","data_","ArrayBuffer","byteLength","set","size_","type_","startByte","endByte","realBlob","sliced","buffer","blobby","map","val","apply","uint8Arrays","finalLength_1","forEach","merged_1","index_1","uploadData","Location","path_","fullServerUrl","encode","encodeURIComponent","bucketOnlyServerUrl","makeFromBucketSpec","bucketString","bucketLocation","makeFromUrl","location","bucketDomain","gsModify","loc","charAt","gsPath","gsRegex","RegExp","gsIndices","httpModify","version","firebaseStorageHost","firebaseStoragePath","firebaseStorageRegExp","firebaseStorageIndices","cloudStorageHost","cloudStoragePath","cloudStorageRegExp","cloudStorageIndices","groups","regex","indices","postModify","group","captures","exec","bucketValue","pathValue","jsonObjectOrNull","obj","JSON","parse","parent","lastIndexOf","newPath","childPath","canonicalChildPath","split","filter","component","join","lastComponent","makeUrl","urlPart","makeQueryString","params","queryPart","nextPart","noXform_","Mapping","server","local","writable","xform","mappings_","xformPath","fullPath","getMappings","mappings","mappingsXformPath","_metadata","nameMapping","xformSize","sizeMapping","addRef","authWrapper","generateRef","makeStorageReference","fromResource","resource","len","mapping","fromResourceString","resourceString","downloadUrlFromResourceString","tokens","tokensList","urls","base","queryString","alt","toResourceString","stringify","metadataValidator","MAX_RESULTS_KEY","MAX_MAX_RESULTS","PAGE_TOKEN_KEY","PREFIXES_KEY","ITEMS_KEY","fromBackendResponse","listResult","prefixes","items","nextPageToken","_a","pathWithoutTrailingSlash","reference","_b","_c","item","fromResponseString","listOptionsValidator","RequestInfo","handler","timeout","urlParams","errorHandler","progressCallback","successCodes","additionalRetryCodes","handlerCheck","cndn","metadataHandler","xhr","text","listHandler","downloadUrlHandler","sharedErrorHandler","err","newErr","objectErrorHandler","shared","maxOperationRetryTime","requestInfo","list","delimiter","pageToken","maxResults","isRoot","getDownloadUrl","deleteObject","_xhr","_text","determineContentType_","metadataForUpload_","metadataClone","assign","multipartUpload","genBoundary","str","Math","random","boundary","metadata_","metadataString","preBlobPart","postBlobPart","maxUploadRetryTime","ResumableUploadStatus","current","total","finalized","checkResumeHeader_","allowed","allowedStatus","createResumableUpload","metadataForUpload","getResumableUploadStatus","sizeString","isNaN","resumableUploadChunkSize","continueResumableUpload","chunkSize","status_","bytesLeft","bytesToUpload","min","uploadCommand","uploadStatus","newCurrent","Observer","nextOrObserver","asFunctions","observer","UploadTaskSnapshot","validate","specs","passed","minArgs","maxArgs","optional","validLength","validator","ArgSpec","self","and_","v1","v2","stringSpec","stringValidator","chainedValidator","uploadDataSpec","metadataSpec","listOptionSpec","nonNegativeNumberSpec","looseObjectSpec","isLooseObjectValidator","isLooseObject","nullFunctionSpec","async","f","argsToForward","UploadTask","transferred_","needToFetchStatus_","needToFetchMetadata_","observers_","error_","uploadUrl_","request_","chunkMultiplier_","resolve_","reject_","ref_","authWrapper_","location_","blob_","resumable_","shouldDoResumable_","state_","errorHandler_","completeTransitions_","transition_","metadataErrorHandler_","promise_","reject","start_","makeProgressCallback_","sizeBefore","loaded","updateProgress_","createResumable_","fetchStatus_","fetchMetadata_","continueUpload_","oneShotUpload_","resolveToken_","callback","getAuthToken","authToken","createRequest","makeRequest","getPromise","statusRequest","uploadRequest","newStatus","increaseMultiplier_","currentSize","metadataRequest","multipartRequest","transferred","old","notifyObservers_","wasPaused","externalState","completed","typeValidator","nextOrObserverMessage","nextValidator","observerValidator","nextOrObserverValidator","anyDefined","makeBinder","binder","addObserver_","removeObserver_","binderNextOrObserverValidator","binderSpecs","typeOnly","onFulfilled","onRejected","notifyObserver_","splice","finishPromise_","observers","triggered","snapshot","toCall","Reference","newRef","service","throwIfRoot_","accumulator","listAllHelper","opt","nextPage","label","sent","op","FailRequest","_appDelete","RequestMap","Map","id","addRequest","request","clear","v","AuthWrapper","authProvider","maker","requestMaker","pool","bucket_","appId_","deleted_","app_","extractBucket_","appId","authProvider_","storageRefMaker_","requestMaker_","pool_","service_","maxOperationRetryTime_","maxUploadRetryTime_","requestMap_","config","auth","getImmediate","getToken","response","accessToken","deleteApp","setMaxUploadRetryTime","time","setMaxOperationRetryTime","waitSeconds","timeoutId","hitTimeout","cancelState","triggeredCallback","triggerCallback","callWithDelay","millis","setTimeout","success","call","mustStop","waitMillis","stopped","stop","wasTimeout","clearTimeout","NetworkRequest","errorCallback","pendingXhr_","backoffId_","canceled_","appDelete_","url_","method_","headers_","body_","successCodes_","additionalRetryCodes_","callback_","errorCallback_","progressCallback_","timeout_","doTheRequest","backoffCallback","RequestEndStatus","progressListener","progressEvent","lengthComputable","hitServer","isRetryStatusCode_","wasCanceled","successCode","backoffDone","requestWentThrough","wasSuccessCode","result","appDelete","isFiveHundredCode","extraRetryCodes","isExtraRetryCode","isRequestSpecificRetryCode","addAuthHeader_","addVersionHeader_","SDK_VERSION","addGmpidHeader_","Service","authWrapperBucket","internals_","ServiceInternals","test","refFromURL","STORAGE_TYPE","container","getProvider","registerStorage","instance","namespaceExports","Storage","INTERNAL","registerComponent","setServiceProps","setMultipleInstances","registerVersion"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAMA;;;;;AAIA;;;;;;AAKA,aAASA,QAAT,CAAkBC,IAAlB,EAAwB;AACpB,aAAO,IAAI,+CAAJ;AAAgB;;;;AAIvB,gBAAAC,UAAU,EAAI;AACV;AACA,YAAMC,QAAQ;AAAI;;;;AAIlB,iBAJMA,QAIN,CAACC,IAAD;AAAA,iBAAUF,UAAU,CAACG,IAAX,CAAgBD,IAAhB,CAAV;AAAA,SAJA;AAKA;;;AACA,YAAME,KAAK;AAAI;;;;AAIf,iBAJMA,KAIN,CAAAC,CAAC;AAAA,iBAAIL,UAAU,CAACI,KAAX,CAAiBC,CAAjB,CAAJ;AAAA,SAJD;AAKA;;;AACA,YAAMC,QAAQ;AAAI;;;AAGlB,iBAHMA,QAGN;AAAA,iBAAMN,UAAU,CAACM,QAAX,EAAN;AAAA,SAHA;;AAIAP,YAAI,CAACQ,EAAL,CAAQ,eAAR,EAAyBN,QAAzB,EAAmCG,KAAnC,EAA0CE,QAA1C;AACA;AAAQ;;;AAGR;AAAA,mBAAMP,IAAI,CAACS,MAAL,EAAN;AAAA;AAHA;AAIH,OA3BM,CAAP;AA4BH;AAED;;;;;AAIA;;;;;AAGA,aAASC,qBAAT,GAAiC,CAAG;;AACpC,QAAI,KAAJ,EAAW,CAkCV;AACD;;;;;;;;;AAOA,aAASC,gBAAT,CAA0BX,IAA1B,EAAgC;AAC5B;AACA,UAAMY,MAAM,GAAGb,QAAQ,CAACC,IAAD,CAAvB;AACA,aAAO;AACHA,YAAI,EAAJA,IADG;AAEHa,YAAI,EAAEb,IAAI,CAACa,IAAL,CAAUC,IAAV,CAAed,IAAf,CAFH;AAGH,iBAAOA,IAAI,SAAJ,CAAWc,IAAX,CAAgBd,IAAhB,CAHJ;AAIHe,aAAK,EAAEf,IAAI,CAACe,KAAL,CAAWD,IAAX,CAAgBd,IAAhB,CAJJ;AAKHS,cAAM,EAAET,IAAI,CAACS,MAAL,CAAYK,IAAZ,CAAiBd,IAAjB,CALL;AAMHgB,cAAM,EAAEhB,IAAI,CAACgB,MAAL,CAAYF,IAAZ,CAAiBd,IAAjB,CANL;AAOHiB,uBAAe;AAAG;;;AAGlB;AAAA,iBAAML,MAAN;AAAA,SAVG;AAWHM,yBAAiB;AAAG;;;AAGpB;AAAA,iBAAMN,MAAM,CAACO,IAAP,CAAY;AAAK;;;;AAIvB,oBAAAC,CAAC;AAAA,mBAAIA,CAAC,CAACC,gBAAF,GAAqBD,CAAC,CAACE,UAAvB,GAAoC,GAAxC;AAAA,WAJiB,CAAZ,CAAN;AAAA;AAdG,OAAP;AAoBH;AAED;;;;;AAIA;;;;;AAGA,aAASC,2BAAT,GAAuC,CAAG;;AAC1C,QAAI,KAAJ,EAAW,CAwCV;AACD;;;;;;;;;;AAQA,aAASC,gBAAT,CAA0BC,GAA1B,EAA+BC,UAA/B,EAA2CC,sBAA3C,EAAmE;AAC/D,aAAO;AACHC,sBAAc;AAAG;;;AAGjB;AAAA,iBAAM,gDAAGC,SAAH,EAAcV,IAAd,CAAmB,iEAAUO,UAAU,CAACI,cAArB,CAAnB,EAAyD;AAAW;;;AAG1E;AAAA,mBAAML,GAAG,CAACG,cAAJ,EAAN;AAAA,WAH+D,CAAzD,EAGwBD,sBAHxB,CAAN;AAAA,SAJG;AAQHI,mBAAW;AAAG;;;AAGd;AAAA,iBAAM,gDAAGF,SAAH,EAAcV,IAAd,CAAmB,iEAAUO,UAAU,CAACI,cAArB,CAAnB,EAAyD;AAAW;;;AAG1E;AAAA,mBAAML,GAAG,CAACM,WAAJ,EAAN;AAAA,WAH+D,CAAzD,EAGqBJ,sBAHrB,CAAN;AAAA,SAXG;AAeH;AAAS;;;AAGT;AAAA,iBAAM,kDAAKF,GAAG,UAAH,EAAL,CAAN;AAAA,SAlBG;AAmBHO,aAAK;AAAG;;;;AAIR,uBAACC,IAAD;AAAA,iBAAUT,gBAAgB,CAACC,GAAG,CAACO,KAAJ,CAAUC,IAAV,CAAD,EAAkBP,UAAlB,EAA8BC,sBAA9B,CAA1B;AAAA,SAvBG;AAwBHO,sBAAc;AAAG;;;;AAIjB,gCAACC,IAAD;AAAA,iBAAU,kDAAKV,GAAG,CAACS,cAAJ,CAAmBC,IAAnB,CAAL,CAAV;AAAA,SA5BG;AA6BHC,WAAG;AAAG;;;;;AAKN,qBAACC,IAAD,EAAOC,QAAP,EAAoB;AAChB;AACA,cAAMtC,IAAI,GAAGyB,GAAG,CAACW,GAAJ,CAAQC,IAAR,EAAcC,QAAd,CAAb;AACA,iBAAO3B,gBAAgB,CAACX,IAAD,CAAvB;AACH,SAtCE;AAuCHuC,iBAAS;AAAG;;;;;;AAMZ,2BAACF,IAAD,EAAOG,MAAP,EAAeF,QAAf,EAA4B;AACxB;AACA,cAAMtC,IAAI,GAAGyB,GAAG,CAACc,SAAJ,CAAcF,IAAd,EAAoBG,MAApB,EAA4BF,QAA5B,CAAb;AACA,iBAAO3B,gBAAgB,CAACX,IAAD,CAAvB;AACH,SAjDE;AAkDHyC,eAAO;AAAG;;;AAGV;AAAA,iBAAM,kDAAKhB,GAAG,CAACgB,OAAJ,EAAL,CAAN;AAAA;AArDG,OAAP;AAuDH;AAED;;;;;AAIA;;;AACA,QAAMC,MAAM,GAAG,IAAI,4DAAJ,CAAmB,4BAAnB,CAAf;AACA;;;;;;;;QAOMC,kB;AACF;;;;;;;AAOA,kCAAYC,OAAZ,EAAqBC,YAArB,EAAmCC,aAAnC,EACA;AACAC,gBAFA,EAEYC,IAFZ,EAEkB;AAAA;;AACd,aAAKtB,UAAL,GAAkB,IAAI,oEAAJ,CAA2BsB,IAA3B,CAAlB;AACA,aAAKrB,sBAAL,GAA8B,qFAA+B,KAAKD,UAApC,CAA9B;AACA,aAAKuB,OAAL,GAAeD,IAAI,CAACE,iBAAL;AAAwB;;;AAGvC,oBAAM;AACF;AACA,cAAMC,GAAG,GAAG,0EAAoBP,OAApB,EAA6BI,IAA7B,EAAmCH,YAAnC,CAAZ;AACA,iBAAOM,GAAG,CAACF,OAAJ,CAAYH,aAAa,IAAIjB,SAA7B,CAAP;AACH,SAPc,CAAf;AAQH;AACD;;;;;;;;4BAIII,I,EAAM;AACN,iBAAOT,gBAAgB,CAAC,KAAKyB,OAAL,CAAaxB,GAAb,CAAiBQ,IAAjB,CAAD,EAAyB,KAAKP,UAA9B,EAA0C,KAAKC,sBAA/C,CAAvB;AACH;AACD;;;;;;;;;+BAMOM,I,EAAMI,I,EAAMC,Q,EAAU;AACzB;AACA,cAAMc,UAAU,GAAG,KAAKH,OAAL,CAAaxB,GAAb,CAAiBQ,IAAjB,CAAnB;AACA;;AACA,cAAMR,GAAG,GAAGD,gBAAgB,CAAC4B,UAAD,EAAa,KAAK1B,UAAlB,EAA8B,KAAKC,sBAAnC,CAA5B;AACA,iBAAOF,GAAG,CAACW,GAAJ,CAAQC,IAAR,EAAcC,QAAd,CAAP;AACH;;;;;;AAELK,sBAAkB,CAACU,IAAnB,GAA0B,SAASC,0BAAT,CAAoCC,CAApC,EAAuC;AAAE,aAAO,KAAKA,CAAC,IAAIZ,kBAAV,EAA8B,uDAAgB,8DAAhB,CAA9B,EAAiE,uDAAgB,+DAAhB,EAAmC,CAAnC,CAAjE,EAAwG,uDAAgBD,MAAhB,EAAwB,CAAxB,CAAxG,EAAoI,uDAAgB,yDAAhB,CAApI,EAAkK,uDAAgB,oDAAhB,CAAlK,CAAP;AAA2M,KAA9Q;AACA;;;AACAC,sBAAkB,CAACa,cAAnB,GAAoC;AAAA,aAAM,CACtC;AAAEC,YAAI,EAAE5B,SAAR;AAAmB6B,kBAAU,EAAE,CAAC;AAAED,cAAI,EAAE,oDAAR;AAAgBE,cAAI,EAAE,CAAC,8DAAD;AAAtB,SAAD;AAA/B,OADsC,EAEtC;AAAEF,YAAI,EAAE5B,SAAR;AAAmB6B,kBAAU,EAAE,CAAC;AAAED,cAAI,EAAE;AAAR,SAAD,EAAqB;AAAEA,cAAI,EAAE,oDAAR;AAAgBE,cAAI,EAAE,CAAC,+DAAD;AAAtB,SAArB;AAA/B,OAFsC,EAGtC;AAAEF,YAAI,EAAE5B,SAAR;AAAmB6B,kBAAU,EAAE,CAAC;AAAED,cAAI,EAAE;AAAR,SAAD,EAAqB;AAAEA,cAAI,EAAE,oDAAR;AAAgBE,cAAI,EAAE,CAACjB,MAAD;AAAtB,SAArB;AAA/B,OAHsC,EAItC;AAAEe,YAAI,EAAEG,MAAR;AAAgBF,kBAAU,EAAE,CAAC;AAAED,cAAI,EAAE,oDAAR;AAAgBE,cAAI,EAAE,CAAC,yDAAD;AAAtB,SAAD;AAA5B,OAJsC,EAKtC;AAAEF,YAAI,EAAE;AAAR,OALsC,CAAN;AAAA,KAApC;AAOA;;;AAAmBd,sBAAkB,CAACkB,KAAnB,GAA2B,yEAAmB;AAAEC,aAAO,EAAE,SAASR,0BAAT,GAAsC;AAAE,eAAO,IAAIX,kBAAJ,CAAuB,+DAAS,8DAAT,CAAvB,EAAmD,+DAAS,+DAAT,EAA4B,CAA5B,CAAnD,EAAmF,+DAASD,MAAT,EAAiB,CAAjB,CAAnF,EAAwG,+DAAS,yDAAT,CAAxG,EAA+H,+DAAS,oDAAT,CAA/H,CAAP;AAA0J,OAA7M;AAA+MqB,WAAK,EAAEpB,kBAAtN;AAA0OqB,gBAAU,EAAE;AAAtP,KAAnB,CAA3B;AACnB;;AAAc,KAAC,YAAY;AAAE,sEAAyBrB,kBAAzB,EAA6C,CAAC;AACnEc,YAAI,EAAE,wDAD6D;AAEnEE,YAAI,EAAE,CAAC;AACCK,oBAAU,EAAE;AADb,SAAD;AAF6D,OAAD,CAA7C,EAKrB,YAAY;AAAE,eAAO,CAAC;AAAEP,cAAI,EAAE5B,SAAR;AAAmB6B,oBAAU,EAAE,CAAC;AAC9CD,gBAAI,EAAE,oDADwC;AAE9CE,gBAAI,EAAE,CAAC,8DAAD;AAFwC,WAAD;AAA/B,SAAD,EAGX;AAAEF,cAAI,EAAE5B,SAAR;AAAmB6B,oBAAU,EAAE,CAAC;AAClCD,gBAAI,EAAE;AAD4B,WAAD,EAElC;AACCA,gBAAI,EAAE,oDADP;AAECE,gBAAI,EAAE,CAAC,+DAAD;AAFP,WAFkC;AAA/B,SAHW,EAQX;AAAEF,cAAI,EAAE5B,SAAR;AAAmB6B,oBAAU,EAAE,CAAC;AAClCD,gBAAI,EAAE;AAD4B,WAAD,EAElC;AACCA,gBAAI,EAAE,oDADP;AAECE,gBAAI,EAAE,CAACjB,MAAD;AAFP,WAFkC;AAA/B,SARW,EAaX;AAAEe,cAAI,EAAEG,MAAR;AAAgBF,oBAAU,EAAE,CAAC;AAC/BD,gBAAI,EAAE,oDADyB;AAE/BE,gBAAI,EAAE,CAAC,yDAAD;AAFyB,WAAD;AAA5B,SAbW,EAgBX;AAAEF,cAAI,EAAE;AAAR,SAhBW,CAAP;AAgBuB,OArBhB,EAqBkB,IArBlB;AAqB0B,KArBzC;;AAsBd,QAAI,KAAJ,EAAW,CAOV;AAED;;;;;;QAIMQ,wB;;;;AAENA,4BAAwB,CAACC,IAAzB,GAAgC,+DAAwB;AAAET,UAAI,EAAEQ;AAAR,KAAxB,CAAhC;AACAA,4BAAwB,CAACE,IAAzB,GAAgC,+DAAwB;AAAEL,aAAO,EAAE,SAASM,gCAAT,CAA0Cb,CAA1C,EAA6C;AAAE,eAAO,KAAKA,CAAC,IAAIU,wBAAV,GAAP;AAA+C,OAAzG;AAA2GI,eAAS,EAAE,CAAC1B,kBAAD;AAAtH,KAAxB,CAAhC;AACA;;AAAc,KAAC,YAAY;AAAE,sEAAyBsB,wBAAzB,EAAmD,CAAC;AACzER,YAAI,EAAE,sDADmE;AAEzEE,YAAI,EAAE,CAAC;AACCU,mBAAS,EAAE,CAAC1B,kBAAD;AADZ,SAAD;AAFmE,OAAD,CAAnD,EAKrB,IALqB,EAKf,IALe;AAKP,KALR;AAOd;;;;;AAKA;;;;AAOA;;;;;;;;;;;;;;;;;;ACxWA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAIA;;;;;;;;;;;;;;;;;AAgBA;;;;AAGA;;;;;AAGA,QAAI2B,YAAY,GAAG,gCAAnB;AACA;;;;AAGA,QAAIC,yBAAyB,GAAG,eAAhC;AACA;;;;;;AAKA,QAAIC,gCAAgC,GAAG,IAAI,EAAJ,GAAS,IAAhD;AACA;;;;;;AAKA,QAAIC,6BAA6B,GAAG,KAAK,EAAL,GAAU,IAA9C;AACA;;;;;AAIA,QAAIC,gBAAgB,GAAG,CAAC,gBAAxB;AAEA;;;;;;;;;;;;;;;;;AAgBA,QAAIC,oBAAoB;AAAG;AAAe,gBAAY;AAClD,eAASA,oBAAT,CAA8BC,IAA9B,EAAoCC,OAApC,EAA6C;AACzC,aAAKC,KAAL,GAAaC,WAAW,CAACH,IAAD,CAAxB;AACA,aAAKI,QAAL,GAAgB,uBAAuBH,OAAvC;AACA,aAAKI,eAAL,GAAuB,IAAvB;AACA,aAAKC,KAAL,GAAa,eAAb;AACH;;AACDP,0BAAoB,CAACQ,SAArB,CAA+BC,QAA/B,GAA0C,YAAY;AAClD,eAAO,KAAKR,IAAZ;AACH,OAFD;;AAGAD,0BAAoB,CAACQ,SAArB,CAA+BE,UAA/B,GAA4C,UAAUT,IAAV,EAAgB;AACxD,eAAOG,WAAW,CAACH,IAAD,CAAX,KAAsB,KAAKQ,QAAL,EAA7B;AACH,OAFD;;AAGAT,0BAAoB,CAACQ,SAArB,CAA+BG,kBAA/B,GAAoD,YAAY;AAC5D,eAAO,KAAKL,eAAZ;AACH,OAFD;;AAGAN,0BAAoB,CAACQ,SAArB,CAA+BI,qBAA/B,GAAuD,UAAUC,cAAV,EAA0B;AAC7E,aAAKP,eAAL,GAAuBO,cAAvB;AACH,OAFD;;AAGA5B,YAAM,CAAC6B,cAAP,CAAsBd,oBAAoB,CAACQ,SAA3C,EAAsD,MAAtD,EAA8D;AAC1DO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKR,KAAZ;AACH,SAHyD;AAI1DS,kBAAU,EAAE,KAJ8C;AAK1DC,oBAAY,EAAE;AAL4C,OAA9D;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBd,oBAAoB,CAACQ,SAA3C,EAAsD,MAAtD,EAA8D;AAC1DO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKZ,KAAZ;AACH,SAHyD;AAI1Da,kBAAU,EAAE,KAJ8C;AAK1DC,oBAAY,EAAE;AAL4C,OAA9D;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBd,oBAAoB,CAACQ,SAA3C,EAAsD,SAAtD,EAAiE;AAC7DO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKV,QAAZ;AACH,SAH4D;AAI7DW,kBAAU,EAAE,KAJiD;AAK7DC,oBAAY,EAAE;AAL+C,OAAjE;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBd,oBAAoB,CAACQ,SAA3C,EAAsD,gBAAtD,EAAwE;AACpEO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKT,eAAZ;AACH,SAHmE;AAIpEU,kBAAU,EAAE,KAJwD;AAKpEC,oBAAY,EAAE;AALsD,OAAxE;AAOA,aAAOjB,oBAAP;AACH,KAhDyC,EAA1C;;AAiDA,QAAIkB,IAAI,GAAG;AACP;AACAC,aAAO,EAAE,SAFF;AAGPC,sBAAgB,EAAE,kBAHX;AAIPC,sBAAgB,EAAE,kBAJX;AAKPC,uBAAiB,EAAE,mBALZ;AAMPC,oBAAc,EAAE,gBANT;AAOPC,qBAAe,EAAE,iBAPV;AAQPC,kBAAY,EAAE,cARP;AASPC,0BAAoB,EAAE,sBATf;AAUPC,sBAAgB,EAAE,kBAVX;AAWPC,cAAQ,EAAE,UAXH;AAYP;AACAC,wBAAkB,EAAE,oBAbb;AAcPC,iBAAW,EAAE,aAdN;AAePC,4BAAsB,EAAE,wBAfjB;AAgBPC,uBAAiB,EAAE,mBAhBZ;AAiBPC,uBAAiB,EAAE,mBAjBZ;AAkBPC,4BAAsB,EAAE,wBAlBjB;AAmBPC,qBAAe,EAAE,iBAnBV;AAoBPC,sBAAgB,EAAE,kBApBX;AAqBPC,4BAAsB,EAAE,wBArBjB;AAsBPC,iBAAW,EAAE,aAtBN;AAuBPC,4BAAsB,EAAE,wBAvBjB;AAwBPC,oBAAc,EAAE,gBAxBT;AAyBPC,oBAAc,EAAE;AAzBT,KAAX;;AA2BA,aAASrC,WAAT,CAAqBH,IAArB,EAA2B;AACvB,aAAO,aAAaA,IAApB;AACH;;AACD,aAASyC,OAAT,GAAmB;AACf,UAAIxC,OAAO,GAAG,mEACV,kBADJ;AAEA,aAAO,IAAIF,oBAAJ,CAAyBkB,IAAI,CAACC,OAA9B,EAAuCjB,OAAvC,CAAP;AACH;;AACD,aAASyC,cAAT,CAAwBrF,IAAxB,EAA8B;AAC1B,aAAO,IAAI0C,oBAAJ,CAAyBkB,IAAI,CAACE,gBAA9B,EAAgD,aAAa9D,IAAb,GAAoB,mBAApE,CAAP;AACH;;AACD,aAASsF,aAAT,CAAuBC,MAAvB,EAA+B;AAC3B,aAAO,IAAI7C,oBAAJ,CAAyBkB,IAAI,CAACK,cAA9B,EAA8C,uBACjDsB,MADiD,GAEjD,mCAFiD,GAGjD,uCAHG,CAAP;AAIH;;AACD,aAASC,eAAT,GAA2B;AACvB,UAAI5C,OAAO,GAAG,mEACV,+BADJ;AAEA,aAAO,IAAIF,oBAAJ,CAAyBkB,IAAI,CAACM,eAA9B,EAA+CtB,OAA/C,CAAP;AACH;;AACD,aAAS6C,YAAT,CAAsBzF,IAAtB,EAA4B;AACxB,aAAO,IAAI0C,oBAAJ,CAAyBkB,IAAI,CAACO,YAA9B,EAA4C,8CAA8CnE,IAA9C,GAAqD,IAAjG,CAAP;AACH;;AACD,aAAS0F,kBAAT,GAA8B;AAC1B,aAAO,IAAIhD,oBAAJ,CAAyBkB,IAAI,CAACQ,oBAA9B,EAAoD,0DAApD,CAAP;AACH;;AACD,aAASuB,QAAT,GAAoB;AAChB,aAAO,IAAIjD,oBAAJ,CAAyBkB,IAAI,CAACU,QAA9B,EAAwC,oCAAxC,CAAP;AACH;;AACD,aAASsB,UAAT,CAAoBC,GAApB,EAAyB;AACrB,aAAO,IAAInD,oBAAJ,CAAyBkB,IAAI,CAACY,WAA9B,EAA2C,kBAAkBqB,GAAlB,GAAwB,IAAnE,CAAP;AACH;;AACD,aAASC,oBAAT,CAA8BP,MAA9B,EAAsC;AAClC,aAAO,IAAI7C,oBAAJ,CAAyBkB,IAAI,CAACa,sBAA9B,EAAsD,6BAA6Bc,MAA7B,GAAsC,IAA5F,CAAP;AACH;;AACD,aAASQ,eAAT,GAA2B;AACvB,aAAO,IAAIrD,oBAAJ,CAAyBkB,IAAI,CAACe,iBAA9B,EAAiD,wDAAjD,CAAP;AACH;;AACD,aAASqB,mBAAT,GAA+B;AAC3B,aAAO,IAAItD,oBAAJ,CAAyBkB,IAAI,CAACgB,sBAA9B,EAAsD,sEAAtD,CAAP;AACH;;AACD,aAASqB,aAAT,GAAyB;AACrB,aAAO,IAAIvD,oBAAJ,CAAyBkB,IAAI,CAACiB,eAA9B,EAA+C,iDAA/C,CAAP;AACH;;AACD,aAASqB,eAAT,CAAyBC,KAAzB,EAAgCC,MAAhC,EAAwCxD,OAAxC,EAAiD;AAC7C,aAAO,IAAIF,oBAAJ,CAAyBkB,IAAI,CAACkB,gBAA9B,EAAgD,0BAA0BsB,MAA1B,GAAmC,aAAnC,GAAmDD,KAAnD,GAA2D,IAA3D,GAAkEvD,OAAlH,CAAP;AACH;;AACD,aAASyD,oBAAT,CAA8BC,MAA9B,EAAsCC,MAAtC,EAA8CH,MAA9C,EAAsDI,IAAtD,EAA4D;AACxD,UAAIC,SAAJ;AACA,UAAIC,MAAJ;;AACA,UAAIJ,MAAM,KAAKC,MAAf,EAAuB;AACnBE,iBAAS,GAAGH,MAAZ;AACAI,cAAM,GAAGJ,MAAM,KAAK,CAAX,GAAe,UAAf,GAA4B,WAArC;AACH,OAHD,MAIK;AACDG,iBAAS,GAAG,aAAaH,MAAb,GAAsB,OAAtB,GAAgCC,MAA5C;AACAG,cAAM,GAAG,WAAT;AACH;;AACD,aAAO,IAAIhE,oBAAJ,CAAyBkB,IAAI,CAACmB,sBAA9B,EAAsD,gCACzDqB,MADyD,GAEzD,cAFyD,GAGzDK,SAHyD,GAIzD,GAJyD,GAKzDC,MALyD,GAMzD,aANyD,GAOzDF,IAPyD,GAQzD,GARG,CAAP;AASH;;AACD,aAASG,UAAT,GAAsB;AAClB,aAAO,IAAIjE,oBAAJ,CAAyBkB,IAAI,CAACoB,WAA9B,EAA2C,+BAA3C,CAAP;AACH;AACD;;;;;AAGA,aAAS4B,oBAAT,CAA8BC,IAA9B,EAAoC;AAChC,aAAO,IAAInE,oBAAJ,CAAyBkB,IAAI,CAACqB,sBAA9B,EAAsD,oBACzD4B,IADyD,GAEzD,+DAFyD,GAGzD,oDAHG,CAAP;AAIH;AACD;;;;;;AAIA,aAASC,aAAT,CAAuBvG,MAAvB,EAA+BqC,OAA/B,EAAwC;AACpC,aAAO,IAAIF,oBAAJ,CAAyBkB,IAAI,CAACsB,cAA9B,EAA8C,mCAAmC3E,MAAnC,GAA4C,KAA5C,GAAoDqC,OAAlG,CAAP;AACH;AACD;;;;;AAGA,aAASmE,aAAT,CAAuBnE,OAAvB,EAAgC;AAC5B,YAAM,IAAIF,oBAAJ,CAAyBkB,IAAI,CAACuB,cAA9B,EAA8C,qBAAqBvC,OAAnE,CAAN;AACH;AAED;;;;;;;;;;;;;;;;;;AAgBA,QAAIoE,YAAY,GAAG;AACfC,SAAG,EAAE,KADU;AAEfC,YAAM,EAAE,QAFO;AAGfC,eAAS,EAAE,WAHI;AAIfC,cAAQ,EAAE;AAJK,KAAnB;;AAMA,aAASC,eAAT,CAAyBC,YAAzB,EAAuC;AACnC,cAAQA,YAAR;AACI,aAAKN,YAAY,CAACC,GAAlB;AACA,aAAKD,YAAY,CAACE,MAAlB;AACA,aAAKF,YAAY,CAACG,SAAlB;AACA,aAAKH,YAAY,CAACI,QAAlB;AACI;;AACJ;AACI,gBAAO,uCACHJ,YAAY,CAACC,GADV,GAEH,IAFG,GAGHD,YAAY,CAACE,MAHV,GAIH,IAJG,GAKHF,YAAY,CAACG,SALV,GAMH,IANG,GAOHH,YAAY,CAACI,QAPV,GAQH,IARJ;AAPR;AAiBH;AACD;;;;;AAGA,QAAIG,UAAU;AAAG;AAAe,gBAAY;AACxC,eAASA,UAAT,CAAoBnH,IAApB,EAA0BoH,WAA1B,EAAuC;AACnC,aAAKpH,IAAL,GAAYA,IAAZ;AACA,aAAKoH,WAAL,GAAmBA,WAAW,IAAI,IAAlC;AACH;;AACD,aAAOD,UAAP;AACH,KAN+B,EAAhC;;AAOA,aAASE,cAAT,CAAwBlH,MAAxB,EAAgCmH,UAAhC,EAA4C;AACxC,cAAQnH,MAAR;AACI,aAAKyG,YAAY,CAACC,GAAlB;AACI,iBAAO,IAAIM,UAAJ,CAAeI,UAAU,CAACD,UAAD,CAAzB,CAAP;;AACJ,aAAKV,YAAY,CAACE,MAAlB;AACA,aAAKF,YAAY,CAACG,SAAlB;AACI,iBAAO,IAAII,UAAJ,CAAeK,YAAY,CAACrH,MAAD,EAASmH,UAAT,CAA3B,CAAP;;AACJ,aAAKV,YAAY,CAACI,QAAlB;AACI,iBAAO,IAAIG,UAAJ,CAAeM,aAAa,CAACH,UAAD,CAA5B,EAA0CI,mBAAmB,CAACJ,UAAD,CAA7D,CAAP;AACJ;AARJ,OADwC,CAWxC;;;AACA,YAAMtC,OAAO,EAAb;AACH;;AACD,aAASuC,UAAT,CAAoBI,KAApB,EAA2B;AACvB,UAAIC,CAAC,GAAG,EAAR;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACG,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,YAAIE,CAAC,GAAGJ,KAAK,CAACK,UAAN,CAAiBH,CAAjB,CAAR;;AACA,YAAIE,CAAC,IAAI,GAAT,EAAc;AACVH,WAAC,CAACK,IAAF,CAAOF,CAAP;AACH,SAFD,MAGK;AACD,cAAIA,CAAC,IAAI,IAAT,EAAe;AACXH,aAAC,CAACK,IAAF,CAAO,MAAOF,CAAC,IAAI,CAAnB,EAAuB,MAAOA,CAAC,GAAG,EAAlC;AACH,WAFD,MAGK;AACD,gBAAI,CAACA,CAAC,GAAG,KAAL,MAAgB,KAApB,EAA2B;AACvB;AACA,kBAAIG,KAAK,GAAGL,CAAC,GAAGF,KAAK,CAACG,MAAN,GAAe,CAAnB,IAAwB,CAACH,KAAK,CAACK,UAAN,CAAiBH,CAAC,GAAG,CAArB,IAA0B,KAA3B,MAAsC,KAA1E;;AACA,kBAAI,CAACK,KAAL,EAAY;AACR;AACAN,iBAAC,CAACK,IAAF,CAAO,GAAP,EAAY,GAAZ,EAAiB,GAAjB;AACH,eAHD,MAIK;AACD,oBAAIE,EAAE,GAAGJ,CAAT;AACA,oBAAIK,EAAE,GAAGT,KAAK,CAACK,UAAN,CAAiB,EAAEH,CAAnB,CAAT;AACAE,iBAAC,GAAG,QAAS,CAACI,EAAE,GAAG,IAAN,KAAe,EAAxB,GAA+BC,EAAE,GAAG,IAAxC;AACAR,iBAAC,CAACK,IAAF,CAAO,MAAOF,CAAC,IAAI,EAAnB,EAAwB,MAAQA,CAAC,IAAI,EAAN,GAAY,EAA3C,EAAgD,MAAQA,CAAC,IAAI,CAAN,GAAW,EAAlE,EAAuE,MAAOA,CAAC,GAAG,EAAlF;AACH;AACJ,aAbD,MAcK;AACD,kBAAI,CAACA,CAAC,GAAG,KAAL,MAAgB,KAApB,EAA2B;AACvB;AACAH,iBAAC,CAACK,IAAF,CAAO,GAAP,EAAY,GAAZ,EAAiB,GAAjB;AACH,eAHD,MAIK;AACDL,iBAAC,CAACK,IAAF,CAAO,MAAOF,CAAC,IAAI,EAAnB,EAAwB,MAAQA,CAAC,IAAI,CAAN,GAAW,EAA1C,EAA+C,MAAOA,CAAC,GAAG,EAA1D;AACH;AACJ;AACJ;AACJ;AACJ;;AACD,aAAO,IAAIM,UAAJ,CAAeT,CAAf,CAAP;AACH;;AACD,aAASU,oBAAT,CAA8BX,KAA9B,EAAqC;AACjC,UAAIY,OAAJ;;AACA,UAAI;AACAA,eAAO,GAAGC,kBAAkB,CAACb,KAAD,CAA5B;AACH,OAFD,CAGA,OAAO1J,CAAP,EAAU;AACN,cAAMyI,aAAa,CAACE,YAAY,CAACI,QAAd,EAAwB,qBAAxB,CAAnB;AACH;;AACD,aAAOO,UAAU,CAACgB,OAAD,CAAjB;AACH;;AACD,aAASf,YAAT,CAAsBrH,MAAtB,EAA8BwH,KAA9B,EAAqC;AACjC,cAAQxH,MAAR;AACI,aAAKyG,YAAY,CAACE,MAAlB;AAA0B;AACtB,gBAAI2B,QAAQ,GAAGd,KAAK,CAACe,OAAN,CAAc,GAAd,MAAuB,CAAC,CAAvC;AACA,gBAAIC,QAAQ,GAAGhB,KAAK,CAACe,OAAN,CAAc,GAAd,MAAuB,CAAC,CAAvC;;AACA,gBAAID,QAAQ,IAAIE,QAAhB,EAA0B;AACtB,kBAAIC,WAAW,GAAGH,QAAQ,GAAG,GAAH,GAAS,GAAnC;AACA,oBAAM/B,aAAa,CAACvG,MAAD,EAAS,wBACxByI,WADwB,GAExB,mCAFe,CAAnB;AAGH;;AACD;AACH;;AACD,aAAKhC,YAAY,CAACG,SAAlB;AAA6B;AACzB,gBAAI8B,OAAO,GAAGlB,KAAK,CAACe,OAAN,CAAc,GAAd,MAAuB,CAAC,CAAtC;AACA,gBAAII,QAAQ,GAAGnB,KAAK,CAACe,OAAN,CAAc,GAAd,MAAuB,CAAC,CAAvC;;AACA,gBAAIG,OAAO,IAAIC,QAAf,EAAyB;AACrB,kBAAIF,WAAW,GAAGC,OAAO,GAAG,GAAH,GAAS,GAAlC;AACA,oBAAMnC,aAAa,CAACvG,MAAD,EAAS,wBAAwByI,WAAxB,GAAsC,gCAA/C,CAAnB;AACH;;AACDjB,iBAAK,GAAGA,KAAK,CAACoB,OAAN,CAAc,IAAd,EAAoB,GAApB,EAAyBA,OAAzB,CAAiC,IAAjC,EAAuC,GAAvC,CAAR;AACA;AACH;AACD;AAtBJ;;AAwBA,UAAIC,KAAJ;;AACA,UAAI;AACAA,aAAK,GAAGC,IAAI,CAACtB,KAAD,CAAZ;AACH,OAFD,CAGA,OAAO1J,CAAP,EAAU;AACN,cAAMyI,aAAa,CAACvG,MAAD,EAAS,yBAAT,CAAnB;AACH;;AACD,UAAI+I,KAAK,GAAG,IAAIb,UAAJ,CAAeW,KAAK,CAAClB,MAArB,CAAZ;;AACA,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmB,KAAK,CAAClB,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnCqB,aAAK,CAACrB,CAAD,CAAL,GAAWmB,KAAK,CAAChB,UAAN,CAAiBH,CAAjB,CAAX;AACH;;AACD,aAAOqB,KAAP;AACH;AACD;;;;;AAGA,QAAIC,YAAY;AAAG;AAAe,gBAAY;AAC1C,eAASA,YAAT,CAAsBC,OAAtB,EAA+B;AAC3B,aAAKC,MAAL,GAAc,KAAd;AACA,aAAKjC,WAAL,GAAmB,IAAnB;AACA,YAAIkC,OAAO,GAAGF,OAAO,CAACG,KAAR,CAAc,iBAAd,CAAd;;AACA,YAAID,OAAO,KAAK,IAAhB,EAAsB;AAClB,gBAAM5C,aAAa,CAACE,YAAY,CAACI,QAAd,EAAwB,uDAAxB,CAAnB;AACH;;AACD,YAAIwC,MAAM,GAAGF,OAAO,CAAC,CAAD,CAAP,IAAc,IAA3B;;AACA,YAAIE,MAAM,IAAI,IAAd,EAAoB;AAChB,eAAKH,MAAL,GAAcI,QAAQ,CAACD,MAAD,EAAS,SAAT,CAAtB;AACA,eAAKpC,WAAL,GAAmB,KAAKiC,MAAL,GACbG,MAAM,CAACE,SAAP,CAAiB,CAAjB,EAAoBF,MAAM,CAAC1B,MAAP,GAAgB,UAAUA,MAA9C,CADa,GAEb0B,MAFN;AAGH;;AACD,aAAKG,IAAL,GAAYP,OAAO,CAACM,SAAR,CAAkBN,OAAO,CAACV,OAAR,CAAgB,GAAhB,IAAuB,CAAzC,CAAZ;AACH;;AACD,aAAOS,YAAP;AACH,KAlBiC,EAAlC;;AAmBA,aAAS1B,aAAT,CAAuBmC,OAAvB,EAAgC;AAC5B,UAAIC,KAAK,GAAG,IAAIV,YAAJ,CAAiBS,OAAjB,CAAZ;;AACA,UAAIC,KAAK,CAACR,MAAV,EAAkB;AACd,eAAO7B,YAAY,CAACZ,YAAY,CAACE,MAAd,EAAsB+C,KAAK,CAACF,IAA5B,CAAnB;AACH,OAFD,MAGK;AACD,eAAOrB,oBAAoB,CAACuB,KAAK,CAACF,IAAP,CAA3B;AACH;AACJ;;AACD,aAASjC,mBAAT,CAA6BkC,OAA7B,EAAsC;AAClC,UAAIC,KAAK,GAAG,IAAIV,YAAJ,CAAiBS,OAAjB,CAAZ;AACA,aAAOC,KAAK,CAACzC,WAAb;AACH;;AACD,aAASqC,QAAT,CAAkB1K,CAAlB,EAAqB+K,GAArB,EAA0B;AACtB,UAAIC,UAAU,GAAGhL,CAAC,CAAC+I,MAAF,IAAYgC,GAAG,CAAChC,MAAjC;;AACA,UAAI,CAACiC,UAAL,EAAiB;AACb,eAAO,KAAP;AACH;;AACD,aAAOhL,CAAC,CAAC2K,SAAF,CAAY3K,CAAC,CAAC+I,MAAF,GAAWgC,GAAG,CAAChC,MAA3B,MAAuCgC,GAA9C;AACH;AAED;;;;;;;;;;;;;;;;;;AAgBA,QAAIE,SAAS,GAAG;AACZ;AACAC,mBAAa,EAAE;AAFH,KAAhB;AAIA,QAAIC,iBAAiB,GAAG;AACpBC,aAAO,EAAE,SADW;AAEpBC,aAAO,EAAE,SAFW;AAGpBC,YAAM,EAAE,QAHY;AAIpBC,aAAO,EAAE,SAJW;AAKpBC,eAAS,EAAE,WALS;AAMpBrG,cAAQ,EAAE,UANU;AAOpBsG,WAAK,EAAE;AAPa,KAAxB;AASA,QAAIC,SAAS,GAAG;AACZ;AACAN,aAAO,EAAE,SAFG;;AAGZ;AACAE,YAAM,EAAE,QAJI;;AAKZ;AACAC,aAAO,EAAE,SANG;;AAOZ;AACApG,cAAQ,EAAE,UARE;;AASZ;AACAsG,WAAK,EAAE;AAVK,KAAhB;;AAYA,aAASE,8BAAT,CAAwCC,KAAxC,EAA+C;AAC3C,cAAQA,KAAR;AACI,aAAKT,iBAAiB,CAACC,OAAvB;AACA,aAAKD,iBAAiB,CAACE,OAAvB;AACA,aAAKF,iBAAiB,CAACK,SAAvB;AACI,iBAAOE,SAAS,CAACN,OAAjB;;AACJ,aAAKD,iBAAiB,CAACG,MAAvB;AACI,iBAAOI,SAAS,CAACJ,MAAjB;;AACJ,aAAKH,iBAAiB,CAACI,OAAvB;AACI,iBAAOG,SAAS,CAACH,OAAjB;;AACJ,aAAKJ,iBAAiB,CAAChG,QAAvB;AACI,iBAAOuG,SAAS,CAACvG,QAAjB;;AACJ,aAAKgG,iBAAiB,CAACM,KAAvB;AACI,iBAAOC,SAAS,CAACD,KAAjB;;AACJ;AACI;AACA,iBAAOC,SAAS,CAACD,KAAjB;AAfR;AAiBH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;AAGA,aAASI,KAAT,CAAeC,CAAf,EAAkB;AACd,aAAOA,CAAC,IAAI,IAAZ;AACH;;AACD,aAASC,SAAT,CAAmBD,CAAnB,EAAsB;AAClB,aAAOA,CAAC,KAAK,KAAK,CAAlB;AACH;;AACD,aAASE,UAAT,CAAoBF,CAApB,EAAuB;AACnB,aAAO,OAAOA,CAAP,KAAa,UAApB;AACH;;AACD,aAASG,QAAT,CAAkBH,CAAlB,EAAqB;AACjB,aAAO,OAAOA,CAAP,KAAa,QAApB;AACH;;AACD,aAASI,eAAT,CAAyBJ,CAAzB,EAA4B;AACxB,aAAOG,QAAQ,CAACH,CAAD,CAAR,IAAeA,CAAC,KAAK,IAA5B;AACH;;AACD,aAASK,gBAAT,CAA0BL,CAA1B,EAA6B;AACzB,aAAOG,QAAQ,CAACH,CAAD,CAAR,IAAe,CAACM,KAAK,CAACC,OAAN,CAAcP,CAAd,CAAvB;AACH;;AACD,aAASQ,QAAT,CAAkBR,CAAlB,EAAqB;AACjB,aAAO,OAAOA,CAAP,KAAa,QAAb,IAAyBA,CAAC,YAAYS,MAA7C;AACH;;AACD,aAASC,SAAT,CAAmBV,CAAnB,EAAsB;AAClB,aAAOW,QAAQ,CAACX,CAAD,CAAR,IAAeY,MAAM,CAACF,SAAP,CAAiBV,CAAjB,CAAtB;AACH;;AACD,aAASW,QAAT,CAAkBX,CAAlB,EAAqB;AACjB,aAAO,OAAOA,CAAP,KAAa,QAAb,IAAyBA,CAAC,YAAYY,MAA7C;AACH;;AACD,aAASC,YAAT,CAAsBb,CAAtB,EAAyB;AACrB,aAAOc,mBAAmB,MAAMd,CAAC,YAAYe,IAA7C;AACH;;AACD,aAASD,mBAAT,GAA+B;AAC3B,aAAO,OAAOC,IAAP,KAAgB,WAAvB;AACH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;AAGA,QAAIC,SAAJ;;AACA,KAAC,UAAUA,SAAV,EAAqB;AAClBA,eAAS,CAACA,SAAS,CAAC,UAAD,CAAT,GAAwB,CAAzB,CAAT,GAAuC,UAAvC;AACAA,eAAS,CAACA,SAAS,CAAC,eAAD,CAAT,GAA6B,CAA9B,CAAT,GAA4C,eAA5C;AACAA,eAAS,CAACA,SAAS,CAAC,OAAD,CAAT,GAAqB,CAAtB,CAAT,GAAoC,OAApC;AACH,KAJD,EAIGA,SAAS,KAAKA,SAAS,GAAG,EAAjB,CAJZ;AAMA;;;;;;;;;;;;;;;;;AAgBA;;;;;;AAIA,QAAIC,YAAY;AAAG;AAAe,gBAAY;AAC1C,eAASA,YAAT,GAAwB;AACpB,YAAIC,KAAK,GAAG,IAAZ;;AACA,aAAKC,KAAL,GAAa,KAAb;AACA,aAAKC,IAAL,GAAY,IAAIC,cAAJ,EAAZ;AACA,aAAKC,UAAL,GAAkBN,SAAS,CAACO,QAA5B;AACA,aAAKC,YAAL,GAAoB,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmB;AAC/CR,eAAK,CAACE,IAAN,CAAWO,gBAAX,CAA4B,OAA5B,EAAqC,YAAY;AAC7CT,iBAAK,CAACI,UAAN,GAAmBN,SAAS,CAACY,KAA7B;AACAF,mBAAO,CAACR,KAAD,CAAP;AACH,WAHD;;AAIAA,eAAK,CAACE,IAAN,CAAWO,gBAAX,CAA4B,OAA5B,EAAqC,YAAY;AAC7CT,iBAAK,CAACI,UAAN,GAAmBN,SAAS,CAACa,aAA7B;AACAH,mBAAO,CAACR,KAAD,CAAP;AACH,WAHD;;AAIAA,eAAK,CAACE,IAAN,CAAWO,gBAAX,CAA4B,MAA5B,EAAoC,YAAY;AAC5CD,mBAAO,CAACR,KAAD,CAAP;AACH,WAFD;AAGH,SAZmB,CAApB;AAaH;AACD;;;;;AAGAD,kBAAY,CAAChJ,SAAb,CAAuB6J,IAAvB,GAA8B,UAAUlH,GAAV,EAAemH,MAAf,EAAuBC,IAAvB,EAA6BC,OAA7B,EAAsC;AAChE,YAAI,KAAKd,KAAT,EAAgB;AACZ,gBAAMrF,aAAa,CAAC,+BAAD,CAAnB;AACH;;AACD,aAAKqF,KAAL,GAAa,IAAb;AACA,aAAKC,IAAL,CAAUc,IAAV,CAAeH,MAAf,EAAuBnH,GAAvB,EAA4B,IAA5B;;AACA,YAAImF,KAAK,CAACkC,OAAD,CAAT,EAAoB;AAChB,eAAK,IAAIE,GAAT,IAAgBF,OAAhB,EAAyB;AACrB,gBAAIA,OAAO,CAACG,cAAR,CAAuBD,GAAvB,CAAJ,EAAiC;AAC7B,mBAAKf,IAAL,CAAUiB,gBAAV,CAA2BF,GAA3B,EAAgCF,OAAO,CAACE,GAAD,CAAP,CAAaG,QAAb,EAAhC;AACH;AACJ;AACJ;;AACD,YAAIvC,KAAK,CAACiC,IAAD,CAAT,EAAiB;AACb,eAAKZ,IAAL,CAAUU,IAAV,CAAeE,IAAf;AACH,SAFD,MAGK;AACD,eAAKZ,IAAL,CAAUU,IAAV;AACH;;AACD,eAAO,KAAKN,YAAZ;AACH,OApBD;AAqBA;;;;;AAGAP,kBAAY,CAAChJ,SAAb,CAAuBsK,YAAvB,GAAsC,YAAY;AAC9C,YAAI,CAAC,KAAKpB,KAAV,EAAiB;AACb,gBAAMrF,aAAa,CAAC,uCAAD,CAAnB;AACH;;AACD,eAAO,KAAKwF,UAAZ;AACH,OALD;AAMA;;;;;AAGAL,kBAAY,CAAChJ,SAAb,CAAuBuK,SAAvB,GAAmC,YAAY;AAC3C,YAAI,CAAC,KAAKrB,KAAV,EAAiB;AACb,gBAAMrF,aAAa,CAAC,oCAAD,CAAnB;AACH;;AACD,YAAI;AACA,iBAAO,KAAKsF,IAAL,CAAUqB,MAAjB;AACH,SAFD,CAGA,OAAOrP,CAAP,EAAU;AACN,iBAAO,CAAC,CAAR;AACH;AACJ,OAVD;AAWA;;;;;AAGA6N,kBAAY,CAAChJ,SAAb,CAAuByK,eAAvB,GAAyC,YAAY;AACjD,YAAI,CAAC,KAAKvB,KAAV,EAAiB;AACb,gBAAMrF,aAAa,CAAC,0CAAD,CAAnB;AACH;;AACD,eAAO,KAAKsF,IAAL,CAAUuB,YAAjB;AACH,OALD;AAMA;;;;;;AAIA1B,kBAAY,CAAChJ,SAAb,CAAuB2K,KAAvB,GAA+B,YAAY;AACvC,aAAKxB,IAAL,CAAUwB,KAAV;AACH,OAFD;AAGA;;;;;AAGA3B,kBAAY,CAAChJ,SAAb,CAAuB4K,iBAAvB,GAA2C,UAAUC,MAAV,EAAkB;AACzD,eAAO,KAAK1B,IAAL,CAAUyB,iBAAV,CAA4BC,MAA5B,CAAP;AACH,OAFD;AAGA;;;;;AAGA7B,kBAAY,CAAChJ,SAAb,CAAuB8K,yBAAvB,GAAmD,UAAUC,QAAV,EAAoB;AACnE,YAAIjD,KAAK,CAAC,KAAKqB,IAAL,CAAU6B,MAAX,CAAT,EAA6B;AACzB,eAAK7B,IAAL,CAAU6B,MAAV,CAAiBtB,gBAAjB,CAAkC,UAAlC,EAA8CqB,QAA9C;AACH;AACJ,OAJD;AAKA;;;;;AAGA/B,kBAAY,CAAChJ,SAAb,CAAuBiL,4BAAvB,GAAsD,UAAUF,QAAV,EAAoB;AACtE,YAAIjD,KAAK,CAAC,KAAKqB,IAAL,CAAU6B,MAAX,CAAT,EAA6B;AACzB,eAAK7B,IAAL,CAAU6B,MAAV,CAAiBE,mBAAjB,CAAqC,UAArC,EAAiDH,QAAjD;AACH;AACJ,OAJD;;AAKA,aAAO/B,YAAP;AACH,KA1GiC,EAAlC;AA4GA;;;;;;;;;;;;;;;;;AAgBA;;;;;AAGA,QAAImC,SAAS;AAAG;AAAe,gBAAY;AACvC,eAASA,SAAT,GAAqB,CACpB;;AACDA,eAAS,CAACnL,SAAV,CAAoBoL,WAApB,GAAkC,YAAY;AAC1C,eAAO,IAAIpC,YAAJ,EAAP;AACH,OAFD;;AAGA,aAAOmC,SAAP;AACH,KAP8B,EAA/B;AASA;;;;;;;;;;;;;;;;;;AAgBA,aAASE,cAAT,GAA0B;AACtB,UAAI,OAAOC,WAAP,KAAuB,WAA3B,EAAwC;AACpC,eAAOA,WAAP;AACH,OAFD,MAGK,IAAI,OAAOC,iBAAP,KAA6B,WAAjC,EAA8C;AAC/C,eAAOA,iBAAP;AACH,OAFI,MAGA;AACD,eAAO7O,SAAP;AACH;AACJ;AACD;;;;;;;;AAMA,aAAS8O,OAAT,GAAmB;AACf,UAAIhN,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIiN,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAAC1G,MAAhC,EAAwCyG,EAAE,EAA1C,EAA8C;AAC1CjN,YAAI,CAACiN,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACH;;AACD,UAAIH,WAAW,GAAGD,cAAc,EAAhC;;AACA,UAAIC,WAAW,KAAK5O,SAApB,EAA+B;AAC3B,YAAIiP,EAAE,GAAG,IAAIL,WAAJ,EAAT;;AACA,aAAK,IAAIvG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvG,IAAI,CAACwG,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;AAClC4G,YAAE,CAACC,MAAH,CAAUpN,IAAI,CAACuG,CAAD,CAAd;AACH;;AACD,eAAO4G,EAAE,CAACH,OAAH,EAAP;AACH,OAND,MAOK;AACD,YAAI3C,mBAAmB,EAAvB,EAA2B;AACvB,iBAAO,IAAIC,IAAJ,CAAStK,IAAT,CAAP;AACH,SAFD,MAGK;AACD,gBAAMqN,KAAK,CAAC,qDAAD,CAAX;AACH;AACJ;AACJ;AACD;;;;;;;;;;;AASA,aAASC,SAAT,CAAmBC,IAAnB,EAAyBC,KAAzB,EAAgChF,GAAhC,EAAqC;AACjC,UAAI+E,IAAI,CAACE,WAAT,EAAsB;AAClB,eAAOF,IAAI,CAACE,WAAL,CAAiBD,KAAjB,EAAwBhF,GAAxB,CAAP;AACH,OAFD,MAGK,IAAI+E,IAAI,CAACG,QAAT,EAAmB;AACpB,eAAOH,IAAI,CAACG,QAAL,CAAcF,KAAd,EAAqBhF,GAArB,CAAP;AACH,OAFI,MAGA,IAAI+E,IAAI,CAACI,KAAT,EAAgB;AACjB,eAAOJ,IAAI,CAACI,KAAL,CAAWH,KAAX,EAAkBhF,GAAlB,CAAP;AACH;;AACD,aAAO,IAAP;AACH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;;;AAKA,QAAIoF,OAAO;AAAG;AAAe,gBAAY;AACrC,eAASA,OAAT,CAAiBlP,IAAjB,EAAuBmP,SAAvB,EAAkC;AAC9B,YAAIC,IAAI,GAAG,CAAX;AACA,YAAIC,QAAQ,GAAG,EAAf;;AACA,YAAI3D,YAAY,CAAC1L,IAAD,CAAhB,EAAwB;AACpB,eAAKsP,KAAL,GAAatP,IAAb;AACAoP,cAAI,GAAGpP,IAAI,CAACoP,IAAZ;AACAC,kBAAQ,GAAGrP,IAAI,CAACoB,IAAhB;AACH,SAJD,MAKK,IAAIpB,IAAI,YAAYuP,WAApB,EAAiC;AAClC,cAAIJ,SAAJ,EAAe;AACX,iBAAKG,KAAL,GAAa,IAAIjH,UAAJ,CAAerI,IAAf,CAAb;AACH,WAFD,MAGK;AACD,iBAAKsP,KAAL,GAAa,IAAIjH,UAAJ,CAAerI,IAAI,CAACwP,UAApB,CAAb;AACA,iBAAKF,KAAL,CAAWG,GAAX,CAAe,IAAIpH,UAAJ,CAAerI,IAAf,CAAf;AACH;;AACDoP,cAAI,GAAG,KAAKE,KAAL,CAAWxH,MAAlB;AACH,SATI,MAUA,IAAI9H,IAAI,YAAYqI,UAApB,EAAgC;AACjC,cAAI8G,SAAJ,EAAe;AACX,iBAAKG,KAAL,GAAatP,IAAb;AACH,WAFD,MAGK;AACD,iBAAKsP,KAAL,GAAa,IAAIjH,UAAJ,CAAerI,IAAI,CAAC8H,MAApB,CAAb;AACA,iBAAKwH,KAAL,CAAWG,GAAX,CAAezP,IAAf;AACH;;AACDoP,cAAI,GAAGpP,IAAI,CAAC8H,MAAZ;AACH;;AACD,aAAK4H,KAAL,GAAaN,IAAb;AACA,aAAKO,KAAL,GAAaN,QAAb;AACH;;AACDH,aAAO,CAACpM,SAAR,CAAkBsM,IAAlB,GAAyB,YAAY;AACjC,eAAO,KAAKM,KAAZ;AACH,OAFD;;AAGAR,aAAO,CAACpM,SAAR,CAAkB1B,IAAlB,GAAyB,YAAY;AACjC,eAAO,KAAKuO,KAAZ;AACH,OAFD;;AAGAT,aAAO,CAACpM,SAAR,CAAkBmM,KAAlB,GAA0B,UAAUW,SAAV,EAAqBC,OAArB,EAA8B;AACpD,YAAInE,YAAY,CAAC,KAAK4D,KAAN,CAAhB,EAA8B;AAC1B,cAAIQ,QAAQ,GAAG,KAAKR,KAApB;AACA,cAAIS,MAAM,GAAGnB,SAAS,CAACkB,QAAD,EAAWF,SAAX,EAAsBC,OAAtB,CAAtB;;AACA,cAAIE,MAAM,KAAK,IAAf,EAAqB;AACjB,mBAAO,IAAP;AACH;;AACD,iBAAO,IAAIb,OAAJ,CAAYa,MAAZ,CAAP;AACH,SAPD,MAQK;AACD,cAAId,KAAK,GAAG,IAAI5G,UAAJ,CAAe,KAAKiH,KAAL,CAAWU,MAA1B,EAAkCJ,SAAlC,EAA6CC,OAAO,GAAGD,SAAvD,CAAZ;AACA,iBAAO,IAAIV,OAAJ,CAAYD,KAAZ,EAAmB,IAAnB,CAAP;AACH;AACJ,OAbD;;AAcAC,aAAO,CAACZ,OAAR,GAAkB,YAAY;AAC1B,YAAIhN,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIiN,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAAC1G,MAAhC,EAAwCyG,EAAE,EAA1C,EAA8C;AAC1CjN,cAAI,CAACiN,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACH;;AACD,YAAI5C,mBAAmB,EAAvB,EAA2B;AACvB,cAAIsE,MAAM,GAAG3O,IAAI,CAAC4O,GAAL,CAAS,UAAUC,GAAV,EAAe;AACjC,gBAAIA,GAAG,YAAYjB,OAAnB,EAA4B;AACxB,qBAAOiB,GAAG,CAACb,KAAX;AACH,aAFD,MAGK;AACD,qBAAOa,GAAP;AACH;AACJ,WAPY,CAAb;AAQA,iBAAO,IAAIjB,OAAJ,CAAYZ,OAAO,CAAC8B,KAAR,CAAc,IAAd,EAAoBH,MAApB,CAAZ,CAAP;AACH,SAVD,MAWK;AACD,cAAII,WAAW,GAAG/O,IAAI,CAAC4O,GAAL,CAAS,UAAUC,GAAV,EAAe;AACtC,gBAAI9E,QAAQ,CAAC8E,GAAD,CAAZ,EAAmB;AACf,qBAAO9I,cAAc,CAACT,YAAY,CAACC,GAAd,EAAmBsJ,GAAnB,CAAd,CAAsCnQ,IAA7C;AACH,aAFD,MAGK;AACD;AACA,qBAAOmQ,GAAG,CAACb,KAAX;AACH;AACJ,WARiB,CAAlB;AASA,cAAIgB,aAAa,GAAG,CAApB;AACAD,qBAAW,CAACE,OAAZ,CAAoB,UAAUrH,KAAV,EAAiB;AACjCoH,yBAAa,IAAIpH,KAAK,CAACsG,UAAvB;AACH,WAFD;AAGA,cAAIgB,QAAQ,GAAG,IAAInI,UAAJ,CAAeiI,aAAf,CAAf;AACA,cAAIG,OAAO,GAAG,CAAd;AACAJ,qBAAW,CAACE,OAAZ,CAAoB,UAAUrH,KAAV,EAAiB;AACjC,iBAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqB,KAAK,CAACpB,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC2I,sBAAQ,CAACC,OAAO,EAAR,CAAR,GAAsBvH,KAAK,CAACrB,CAAD,CAA3B;AACH;AACJ,WAJD;AAKA,iBAAO,IAAIqH,OAAJ,CAAYsB,QAAZ,EAAsB,IAAtB,CAAP;AACH;AACJ,OAvCD;;AAwCAtB,aAAO,CAACpM,SAAR,CAAkB4N,UAAlB,GAA+B,YAAY;AACvC,eAAO,KAAKpB,KAAZ;AACH,OAFD;;AAGA,aAAOJ,OAAP;AACH,KAhG4B,EAA7B;AAkGA;;;;;;;;;;;;;;;;;AAgBA;;;;;AAGA,QAAIyB,QAAQ;AAAG;AAAe,gBAAY;AACtC,eAASA,QAAT,CAAkBxL,MAAlB,EAA0BvF,IAA1B,EAAgC;AAC5B,aAAKuF,MAAL,GAAcA,MAAd;AACA,aAAKyL,KAAL,GAAahR,IAAb;AACH;;AACD2B,YAAM,CAAC6B,cAAP,CAAsBuN,QAAQ,CAAC7N,SAA/B,EAA0C,MAA1C,EAAkD;AAC9CO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKuN,KAAZ;AACH,SAH6C;AAI9CtN,kBAAU,EAAE,KAJkC;AAK9CC,oBAAY,EAAE;AALgC,OAAlD;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBuN,QAAQ,CAAC7N,SAA/B,EAA0C,QAA1C,EAAoD;AAChDO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKzD,IAAL,CAAUkI,MAAV,KAAqB,CAA5B;AACH,SAH+C;AAIhDxE,kBAAU,EAAE,KAJoC;AAKhDC,oBAAY,EAAE;AALkC,OAApD;;AAOAoN,cAAQ,CAAC7N,SAAT,CAAmB+N,aAAnB,GAAmC,YAAY;AAC3C,YAAIC,MAAM,GAAGC,kBAAb;AACA,eAAO,QAAQD,MAAM,CAAC,KAAK3L,MAAN,CAAd,GAA8B,KAA9B,GAAsC2L,MAAM,CAAC,KAAKlR,IAAN,CAAnD;AACH,OAHD;;AAIA+Q,cAAQ,CAAC7N,SAAT,CAAmBkO,mBAAnB,GAAyC,YAAY;AACjD,YAAIF,MAAM,GAAGC,kBAAb;AACA,eAAO,QAAQD,MAAM,CAAC,KAAK3L,MAAN,CAAd,GAA8B,IAArC;AACH,OAHD;;AAIAwL,cAAQ,CAACM,kBAAT,GAA8B,UAAUC,YAAV,EAAwB;AAClD,YAAIC,cAAJ;;AACA,YAAI;AACAA,wBAAc,GAAGR,QAAQ,CAACS,WAAT,CAAqBF,YAArB,CAAjB;AACH,SAFD,CAGA,OAAOjT,CAAP,EAAU;AACN;AACA;AACA,iBAAO,IAAI0S,QAAJ,CAAaO,YAAb,EAA2B,EAA3B,CAAP;AACH;;AACD,YAAIC,cAAc,CAACvR,IAAf,KAAwB,EAA5B,EAAgC;AAC5B,iBAAOuR,cAAP;AACH,SAFD,MAGK;AACD,gBAAMzL,oBAAoB,CAACwL,YAAD,CAA1B;AACH;AACJ,OAhBD;;AAiBAP,cAAQ,CAACS,WAAT,GAAuB,UAAU3L,GAAV,EAAe;AAClC,YAAI4L,QAAQ,GAAG,IAAf;AACA,YAAIC,YAAY,GAAG,qBAAnB;;AACA,iBAASC,QAAT,CAAkBC,GAAlB,EAAuB;AACnB,cAAIA,GAAG,CAAC5R,IAAJ,CAAS6R,MAAT,CAAgBD,GAAG,CAAC5R,IAAJ,CAASkI,MAAT,GAAkB,CAAlC,MAAyC,GAA7C,EAAkD;AAC9C0J,eAAG,CAACZ,KAAJ,GAAYY,GAAG,CAACZ,KAAJ,CAAU3B,KAAV,CAAgB,CAAhB,EAAmB,CAAC,CAApB,CAAZ;AACH;AACJ;;AACD,YAAIyC,MAAM,GAAG,WAAb;AACA,YAAIC,OAAO,GAAG,IAAIC,MAAJ,CAAW,WAAWN,YAAX,GAA0BI,MAArC,EAA6C,GAA7C,CAAd;AACA,YAAIG,SAAS,GAAG;AAAE1M,gBAAM,EAAE,CAAV;AAAavF,cAAI,EAAE;AAAnB,SAAhB;;AACA,iBAASkS,UAAT,CAAoBN,GAApB,EAAyB;AACrBA,aAAG,CAACZ,KAAJ,GAAYpI,kBAAkB,CAACgJ,GAAG,CAAC5R,IAAL,CAA9B;AACH;;AACD,YAAImS,OAAO,GAAG,gBAAd;AACA,YAAIC,mBAAmB,GAAG/P,YAAY,CAAC8G,OAAb,CAAqB,MAArB,EAA6B,KAA7B,CAA1B;AACA,YAAIkJ,mBAAmB,GAAG,iBAA1B;AACA,YAAIC,qBAAqB,GAAG,IAAIN,MAAJ,CAAW,eAAeI,mBAAf,GAAqC,GAArC,GAA2CD,OAA3C,GAAqD,KAArD,GAA6DT,YAA7D,GAA4E,IAA5E,GAAmFW,mBAA9F,EAAmH,GAAnH,CAA5B;AACA,YAAIE,sBAAsB,GAAG;AAAEhN,gBAAM,EAAE,CAAV;AAAavF,cAAI,EAAE;AAAnB,SAA7B;AACA,YAAIwS,gBAAgB,GAAG,qDAAvB;AACA,YAAIC,gBAAgB,GAAG,UAAvB;AACA,YAAIC,kBAAkB,GAAG,IAAIV,MAAJ,CAAW,eAAeQ,gBAAf,GAAkC,GAAlC,GAAwCd,YAAxC,GAAuD,GAAvD,GAA6De,gBAAxE,EAA0F,GAA1F,CAAzB;AACA,YAAIE,mBAAmB,GAAG;AAAEpN,gBAAM,EAAE,CAAV;AAAavF,cAAI,EAAE;AAAnB,SAA1B;AACA,YAAI4S,MAAM,GAAG,CACT;AAAEC,eAAK,EAAEd,OAAT;AAAkBe,iBAAO,EAAEb,SAA3B;AAAsCc,oBAAU,EAAEpB;AAAlD,SADS,EAET;AACIkB,eAAK,EAAEP,qBADX;AAEIQ,iBAAO,EAAEP,sBAFb;AAGIQ,oBAAU,EAAEb;AAHhB,SAFS,EAOT;AACIW,eAAK,EAAEH,kBADX;AAEII,iBAAO,EAAEH,mBAFb;AAGII,oBAAU,EAAEb;AAHhB,SAPS,CAAb;;AAaA,aAAK,IAAIjK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2K,MAAM,CAAC1K,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpC,cAAI+K,KAAK,GAAGJ,MAAM,CAAC3K,CAAD,CAAlB;AACA,cAAIgL,QAAQ,GAAGD,KAAK,CAACH,KAAN,CAAYK,IAAZ,CAAiBrN,GAAjB,CAAf;;AACA,cAAIoN,QAAJ,EAAc;AACV,gBAAIE,WAAW,GAAGF,QAAQ,CAACD,KAAK,CAACF,OAAN,CAAcvN,MAAf,CAA1B;AACA,gBAAI6N,SAAS,GAAGH,QAAQ,CAACD,KAAK,CAACF,OAAN,CAAc9S,IAAf,CAAxB;;AACA,gBAAI,CAACoT,SAAL,EAAgB;AACZA,uBAAS,GAAG,EAAZ;AACH;;AACD3B,oBAAQ,GAAG,IAAIV,QAAJ,CAAaoC,WAAb,EAA0BC,SAA1B,CAAX;AACAJ,iBAAK,CAACD,UAAN,CAAiBtB,QAAjB;AACA;AACH;AACJ;;AACD,YAAIA,QAAQ,IAAI,IAAhB,EAAsB;AAClB,gBAAM7L,UAAU,CAACC,GAAD,CAAhB;AACH;;AACD,eAAO4L,QAAP;AACH,OAtDD;;AAuDA,aAAOV,QAAP;AACH,KApG6B,EAA9B;AAsGA;;;;;;;;;;;;;;;;;AAgBA;;;;;;AAIA,aAASsC,gBAAT,CAA0BlU,CAA1B,EAA6B;AACzB,UAAImU,GAAJ;;AACA,UAAI;AACAA,WAAG,GAAGC,IAAI,CAACC,KAAL,CAAWrU,CAAX,CAAN;AACH,OAFD,CAGA,OAAOd,CAAP,EAAU;AACN,eAAO,IAAP;AACH;;AACD,UAAIiN,gBAAgB,CAACgI,GAAD,CAApB,EAA2B;AACvB,eAAOA,GAAP;AACH,OAFD,MAGK;AACD,eAAO,IAAP;AACH;AACJ;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;AAGA;;;;;AAGA,aAASG,MAAT,CAAgBzT,IAAhB,EAAsB;AAClB,UAAIA,IAAI,CAACkI,MAAL,KAAgB,CAApB,EAAuB;AACnB,eAAO,IAAP;AACH;;AACD,UAAI/B,KAAK,GAAGnG,IAAI,CAAC0T,WAAL,CAAiB,GAAjB,CAAZ;;AACA,UAAIvN,KAAK,KAAK,CAAC,CAAf,EAAkB;AACd,eAAO,EAAP;AACH;;AACD,UAAIwN,OAAO,GAAG3T,IAAI,CAACqP,KAAL,CAAW,CAAX,EAAclJ,KAAd,CAAd;AACA,aAAOwN,OAAP;AACH;;AACD,aAAS5T,KAAT,CAAeC,IAAf,EAAqB4T,SAArB,EAAgC;AAC5B,UAAIC,kBAAkB,GAAGD,SAAS,CAC7BE,KADoB,CACd,GADc,EAEpBC,MAFoB,CAEb,UAAUC,SAAV,EAAqB;AAAE,eAAOA,SAAS,CAAC9L,MAAV,GAAmB,CAA1B;AAA8B,OAFxC,EAGpB+L,IAHoB,CAGf,GAHe,CAAzB;;AAIA,UAAIjU,IAAI,CAACkI,MAAL,KAAgB,CAApB,EAAuB;AACnB,eAAO2L,kBAAP;AACH,OAFD,MAGK;AACD,eAAO7T,IAAI,GAAG,GAAP,GAAa6T,kBAApB;AACH;AACJ;AACD;;;;;;;;AAMA,aAASK,aAAT,CAAuBlU,IAAvB,EAA6B;AACzB,UAAImG,KAAK,GAAGnG,IAAI,CAAC0T,WAAL,CAAiB,GAAjB,EAAsB1T,IAAI,CAACkI,MAAL,GAAc,CAApC,CAAZ;;AACA,UAAI/B,KAAK,KAAK,CAAC,CAAf,EAAkB;AACd,eAAOnG,IAAP;AACH,OAFD,MAGK;AACD,eAAOA,IAAI,CAACqP,KAAL,CAAWlJ,KAAK,GAAG,CAAnB,CAAP;AACH;AACJ;AAED;;;;;;;;;;;;;;;;;;AAgBA,aAASgO,OAAT,CAAiBC,OAAjB,EAA0B;AACtB,aAAO,aAAa/R,YAAb,GAA4B,KAA5B,GAAoC+R,OAA3C;AACH;;AACD,aAASC,eAAT,CAAyBC,MAAzB,EAAiC;AAC7B,UAAIpD,MAAM,GAAGC,kBAAb;AACA,UAAIoD,SAAS,GAAG,GAAhB;;AACA,WAAK,IAAInH,GAAT,IAAgBkH,MAAhB,EAAwB;AACpB,YAAIA,MAAM,CAACjH,cAAP,CAAsBD,GAAtB,CAAJ,EAAgC;AAC5B;AACA,cAAIoH,QAAQ,GAAGtD,MAAM,CAAC9D,GAAD,CAAN,GAAc,GAAd,GAAoB8D,MAAM,CAACoD,MAAM,CAAClH,GAAD,CAAP,CAAzC;AACAmH,mBAAS,GAAGA,SAAS,GAAGC,QAAZ,GAAuB,GAAnC;AACH;AACJ,OAT4B,CAU7B;;;AACAD,eAAS,GAAGA,SAAS,CAAClF,KAAV,CAAgB,CAAhB,EAAmB,CAAC,CAApB,CAAZ;AACA,aAAOkF,SAAP;AACH;AAED;;;;;;;;;;;;;;;;;;AAgBA,aAASE,QAAT,CAAkBpU,QAAlB,EAA4B0H,KAA5B,EAAmC;AAC/B,aAAOA,KAAP;AACH;AACD;;;;;AAGA,QAAI2M,OAAO;AAAG;AAAe,gBAAY;AACrC,eAASA,OAAT,CAAiBC,MAAjB,EAAyBC,KAAzB,EAAgCC,QAAhC,EAA0CC,KAA1C,EAAiD;AAC7C,aAAKH,MAAL,GAAcA,MAAd;AACA,aAAKC,KAAL,GAAaA,KAAK,IAAID,MAAtB;AACA,aAAKE,QAAL,GAAgB,CAAC,CAACA,QAAlB;AACA,aAAKC,KAAL,GAAaA,KAAK,IAAIL,QAAtB;AACH;;AACD,aAAOC,OAAP;AACH,KAR4B,EAA7B;;AASA,QAAIK,SAAS,GAAG,IAAhB;;AACA,aAASC,SAAT,CAAmBC,QAAnB,EAA6B;AACzB,UAAI,CAACxJ,QAAQ,CAACwJ,QAAD,CAAT,IAAuBA,QAAQ,CAAC/M,MAAT,GAAkB,CAA7C,EAAgD;AAC5C,eAAO+M,QAAP;AACH,OAFD,MAGK;AACD,eAAOf,aAAa,CAACe,QAAD,CAApB;AACH;AACJ;;AACD,aAASC,WAAT,GAAuB;AACnB,UAAIH,SAAJ,EAAe;AACX,eAAOA,SAAP;AACH;;AACD,UAAII,QAAQ,GAAG,EAAf;AACAA,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,QAAZ,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,YAAZ,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,gBAAZ,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,MAAZ,EAAoB,UAApB,EAAgC,IAAhC,CAAd;;AACA,eAASU,iBAAT,CAA2BC,SAA3B,EAAsCJ,QAAtC,EAAgD;AAC5C,eAAOD,SAAS,CAACC,QAAD,CAAhB;AACH;;AACD,UAAIK,WAAW,GAAG,IAAIZ,OAAJ,CAAY,MAAZ,CAAlB;AACAY,iBAAW,CAACR,KAAZ,GAAoBM,iBAApB;AACAD,cAAQ,CAAC9M,IAAT,CAAciN,WAAd;AACA;;;;AAGA,eAASC,SAAT,CAAmBF,SAAnB,EAA8B7F,IAA9B,EAAoC;AAChC,YAAIxE,KAAK,CAACwE,IAAD,CAAT,EAAiB;AACb,iBAAO3D,MAAM,CAAC2D,IAAD,CAAb;AACH,SAFD,MAGK;AACD,iBAAOA,IAAP;AACH;AACJ;;AACD,UAAIgG,WAAW,GAAG,IAAId,OAAJ,CAAY,MAAZ,CAAlB;AACAc,iBAAW,CAACV,KAAZ,GAAoBS,SAApB;AACAJ,cAAQ,CAAC9M,IAAT,CAAcmN,WAAd;AACAL,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,aAAZ,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,SAAZ,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,SAAZ,EAAuB,IAAvB,EAA6B,IAA7B,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,cAAZ,EAA4B,IAA5B,EAAkC,IAAlC,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,oBAAZ,EAAkC,IAAlC,EAAwC,IAAxC,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,iBAAZ,EAA+B,IAA/B,EAAqC,IAArC,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,iBAAZ,EAA+B,IAA/B,EAAqC,IAArC,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,aAAZ,EAA2B,IAA3B,EAAiC,IAAjC,CAAd;AACAS,cAAQ,CAAC9M,IAAT,CAAc,IAAIqM,OAAJ,CAAY,UAAZ,EAAwB,gBAAxB,EAA0C,IAA1C,CAAd;AACAK,eAAS,GAAGI,QAAZ;AACA,aAAOJ,SAAP;AACH;;AACD,aAASU,MAAT,CAAgBpV,QAAhB,EAA0BqV,WAA1B,EAAuC;AACnC,eAASC,WAAT,GAAuB;AACnB,YAAIpQ,MAAM,GAAGlF,QAAQ,CAAC,QAAD,CAArB;AACA,YAAIL,IAAI,GAAGK,QAAQ,CAAC,UAAD,CAAnB;AACA,YAAIuR,GAAG,GAAG,IAAIb,QAAJ,CAAaxL,MAAb,EAAqBvF,IAArB,CAAV;AACA,eAAO0V,WAAW,CAACE,oBAAZ,CAAiChE,GAAjC,CAAP;AACH;;AACDjQ,YAAM,CAAC6B,cAAP,CAAsBnD,QAAtB,EAAgC,KAAhC,EAAuC;AAAEoD,WAAG,EAAEkS;AAAP,OAAvC;AACH;;AACD,aAASE,YAAT,CAAsBH,WAAtB,EAAmCI,QAAnC,EAA6CX,QAA7C,EAAuD;AACnD,UAAI9U,QAAQ,GAAG,EAAf;AACAA,cAAQ,CAAC,MAAD,CAAR,GAAmB,MAAnB;AACA,UAAI0V,GAAG,GAAGZ,QAAQ,CAACjN,MAAnB;;AACA,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8N,GAApB,EAAyB9N,CAAC,EAA1B,EAA8B;AAC1B,YAAI+N,OAAO,GAAGb,QAAQ,CAAClN,CAAD,CAAtB;AACA5H,gBAAQ,CAAC2V,OAAO,CAACpB,KAAT,CAAR,GAA0BoB,OAAO,CAAClB,KAAR,CAAczU,QAAd,EAAwByV,QAAQ,CAACE,OAAO,CAACrB,MAAT,CAAhC,CAA1B;AACH;;AACDc,YAAM,CAACpV,QAAD,EAAWqV,WAAX,CAAN;AACA,aAAOrV,QAAP;AACH;;AACD,aAAS4V,kBAAT,CAA4BP,WAA5B,EAAyCQ,cAAzC,EAAyDf,QAAzD,EAAmE;AAC/D,UAAI7B,GAAG,GAAGD,gBAAgB,CAAC6C,cAAD,CAA1B;;AACA,UAAI5C,GAAG,KAAK,IAAZ,EAAkB;AACd,eAAO,IAAP;AACH;;AACD,UAAIwC,QAAQ,GAAGxC,GAAf;AACA,aAAOuC,YAAY,CAACH,WAAD,EAAcI,QAAd,EAAwBX,QAAxB,CAAnB;AACH;;AACD,aAASgB,6BAAT,CAAuC9V,QAAvC,EAAiD6V,cAAjD,EAAiE;AAC7D,UAAI5C,GAAG,GAAGD,gBAAgB,CAAC6C,cAAD,CAA1B;;AACA,UAAI5C,GAAG,KAAK,IAAZ,EAAkB;AACd,eAAO,IAAP;AACH;;AACD,UAAI,CAAC7H,QAAQ,CAAC6H,GAAG,CAAC,gBAAD,CAAJ,CAAb,EAAsC;AAClC;AACA;AACA,eAAO,IAAP;AACH;;AACD,UAAI8C,MAAM,GAAG9C,GAAG,CAAC,gBAAD,CAAhB;;AACA,UAAI8C,MAAM,CAAClO,MAAP,KAAkB,CAAtB,EAAyB;AACrB,eAAO,IAAP;AACH;;AACD,UAAIgJ,MAAM,GAAGC,kBAAb;AACA,UAAIkF,UAAU,GAAGD,MAAM,CAACtC,KAAP,CAAa,GAAb,CAAjB;AACA,UAAIwC,IAAI,GAAGD,UAAU,CAAC/F,GAAX,CAAe,UAAUxO,KAAV,EAAiB;AACvC,YAAIyD,MAAM,GAAGlF,QAAQ,CAAC,QAAD,CAArB;AACA,YAAIL,IAAI,GAAGK,QAAQ,CAAC,UAAD,CAAnB;AACA,YAAI+T,OAAO,GAAG,QAAQlD,MAAM,CAAC3L,MAAD,CAAd,GAAyB,KAAzB,GAAiC2L,MAAM,CAAClR,IAAD,CAArD;AACA,YAAIuW,IAAI,GAAGpC,OAAO,CAACC,OAAD,CAAlB;AACA,YAAIoC,WAAW,GAAGnC,eAAe,CAAC;AAC9BoC,aAAG,EAAE,OADyB;AAE9B3U,eAAK,EAAEA;AAFuB,SAAD,CAAjC;AAIA,eAAOyU,IAAI,GAAGC,WAAd;AACH,OAVU,CAAX;AAWA,aAAOF,IAAI,CAAC,CAAD,CAAX;AACH;;AACD,aAASI,gBAAT,CAA0BrW,QAA1B,EAAoC8U,QAApC,EAA8C;AAC1C,UAAIW,QAAQ,GAAG,EAAf;AACA,UAAIC,GAAG,GAAGZ,QAAQ,CAACjN,MAAnB;;AACA,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8N,GAApB,EAAyB9N,CAAC,EAA1B,EAA8B;AAC1B,YAAI+N,OAAO,GAAGb,QAAQ,CAAClN,CAAD,CAAtB;;AACA,YAAI+N,OAAO,CAACnB,QAAZ,EAAsB;AAClBiB,kBAAQ,CAACE,OAAO,CAACrB,MAAT,CAAR,GAA2BtU,QAAQ,CAAC2V,OAAO,CAACpB,KAAT,CAAnC;AACH;AACJ;;AACD,aAAOrB,IAAI,CAACoD,SAAL,CAAeb,QAAf,CAAP;AACH;;AACD,aAASc,iBAAT,CAA2B3L,CAA3B,EAA8B;AAC1B,UAAI,CAACG,QAAQ,CAACH,CAAD,CAAT,IAAgB,CAACA,CAArB,EAAwB;AACpB,cAAM,2BAAN;AACH;;AACD,WAAK,IAAImC,GAAT,IAAgBnC,CAAhB,EAAmB;AACf,YAAIA,CAAC,CAACoC,cAAF,CAAiBD,GAAjB,CAAJ,EAA2B;AACvB,cAAImD,GAAG,GAAGtF,CAAC,CAACmC,GAAD,CAAX;;AACA,cAAIA,GAAG,KAAK,gBAAZ,EAA8B;AAC1B,gBAAI,CAAChC,QAAQ,CAACmF,GAAD,CAAb,EAAoB;AAChB,oBAAM,iDAAN;AACH;AACJ,WAJD,MAKK;AACD,gBAAIlF,eAAe,CAACkF,GAAD,CAAnB,EAA0B;AACtB,oBAAM,kBAAkBnD,GAAlB,GAAwB,wBAA9B;AACH;AACJ;AACJ;AACJ;AACJ;AAED;;;;;;;;;;;;;;;;;;AAgBA,QAAIyJ,eAAe,GAAG,YAAtB;AACA,QAAIC,eAAe,GAAG,IAAtB;AACA,QAAIC,cAAc,GAAG,WAArB;AACA,QAAIC,YAAY,GAAG,UAAnB;AACA,QAAIC,SAAS,GAAG,OAAhB;;AACA,aAASC,mBAAT,CAA6BxB,WAA7B,EAA0CnQ,MAA1C,EAAkDuQ,QAAlD,EAA4D;AACxD,UAAIqB,UAAU,GAAG;AACbC,gBAAQ,EAAE,EADG;AAEbC,aAAK,EAAE,EAFM;AAGbC,qBAAa,EAAExB,QAAQ,CAAC,eAAD;AAHV,OAAjB;;AAKA,UAAIA,QAAQ,CAACkB,YAAD,CAAZ,EAA4B;AACxB,aAAK,IAAIrI,EAAE,GAAG,CAAT,EAAY4I,EAAE,GAAGzB,QAAQ,CAACkB,YAAD,CAA9B,EAA8CrI,EAAE,GAAG4I,EAAE,CAACrP,MAAtD,EAA8DyG,EAAE,EAAhE,EAAoE;AAChE,cAAI3O,IAAI,GAAGuX,EAAE,CAAC5I,EAAD,CAAb;AACA,cAAI6I,wBAAwB,GAAGxX,IAAI,CAACmJ,OAAL,CAAa,KAAb,EAAoB,EAApB,CAA/B;AACA,cAAIsO,SAAS,GAAG/B,WAAW,CAACE,oBAAZ,CAAiC,IAAI7E,QAAJ,CAAaxL,MAAb,EAAqBiS,wBAArB,CAAjC,CAAhB;AACAL,oBAAU,CAACC,QAAX,CAAoB/O,IAApB,CAAyBoP,SAAzB;AACH;AACJ;;AACD,UAAI3B,QAAQ,CAACmB,SAAD,CAAZ,EAAyB;AACrB,aAAK,IAAIS,EAAE,GAAG,CAAT,EAAYC,EAAE,GAAG7B,QAAQ,CAACmB,SAAD,CAA9B,EAA2CS,EAAE,GAAGC,EAAE,CAACzP,MAAnD,EAA2DwP,EAAE,EAA7D,EAAiE;AAC7D,cAAIE,IAAI,GAAGD,EAAE,CAACD,EAAD,CAAb;AACA,cAAID,SAAS,GAAG/B,WAAW,CAACE,oBAAZ,CAAiC,IAAI7E,QAAJ,CAAaxL,MAAb,EAAqBqS,IAAI,CAAC,MAAD,CAAzB,CAAjC,CAAhB;AACAT,oBAAU,CAACE,KAAX,CAAiBhP,IAAjB,CAAsBoP,SAAtB;AACH;AACJ;;AACD,aAAON,UAAP;AACH;;AACD,aAASU,kBAAT,CAA4BnC,WAA5B,EAAyCnQ,MAAzC,EAAiD2Q,cAAjD,EAAiE;AAC7D,UAAI5C,GAAG,GAAGD,gBAAgB,CAAC6C,cAAD,CAA1B;;AACA,UAAI5C,GAAG,KAAK,IAAZ,EAAkB;AACd,eAAO,IAAP;AACH;;AACD,UAAIwC,QAAQ,GAAGxC,GAAf;AACA,aAAO4D,mBAAmB,CAACxB,WAAD,EAAcnQ,MAAd,EAAsBuQ,QAAtB,CAA1B;AACH;;AACD,aAASgC,oBAAT,CAA8B7M,CAA9B,EAAiC;AAC7B,UAAI,CAACG,QAAQ,CAACH,CAAD,CAAT,IAAgB,CAACA,CAArB,EAAwB;AACpB,cAAM,8BAAN;AACH;;AACD,WAAK,IAAImC,GAAT,IAAgBnC,CAAhB,EAAmB;AACf,YAAImC,GAAG,KAAKyJ,eAAZ,EAA6B;AACzB,cAAI,CAAClL,SAAS,CAACV,CAAC,CAAC4L,eAAD,CAAF,CAAV,IACA5L,CAAC,CAAC4L,eAAD,CAAD,IAAsB,CAD1B,EAC6B;AACzB,kBAAM,8CAAN;AACH;;AACD,cAAI5L,CAAC,CAAC4L,eAAD,CAAD,GAAqB,IAAzB,EAA+B;AAC3B,kBAAM,qDAAqDC,eAArD,GAAuE,GAA7E;AACH;AACJ,SARD,MASK,IAAI1J,GAAG,KAAK2J,cAAZ,EAA4B;AAC7B,cAAI9L,CAAC,CAAC8L,cAAD,CAAD,IAAqB,CAACtL,QAAQ,CAACR,CAAC,CAAC8L,cAAD,CAAF,CAAlC,EAAuD;AACnD,kBAAM,kCAAN;AACH;AACJ,SAJI,MAKA;AACD,gBAAM,qBAAqB3J,GAA3B;AACH;AACJ;AACJ;;AAED,QAAI2K,WAAW;AAAG;AAAe,gBAAY;AACzC,eAASA,WAAT,CAAqBlS,GAArB,EAA0BmH,MAA1B;AACA;;;;;;;AAOAgL,aARA,EAQSC,OART,EAQkB;AACd,aAAKpS,GAAL,GAAWA,GAAX;AACA,aAAKmH,MAAL,GAAcA,MAAd;AACA,aAAKgL,OAAL,GAAeA,OAAf;AACA,aAAKC,OAAL,GAAeA,OAAf;AACA,aAAKC,SAAL,GAAiB,EAAjB;AACA,aAAKhL,OAAL,GAAe,EAAf;AACA,aAAKD,IAAL,GAAY,IAAZ;AACA,aAAKkL,YAAL,GAAoB,IAApB;AACA;;;;;AAIA,aAAKC,gBAAL,GAAwB,IAAxB;AACA,aAAKC,YAAL,GAAoB,CAAC,GAAD,CAApB;AACA,aAAKC,oBAAL,GAA4B,EAA5B;AACH;;AACD,aAAOP,WAAP;AACH,KA3BgC,EAAjC;AA6BA;;;;;;;;;;;;;;;;;AAgBA;;;;;AAGA,aAASQ,YAAT,CAAsBC,IAAtB,EAA4B;AACxB,UAAI,CAACA,IAAL,EAAW;AACP,cAAMpT,OAAO,EAAb;AACH;AACJ;;AACD,aAASqT,eAAT,CAAyB/C,WAAzB,EAAsCP,QAAtC,EAAgD;AAC5C,eAAS6C,OAAT,CAAiBU,GAAjB,EAAsBC,IAAtB,EAA4B;AACxB,YAAItY,QAAQ,GAAG4V,kBAAkB,CAACP,WAAD,EAAciD,IAAd,EAAoBxD,QAApB,CAAjC;AACAoD,oBAAY,CAAClY,QAAQ,KAAK,IAAd,CAAZ;AACA,eAAOA,QAAP;AACH;;AACD,aAAO2X,OAAP;AACH;;AACD,aAASY,WAAT,CAAqBlD,WAArB,EAAkCnQ,MAAlC,EAA0C;AACtC,eAASyS,OAAT,CAAiBU,GAAjB,EAAsBC,IAAtB,EAA4B;AACxB,YAAIxB,UAAU,GAAGU,kBAAkB,CAACnC,WAAD,EAAcnQ,MAAd,EAAsBoT,IAAtB,CAAnC;AACAJ,oBAAY,CAACpB,UAAU,KAAK,IAAhB,CAAZ;AACA,eAAOA,UAAP;AACH;;AACD,aAAOa,OAAP;AACH;;AACD,aAASa,kBAAT,CAA4BnD,WAA5B,EAAyCP,QAAzC,EAAmD;AAC/C,eAAS6C,OAAT,CAAiBU,GAAjB,EAAsBC,IAAtB,EAA4B;AACxB,YAAItY,QAAQ,GAAG4V,kBAAkB,CAACP,WAAD,EAAciD,IAAd,EAAoBxD,QAApB,CAAjC;AACAoD,oBAAY,CAAClY,QAAQ,KAAK,IAAd,CAAZ;AACA,eAAO8V,6BAA6B,CAAC9V,QAAD,EAAWsY,IAAX,CAApC;AACH;;AACD,aAAOX,OAAP;AACH;;AACD,aAASc,kBAAT,CAA4BrH,QAA5B,EAAsC;AAClC,eAAS0G,YAAT,CAAsBO,GAAtB,EAA2BK,GAA3B,EAAgC;AAC5B,YAAIC,MAAJ;;AACA,YAAIN,GAAG,CAACjL,SAAJ,OAAoB,GAAxB,EAA6B;AACzBuL,gBAAM,GAAGxT,eAAe,EAAxB;AACH,SAFD,MAGK;AACD,cAAIkT,GAAG,CAACjL,SAAJ,OAAoB,GAAxB,EAA6B;AACzBuL,kBAAM,GAAG1T,aAAa,CAACmM,QAAQ,CAAClM,MAAV,CAAtB;AACH,WAFD,MAGK;AACD,gBAAImT,GAAG,CAACjL,SAAJ,OAAoB,GAAxB,EAA6B;AACzBuL,oBAAM,GAAGvT,YAAY,CAACgM,QAAQ,CAACzR,IAAV,CAArB;AACH,aAFD,MAGK;AACDgZ,oBAAM,GAAGD,GAAT;AACH;AACJ;AACJ;;AACDC,cAAM,CAAC1V,qBAAP,CAA6ByV,GAAG,CAAC1V,kBAAJ,EAA7B;AACA,eAAO2V,MAAP;AACH;;AACD,aAAOb,YAAP;AACH;;AACD,aAASc,kBAAT,CAA4BxH,QAA5B,EAAsC;AAClC,UAAIyH,MAAM,GAAGJ,kBAAkB,CAACrH,QAAD,CAA/B;;AACA,eAAS0G,YAAT,CAAsBO,GAAtB,EAA2BK,GAA3B,EAAgC;AAC5B,YAAIC,MAAM,GAAGE,MAAM,CAACR,GAAD,EAAMK,GAAN,CAAnB;;AACA,YAAIL,GAAG,CAACjL,SAAJ,OAAoB,GAAxB,EAA6B;AACzBuL,gBAAM,GAAG3T,cAAc,CAACoM,QAAQ,CAACzR,IAAV,CAAvB;AACH;;AACDgZ,cAAM,CAAC1V,qBAAP,CAA6ByV,GAAG,CAAC1V,kBAAJ,EAA7B;AACA,eAAO2V,MAAP;AACH;;AACD,aAAOb,YAAP;AACH;;AACD,aAASrY,WAAT,CAAqB4V,WAArB,EAAkCjE,QAAlC,EAA4C0D,QAA5C,EAAsD;AAClD,UAAIf,OAAO,GAAG3C,QAAQ,CAACR,aAAT,EAAd;AACA,UAAIpL,GAAG,GAAGsO,OAAO,CAACC,OAAD,CAAjB;AACA,UAAIpH,MAAM,GAAG,KAAb;AACA,UAAIiL,OAAO,GAAGvC,WAAW,CAACyD,qBAAZ,EAAd;AACA,UAAIC,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6ByL,eAAe,CAAC/C,WAAD,EAAcP,QAAd,CAA5C,EAAqE8C,OAArE,CAAlB;AACAmB,iBAAW,CAACjB,YAAZ,GAA2Bc,kBAAkB,CAACxH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;;AACD,aAASC,IAAT,CAAc3D,WAAd,EAA2BjE,QAA3B,EAAqC6H,SAArC,EAAgDC,SAAhD,EAA2DC,UAA3D,EAAuE;AACnE,UAAItB,SAAS,GAAG,EAAhB;;AACA,UAAIzG,QAAQ,CAACgI,MAAb,EAAqB;AACjBvB,iBAAS,CAAC,QAAD,CAAT,GAAsB,EAAtB;AACH,OAFD,MAGK;AACDA,iBAAS,CAAC,QAAD,CAAT,GAAsBzG,QAAQ,CAACzR,IAAT,GAAgB,GAAtC;AACH;;AACD,UAAIsZ,SAAS,IAAIA,SAAS,CAACpR,MAAV,GAAmB,CAApC,EAAuC;AACnCgQ,iBAAS,CAAC,WAAD,CAAT,GAAyBoB,SAAzB;AACH;;AACD,UAAIC,SAAJ,EAAe;AACXrB,iBAAS,CAAC,WAAD,CAAT,GAAyBqB,SAAzB;AACH;;AACD,UAAIC,UAAJ,EAAgB;AACZtB,iBAAS,CAAC,YAAD,CAAT,GAA0BsB,UAA1B;AACH;;AACD,UAAIpF,OAAO,GAAG3C,QAAQ,CAACL,mBAAT,EAAd;AACA,UAAIvL,GAAG,GAAGsO,OAAO,CAACC,OAAD,CAAjB;AACA,UAAIpH,MAAM,GAAG,KAAb;AACA,UAAIiL,OAAO,GAAGvC,WAAW,CAACyD,qBAAZ,EAAd;AACA,UAAIC,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6B4L,WAAW,CAAClD,WAAD,EAAcjE,QAAQ,CAAClM,MAAvB,CAAxC,EAAwE0S,OAAxE,CAAlB;AACAmB,iBAAW,CAAClB,SAAZ,GAAwBA,SAAxB;AACAkB,iBAAW,CAACjB,YAAZ,GAA2BW,kBAAkB,CAACrH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;;AACD,aAASM,cAAT,CAAwBhE,WAAxB,EAAqCjE,QAArC,EAA+C0D,QAA/C,EAAyD;AACrD,UAAIf,OAAO,GAAG3C,QAAQ,CAACR,aAAT,EAAd;AACA,UAAIpL,GAAG,GAAGsO,OAAO,CAACC,OAAD,CAAjB;AACA,UAAIpH,MAAM,GAAG,KAAb;AACA,UAAIiL,OAAO,GAAGvC,WAAW,CAACyD,qBAAZ,EAAd;AACA,UAAIC,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6B6L,kBAAkB,CAACnD,WAAD,EAAcP,QAAd,CAA/C,EAAwE8C,OAAxE,CAAlB;AACAmB,iBAAW,CAACjB,YAAZ,GAA2Bc,kBAAkB,CAACxH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;;AACD,aAASnZ,cAAT,CAAwByV,WAAxB,EAAqCjE,QAArC,EAA+CpR,QAA/C,EAAyD8U,QAAzD,EAAmE;AAC/D,UAAIf,OAAO,GAAG3C,QAAQ,CAACR,aAAT,EAAd;AACA,UAAIpL,GAAG,GAAGsO,OAAO,CAACC,OAAD,CAAjB;AACA,UAAIpH,MAAM,GAAG,OAAb;AACA,UAAIC,IAAI,GAAGyJ,gBAAgB,CAACrW,QAAD,EAAW8U,QAAX,CAA3B;AACA,UAAIjI,OAAO,GAAG;AAAE,wBAAgB;AAAlB,OAAd;AACA,UAAI+K,OAAO,GAAGvC,WAAW,CAACyD,qBAAZ,EAAd;AACA,UAAIC,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6ByL,eAAe,CAAC/C,WAAD,EAAcP,QAAd,CAA5C,EAAqE8C,OAArE,CAAlB;AACAmB,iBAAW,CAAClM,OAAZ,GAAsBA,OAAtB;AACAkM,iBAAW,CAACnM,IAAZ,GAAmBA,IAAnB;AACAmM,iBAAW,CAACjB,YAAZ,GAA2Bc,kBAAkB,CAACxH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;;AACD,aAASO,YAAT,CAAsBjE,WAAtB,EAAmCjE,QAAnC,EAA6C;AACzC,UAAI2C,OAAO,GAAG3C,QAAQ,CAACR,aAAT,EAAd;AACA,UAAIpL,GAAG,GAAGsO,OAAO,CAACC,OAAD,CAAjB;AACA,UAAIpH,MAAM,GAAG,QAAb;AACA,UAAIiL,OAAO,GAAGvC,WAAW,CAACyD,qBAAZ,EAAd;;AACA,eAASnB,OAAT,CAAiB4B,IAAjB,EAAuBC,KAAvB,EAA8B,CAAG;;AACjC,UAAIT,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6BgL,OAA7B,EAAsCC,OAAtC,CAAlB;AACAmB,iBAAW,CAACf,YAAZ,GAA2B,CAAC,GAAD,EAAM,GAAN,CAA3B;AACAe,iBAAW,CAACjB,YAAZ,GAA2Bc,kBAAkB,CAACxH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;;AACD,aAASU,qBAAT,CAA+BzZ,QAA/B,EAAyC4O,IAAzC,EAA+C;AAC3C,aAAS5O,QAAQ,IAAIA,QAAQ,CAAC,aAAD,CAArB,IACH4O,IAAI,IAAIA,IAAI,CAACzN,IAAL,EADL,IAEJ,0BAFJ;AAGH;;AACD,aAASuY,kBAAT,CAA4BtI,QAA5B,EAAsCxC,IAAtC,EAA4C5O,QAA5C,EAAsD;AAClD,UAAI2Z,aAAa,GAAGrY,MAAM,CAACsY,MAAP,CAAc,EAAd,EAAkB5Z,QAAlB,CAApB;AACA2Z,mBAAa,CAAC,UAAD,CAAb,GAA4BvI,QAAQ,CAACzR,IAArC;AACAga,mBAAa,CAAC,MAAD,CAAb,GAAwB/K,IAAI,CAACO,IAAL,EAAxB;;AACA,UAAI,CAACwK,aAAa,CAAC,aAAD,CAAlB,EAAmC;AAC/BA,qBAAa,CAAC,aAAD,CAAb,GAA+BF,qBAAqB,CAAC,IAAD,EAAO7K,IAAP,CAApD;AACH;;AACD,aAAO+K,aAAP;AACH;;AACD,aAASE,eAAT,CAAyBxE,WAAzB,EAAsCjE,QAAtC,EAAgD0D,QAAhD,EAA0DlG,IAA1D,EAAgE5O,QAAhE,EAA0E;AACtE,UAAI+T,OAAO,GAAG3C,QAAQ,CAACL,mBAAT,EAAd;AACA,UAAIlE,OAAO,GAAG;AACV,kCAA0B;AADhB,OAAd;;AAGA,eAASiN,WAAT,GAAuB;AACnB,YAAIC,GAAG,GAAG,EAAV;;AACA,aAAK,IAAInS,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxBmS,aAAG,GAAGA,GAAG,GAAGC,IAAI,CAACC,MAAL,GAAc/M,QAAd,GAAyB8B,KAAzB,CAA+B,CAA/B,CAAZ;AACH;;AACD,eAAO+K,GAAP;AACH;;AACD,UAAIG,QAAQ,GAAGJ,WAAW,EAA1B;AACAjN,aAAO,CAAC,cAAD,CAAP,GAA0B,iCAAiCqN,QAA3D;AACA,UAAIC,SAAS,GAAGT,kBAAkB,CAACtI,QAAD,EAAWxC,IAAX,EAAiB5O,QAAjB,CAAlC;AACA,UAAIoa,cAAc,GAAG/D,gBAAgB,CAAC8D,SAAD,EAAYrF,QAAZ,CAArC;AACA,UAAIuF,WAAW,GAAG,OACdH,QADc,GAEd,MAFc,GAGd,uDAHc,GAIdE,cAJc,GAKd,QALc,GAMdF,QANc,GAOd,MAPc,GAQd,gBARc,GASdC,SAAS,CAAC,aAAD,CATK,GAUd,UAVJ;AAWA,UAAIG,YAAY,GAAG,WAAWJ,QAAX,GAAsB,IAAzC;AACA,UAAItN,IAAI,GAAGqC,OAAO,CAACZ,OAAR,CAAgBgM,WAAhB,EAA6BzL,IAA7B,EAAmC0L,YAAnC,CAAX;;AACA,UAAI1N,IAAI,KAAK,IAAb,EAAmB;AACf,cAAMlH,eAAe,EAArB;AACH;;AACD,UAAImS,SAAS,GAAG;AAAErR,YAAI,EAAE2T,SAAS,CAAC,UAAD;AAAjB,OAAhB;AACA,UAAI3U,GAAG,GAAGsO,OAAO,CAACC,OAAD,CAAjB;AACA,UAAIpH,MAAM,GAAG,MAAb;AACA,UAAIiL,OAAO,GAAGvC,WAAW,CAACkF,kBAAZ,EAAd;AACA,UAAIxB,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6ByL,eAAe,CAAC/C,WAAD,EAAcP,QAAd,CAA5C,EAAqE8C,OAArE,CAAlB;AACAmB,iBAAW,CAAClB,SAAZ,GAAwBA,SAAxB;AACAkB,iBAAW,CAAClM,OAAZ,GAAsBA,OAAtB;AACAkM,iBAAW,CAACnM,IAAZ,GAAmBA,IAAI,CAAC6D,UAAL,EAAnB;AACAsI,iBAAW,CAACjB,YAAZ,GAA2BW,kBAAkB,CAACrH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;AACD;;;;;;;;;;AAQA,QAAIyB,qBAAqB;AAAG;AAAe,gBAAY;AACnD,eAASA,qBAAT,CAA+BC,OAA/B,EAAwCC,KAAxC,EAA+CC,SAA/C,EAA0D3a,QAA1D,EAAoE;AAChE,aAAKya,OAAL,GAAeA,OAAf;AACA,aAAKC,KAAL,GAAaA,KAAb;AACA,aAAKC,SAAL,GAAiB,CAAC,CAACA,SAAnB;AACA,aAAK3a,QAAL,GAAgBA,QAAQ,IAAI,IAA5B;AACH;;AACD,aAAOwa,qBAAP;AACH,KAR0C,EAA3C;;AASA,aAASI,kBAAT,CAA4BvC,GAA5B,EAAiCwC,OAAjC,EAA0C;AACtC,UAAIxN,MAAM,GAAG,IAAb;;AACA,UAAI;AACAA,cAAM,GAAGgL,GAAG,CAAC5K,iBAAJ,CAAsB,sBAAtB,CAAT;AACH,OAFD,CAGA,OAAOzP,CAAP,EAAU;AACNka,oBAAY,CAAC,KAAD,CAAZ;AACH;;AACD,UAAI4C,aAAa,GAAGD,OAAO,IAAI,CAAC,QAAD,CAA/B;AACA3C,kBAAY,CAAC,CAAC,CAAC7K,MAAF,IAAYyN,aAAa,CAACrS,OAAd,CAAsB4E,MAAtB,MAAkC,CAAC,CAAhD,CAAZ;AACA,aAAOA,MAAP;AACH;;AACD,aAAS0N,qBAAT,CAA+B1F,WAA/B,EAA4CjE,QAA5C,EAAsD0D,QAAtD,EAAgElG,IAAhE,EAAsE5O,QAAtE,EAAgF;AAC5E,UAAI+T,OAAO,GAAG3C,QAAQ,CAACL,mBAAT,EAAd;AACA,UAAIiK,iBAAiB,GAAGtB,kBAAkB,CAACtI,QAAD,EAAWxC,IAAX,EAAiB5O,QAAjB,CAA1C;AACA,UAAI6X,SAAS,GAAG;AAAErR,YAAI,EAAEwU,iBAAiB,CAAC,UAAD;AAAzB,OAAhB;AACA,UAAIxV,GAAG,GAAGsO,OAAO,CAACC,OAAD,CAAjB;AACA,UAAIpH,MAAM,GAAG,MAAb;AACA,UAAIE,OAAO,GAAG;AACV,kCAA0B,WADhB;AAEV,iCAAyB,OAFf;AAGV,+CAAuC+B,IAAI,CAACO,IAAL,EAH7B;AAIV,6CAAqC6L,iBAAiB,CAAC,aAAD,CAJ5C;AAKV,wBAAgB;AALN,OAAd;AAOA,UAAIpO,IAAI,GAAGyJ,gBAAgB,CAAC2E,iBAAD,EAAoBlG,QAApB,CAA3B;AACA,UAAI8C,OAAO,GAAGvC,WAAW,CAACkF,kBAAZ,EAAd;;AACA,eAAS5C,OAAT,CAAiBU,GAAjB,EAAsB;AAClBuC,0BAAkB,CAACvC,GAAD,CAAlB;AACA,YAAI7S,GAAJ;;AACA,YAAI;AACAA,aAAG,GAAG6S,GAAG,CAAC5K,iBAAJ,CAAsB,mBAAtB,CAAN;AACH,SAFD,CAGA,OAAOzP,CAAP,EAAU;AACNka,sBAAY,CAAC,KAAD,CAAZ;AACH;;AACDA,oBAAY,CAAC9M,QAAQ,CAAC5F,GAAD,CAAT,CAAZ;AACA,eAAOA,GAAP;AACH;;AACD,UAAIuT,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6BgL,OAA7B,EAAsCC,OAAtC,CAAlB;AACAmB,iBAAW,CAAClB,SAAZ,GAAwBA,SAAxB;AACAkB,iBAAW,CAAClM,OAAZ,GAAsBA,OAAtB;AACAkM,iBAAW,CAACnM,IAAZ,GAAmBA,IAAnB;AACAmM,iBAAW,CAACjB,YAAZ,GAA2BW,kBAAkB,CAACrH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;AACD;;;;;AAGA,aAASkC,wBAAT,CAAkC5F,WAAlC,EAA+CjE,QAA/C,EAAyD5L,GAAzD,EAA8DoJ,IAA9D,EAAoE;AAChE,UAAI/B,OAAO,GAAG;AAAE,iCAAyB;AAA3B,OAAd;;AACA,eAAS8K,OAAT,CAAiBU,GAAjB,EAAsB;AAClB,YAAIhL,MAAM,GAAGuN,kBAAkB,CAACvC,GAAD,EAAM,CAAC,QAAD,EAAW,OAAX,CAAN,CAA/B;AACA,YAAI6C,UAAU,GAAG,IAAjB;;AACA,YAAI;AACAA,oBAAU,GAAG7C,GAAG,CAAC5K,iBAAJ,CAAsB,6BAAtB,CAAb;AACH,SAFD,CAGA,OAAOzP,CAAP,EAAU;AACNka,sBAAY,CAAC,KAAD,CAAZ;AACH;;AACD,YAAI,CAACgD,UAAL,EAAiB;AACb;AACAhD,sBAAY,CAAC,KAAD,CAAZ;AACH;;AACD,YAAI/I,IAAI,GAAG3D,MAAM,CAAC0P,UAAD,CAAjB;AACAhD,oBAAY,CAAC,CAACiD,KAAK,CAAChM,IAAD,CAAP,CAAZ;AACA,eAAO,IAAIqL,qBAAJ,CAA0BrL,IAA1B,EAAgCP,IAAI,CAACO,IAAL,EAAhC,EAA6C9B,MAAM,KAAK,OAAxD,CAAP;AACH;;AACD,UAAIV,MAAM,GAAG,MAAb;AACA,UAAIiL,OAAO,GAAGvC,WAAW,CAACkF,kBAAZ,EAAd;AACA,UAAIxB,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6BgL,OAA7B,EAAsCC,OAAtC,CAAlB;AACAmB,iBAAW,CAAClM,OAAZ,GAAsBA,OAAtB;AACAkM,iBAAW,CAACjB,YAAZ,GAA2BW,kBAAkB,CAACrH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;AACD;;;;;;AAIA,QAAIqC,wBAAwB,GAAG,MAAM,IAArC;AACA;;;;;;;;;;AASA,aAASC,uBAAT,CAAiCjK,QAAjC,EAA2CiE,WAA3C,EAAwD7P,GAAxD,EAA6DoJ,IAA7D,EAAmE0M,SAAnE,EAA8ExG,QAA9E,EAAwFzH,MAAxF,EAAgG0K,gBAAhG,EAAkH;AAC9G;AACA;AACA,UAAIwD,OAAO,GAAG,IAAIf,qBAAJ,CAA0B,CAA1B,EAA6B,CAA7B,CAAd;;AACA,UAAInN,MAAJ,EAAY;AACRkO,eAAO,CAACd,OAAR,GAAkBpN,MAAM,CAACoN,OAAzB;AACAc,eAAO,CAACb,KAAR,GAAgBrN,MAAM,CAACqN,KAAvB;AACH,OAHD,MAIK;AACDa,eAAO,CAACd,OAAR,GAAkB,CAAlB;AACAc,eAAO,CAACb,KAAR,GAAgB9L,IAAI,CAACO,IAAL,EAAhB;AACH;;AACD,UAAIP,IAAI,CAACO,IAAL,OAAgBoM,OAAO,CAACb,KAA5B,EAAmC;AAC/B,cAAM/U,mBAAmB,EAAzB;AACH;;AACD,UAAI6V,SAAS,GAAGD,OAAO,CAACb,KAAR,GAAgBa,OAAO,CAACd,OAAxC;AACA,UAAIgB,aAAa,GAAGD,SAApB;;AACA,UAAIF,SAAS,GAAG,CAAhB,EAAmB;AACfG,qBAAa,GAAGzB,IAAI,CAAC0B,GAAL,CAASD,aAAT,EAAwBH,SAAxB,CAAhB;AACH;;AACD,UAAI3L,SAAS,GAAG4L,OAAO,CAACd,OAAxB;AACA,UAAI7K,OAAO,GAAGD,SAAS,GAAG8L,aAA1B;AACA,UAAIE,aAAa,GAAGF,aAAa,KAAKD,SAAlB,GAA8B,kBAA9B,GAAmD,QAAvE;AACA,UAAI3O,OAAO,GAAG;AACV,iCAAyB8O,aADf;AAEV,gCAAwBJ,OAAO,CAACd;AAFtB,OAAd;AAIA,UAAI7N,IAAI,GAAGgC,IAAI,CAACI,KAAL,CAAWW,SAAX,EAAsBC,OAAtB,CAAX;;AACA,UAAIhD,IAAI,KAAK,IAAb,EAAmB;AACf,cAAMlH,eAAe,EAArB;AACH;;AACD,eAASiS,OAAT,CAAiBU,GAAjB,EAAsBC,IAAtB,EAA4B;AACxB;AACA;AACA;AACA;AACA,YAAIsD,YAAY,GAAGhB,kBAAkB,CAACvC,GAAD,EAAM,CAAC,QAAD,EAAW,OAAX,CAAN,CAArC;AACA,YAAIwD,UAAU,GAAGN,OAAO,CAACd,OAAR,GAAkBgB,aAAnC;AACA,YAAItM,IAAI,GAAGP,IAAI,CAACO,IAAL,EAAX;AACA,YAAInP,QAAJ;;AACA,YAAI4b,YAAY,KAAK,OAArB,EAA8B;AAC1B5b,kBAAQ,GAAGoY,eAAe,CAAC/C,WAAD,EAAcP,QAAd,CAAf,CAAuCuD,GAAvC,EAA4CC,IAA5C,CAAX;AACH,SAFD,MAGK;AACDtY,kBAAQ,GAAG,IAAX;AACH;;AACD,eAAO,IAAIwa,qBAAJ,CAA0BqB,UAA1B,EAAsC1M,IAAtC,EAA4CyM,YAAY,KAAK,OAA7D,EAAsE5b,QAAtE,CAAP;AACH;;AACD,UAAI2M,MAAM,GAAG,MAAb;AACA,UAAIiL,OAAO,GAAGvC,WAAW,CAACkF,kBAAZ,EAAd;AACA,UAAIxB,WAAW,GAAG,IAAIrB,WAAJ,CAAgBlS,GAAhB,EAAqBmH,MAArB,EAA6BgL,OAA7B,EAAsCC,OAAtC,CAAlB;AACAmB,iBAAW,CAAClM,OAAZ,GAAsBA,OAAtB;AACAkM,iBAAW,CAACnM,IAAZ,GAAmBA,IAAI,CAAC6D,UAAL,EAAnB;AACAsI,iBAAW,CAAChB,gBAAZ,GAA+BA,gBAAgB,IAAI,IAAnD;AACAgB,iBAAW,CAACjB,YAAZ,GAA2BW,kBAAkB,CAACrH,QAAD,CAA7C;AACA,aAAO2H,WAAP;AACH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;AAGA,QAAI+C,QAAQ;AAAG;AAAe,gBAAY;AACtC,eAASA,QAAT,CAAkBC,cAAlB,EAAkChe,KAAlC,EAAyCE,QAAzC,EAAmD;AAC/C,YAAI+d,WAAW,GAAGlR,UAAU,CAACiR,cAAD,CAAV,IACdpR,KAAK,CAAC5M,KAAD,CADS,IAEd4M,KAAK,CAAC1M,QAAD,CAFT;;AAGA,YAAI+d,WAAJ,EAAiB;AACb,eAAKle,IAAL,GAAYie,cAAZ;AACA,eAAKhe,KAAL,GAAaA,KAAK,IAAI,IAAtB;AACA,eAAKE,QAAL,GAAgBA,QAAQ,IAAI,IAA5B;AACH,SAJD,MAKK;AACD,cAAIge,QAAQ,GAAGF,cAAf;AACA,eAAKje,IAAL,GAAYme,QAAQ,CAACne,IAAT,IAAiB,IAA7B;AACA,eAAKC,KAAL,GAAake,QAAQ,CAACle,KAAT,IAAkB,IAA/B;AACA,eAAKE,QAAL,GAAgBge,QAAQ,CAAChe,QAAT,IAAqB,IAArC;AACH;AACJ;;AACD,aAAO6d,QAAP;AACH,KAlB6B,EAA9B;;AAoBA,QAAII,kBAAkB;AAAG;AAAe,gBAAY;AAChD,eAASA,kBAAT,CAA4Bnd,gBAA5B,EAA8CC,UAA9C,EAA0D0L,KAA1D,EAAiE1K,QAAjE,EAA2EtC,IAA3E,EAAiFyB,GAAjF,EAAsF;AAClF,aAAKJ,gBAAL,GAAwBA,gBAAxB;AACA,aAAKC,UAAL,GAAkBA,UAAlB;AACA,aAAK0L,KAAL,GAAaA,KAAb;AACA,aAAK1K,QAAL,GAAgBA,QAAhB;AACA,aAAKtC,IAAL,GAAYA,IAAZ;AACA,aAAKyB,GAAL,GAAWA,GAAX;AACH;;AACD,aAAO+c,kBAAP;AACH,KAVuC,EAAxC;AAYA;;;;;;;;;;;;;;;;;AAgBA;;;;;;;;AAMA,aAASC,QAAT,CAAkB3V,IAAlB,EAAwB4V,KAAxB,EAA+BC,MAA/B,EAAuC;AACnC,UAAIC,OAAO,GAAGF,KAAK,CAACvU,MAApB;AACA,UAAI0U,OAAO,GAAGH,KAAK,CAACvU,MAApB;;AACA,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwU,KAAK,CAACvU,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,YAAIwU,KAAK,CAACxU,CAAD,CAAL,CAAS4U,QAAb,EAAuB;AACnBF,iBAAO,GAAG1U,CAAV;AACA;AACH;AACJ;;AACD,UAAI6U,WAAW,GAAGH,OAAO,IAAID,MAAM,CAACxU,MAAlB,IAA4BwU,MAAM,CAACxU,MAAP,IAAiB0U,OAA/D;;AACA,UAAI,CAACE,WAAL,EAAkB;AACd,cAAMzW,oBAAoB,CAACsW,OAAD,EAAUC,OAAV,EAAmB/V,IAAnB,EAAyB6V,MAAM,CAACxU,MAAhC,CAA1B;AACH;;AACD,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyU,MAAM,CAACxU,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpC,YAAI;AACAwU,eAAK,CAACxU,CAAD,CAAL,CAAS8U,SAAT,CAAmBL,MAAM,CAACzU,CAAD,CAAzB;AACH,SAFD,CAGA,OAAO5J,CAAP,EAAU;AACN,cAAIA,CAAC,YAAY0Q,KAAjB,EAAwB;AACpB,kBAAM7I,eAAe,CAAC+B,CAAD,EAAIpB,IAAJ,EAAUxI,CAAC,CAACuE,OAAZ,CAArB;AACH,WAFD,MAGK;AACD,kBAAMsD,eAAe,CAAC+B,CAAD,EAAIpB,IAAJ,EAAUxI,CAAV,CAArB;AACH;AACJ;AACJ;AACJ;AACD;;;;;AAGA,QAAI2e,OAAO;AAAG;AAAe,gBAAY;AACrC,eAASA,OAAT,CAAiBD,SAAjB,EAA4BF,QAA5B,EAAsC;AAClC,YAAII,IAAI,GAAG,IAAX;;AACA,aAAKF,SAAL,GAAiB,UAAU9R,CAAV,EAAa;AAC1B,cAAIgS,IAAI,CAACJ,QAAL,IAAiB,CAAC3R,SAAS,CAACD,CAAD,CAA/B,EAAoC;AAChC;AACH;;AACD8R,mBAAS,CAAC9R,CAAD,CAAT;AACH,SALD;;AAMA,aAAK4R,QAAL,GAAgB,CAAC,CAACA,QAAlB;AACH;;AACD,aAAOG,OAAP;AACH,KAZ4B,EAA7B;;AAaA,aAASE,IAAT,CAAcC,EAAd,EAAkBC,EAAlB,EAAsB;AAClB,aAAO,UAAUnS,CAAV,EAAa;AAChBkS,UAAE,CAAClS,CAAD,CAAF;AACAmS,UAAE,CAACnS,CAAD,CAAF;AACH,OAHD;AAIH;;AACD,aAASoS,UAAT,CAAoBN,SAApB,EAA+BF,QAA/B,EAAyC;AACrC,eAASS,eAAT,CAAyBrS,CAAzB,EAA4B;AACxB,YAAI,CAACQ,QAAQ,CAACR,CAAD,CAAb,EAAkB;AACd,gBAAM,kBAAN;AACH;AACJ;;AACD,UAAIsS,gBAAJ;;AACA,UAAIR,SAAJ,EAAe;AACXQ,wBAAgB,GAAGL,IAAI,CAACI,eAAD,EAAkBP,SAAlB,CAAvB;AACH,OAFD,MAGK;AACDQ,wBAAgB,GAAGD,eAAnB;AACH;;AACD,aAAO,IAAIN,OAAJ,CAAYO,gBAAZ,EAA8BV,QAA9B,CAAP;AACH;;AACD,aAASW,cAAT,GAA0B;AACtB,eAAST,SAAT,CAAmB9R,CAAnB,EAAsB;AAClB,YAAI3C,KAAK,GAAG2C,CAAC,YAAYxC,UAAb,IACRwC,CAAC,YAAY0E,WADL,IAEP5D,mBAAmB,MAAMd,CAAC,YAAYe,IAF3C;;AAGA,YAAI,CAAC1D,KAAL,EAAY;AACR,gBAAM,wBAAN;AACH;AACJ;;AACD,aAAO,IAAI0U,OAAJ,CAAYD,SAAZ,CAAP;AACH;;AACD,aAASU,YAAT,CAAsBZ,QAAtB,EAAgC;AAC5B,aAAO,IAAIG,OAAJ,CAAYpG,iBAAZ,EAA+BiG,QAA/B,CAAP;AACH;;AACD,aAASa,cAAT,CAAwBb,QAAxB,EAAkC;AAC9B,aAAO,IAAIG,OAAJ,CAAYlF,oBAAZ,EAAkC+E,QAAlC,CAAP;AACH;;AACD,aAASc,qBAAT,GAAiC;AAC7B,eAASZ,SAAT,CAAmB9R,CAAnB,EAAsB;AAClB,YAAI3C,KAAK,GAAGsD,QAAQ,CAACX,CAAD,CAAR,IAAeA,CAAC,IAAI,CAAhC;;AACA,YAAI,CAAC3C,KAAL,EAAY;AACR,gBAAM,iCAAN;AACH;AACJ;;AACD,aAAO,IAAI0U,OAAJ,CAAYD,SAAZ,CAAP;AACH;;AACD,aAASa,eAAT,CAAyBb,SAAzB,EAAoCF,QAApC,EAA8C;AAC1C,eAASgB,sBAAT,CAAgC5S,CAAhC,EAAmC;AAC/B,YAAI6S,aAAa,GAAG7S,CAAC,KAAK,IAAN,IAAeD,KAAK,CAACC,CAAD,CAAL,IAAYA,CAAC,YAAYtJ,MAA5D;;AACA,YAAI,CAACmc,aAAL,EAAoB;AAChB,gBAAM,qBAAN;AACH;;AACD,YAAIf,SAAS,KAAKnd,SAAd,IAA2Bmd,SAAS,KAAK,IAA7C,EAAmD;AAC/CA,mBAAS,CAAC9R,CAAD,CAAT;AACH;AACJ;;AACD,aAAO,IAAI+R,OAAJ,CAAYa,sBAAZ,EAAoChB,QAApC,CAAP;AACH;;AACD,aAASkB,gBAAT,CAA0BlB,QAA1B,EAAoC;AAChC,eAASE,SAAT,CAAmB9R,CAAnB,EAAsB;AAClB,YAAI3C,KAAK,GAAG2C,CAAC,KAAK,IAAN,IAAcE,UAAU,CAACF,CAAD,CAApC;;AACA,YAAI,CAAC3C,KAAL,EAAY;AACR,gBAAM,sBAAN;AACH;AACJ;;AACD,aAAO,IAAI0U,OAAJ,CAAYD,SAAZ,EAAuBF,QAAvB,CAAP;AACH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;;;AAKA,aAASmB,KAAT,CAAeC,CAAf,EAAkB;AACd,aAAO,YAAY;AACf,YAAIC,aAAa,GAAG,EAApB;;AACA,aAAK,IAAIvP,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAAC1G,MAAhC,EAAwCyG,EAAE,EAA1C,EAA8C;AAC1CuP,uBAAa,CAACvP,EAAD,CAAb,GAAoBC,SAAS,CAACD,EAAD,CAA7B;AACH,SAJc,CAKf;;;AACAjC,eAAO,CAACC,OAAR,GAAkB/N,IAAlB,CAAuB,YAAY;AAAE,iBAAOqf,CAAC,CAACzN,KAAF,CAAQ,KAAK,CAAb,EAAgB0N,aAAhB,CAAP;AAAwC,SAA7E;AACH,OAPD;AAQH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;;AAIA,QAAIC,UAAU;AAAG;AAAe,gBAAY;AACxC;;;;;AAKA,eAASA,UAAT,CAAoB3e,GAApB,EAAyBkW,WAAzB,EAAsCjE,QAAtC,EAAgD0D,QAAhD,EAA0DlG,IAA1D,EAAgE5O,QAAhE,EAA0E;AACtE,YAAI8L,KAAK,GAAG,IAAZ;;AACA,YAAI9L,QAAQ,KAAK,KAAK,CAAtB,EAAyB;AAAEA,kBAAQ,GAAG,IAAX;AAAkB;;AAC7C,aAAK+d,YAAL,GAAoB,CAApB;AACA,aAAKC,kBAAL,GAA0B,KAA1B;AACA,aAAKC,oBAAL,GAA4B,KAA5B;AACA,aAAKC,UAAL,GAAkB,EAAlB;AACA,aAAKC,MAAL,GAAc,IAAd;AACA,aAAKC,UAAL,GAAkB,IAAlB;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,gBAAL,GAAwB,CAAxB;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,OAAL,GAAe,IAAf;AACA,aAAKC,IAAL,GAAYtf,GAAZ;AACA,aAAKuf,YAAL,GAAoBrJ,WAApB;AACA,aAAKsJ,SAAL,GAAiBvN,QAAjB;AACA,aAAKwN,KAAL,GAAahQ,IAAb;AACA,aAAKuL,SAAL,GAAiBna,QAAjB;AACA,aAAK0U,SAAL,GAAiBI,QAAjB;AACA,aAAK+J,UAAL,GAAkB,KAAKC,kBAAL,CAAwB,KAAKF,KAA7B,CAAlB;AACA,aAAKG,MAAL,GAAc9U,iBAAiB,CAACC,OAAhC;;AACA,aAAK8U,aAAL,GAAqB,UAAUjhB,KAAV,EAAiB;AAClC+N,eAAK,CAACuS,QAAN,GAAiB,IAAjB;AACAvS,eAAK,CAACwS,gBAAN,GAAyB,CAAzB;;AACA,cAAIvgB,KAAK,CAACgF,UAAN,CAAiBQ,IAAI,CAACU,QAAtB,CAAJ,EAAqC;AACjC6H,iBAAK,CAACkS,kBAAN,GAA2B,IAA3B;;AACAlS,iBAAK,CAACmT,oBAAN;AACH,WAHD,MAIK;AACDnT,iBAAK,CAACqS,MAAN,GAAepgB,KAAf;;AACA+N,iBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAACM,KAApC;AACH;AACJ,SAXD;;AAYA,aAAK4U,qBAAL,GAA6B,UAAUphB,KAAV,EAAiB;AAC1C+N,eAAK,CAACuS,QAAN,GAAiB,IAAjB;;AACA,cAAItgB,KAAK,CAACgF,UAAN,CAAiBQ,IAAI,CAACU,QAAtB,CAAJ,EAAqC;AACjC6H,iBAAK,CAACmT,oBAAN;AACH,WAFD,MAGK;AACDnT,iBAAK,CAACqS,MAAN,GAAepgB,KAAf;;AACA+N,iBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAACM,KAApC;AACH;AACJ,SATD;;AAUA,aAAK6U,QAAL,GAAgB,IAAI/S,OAAJ,CAAY,UAAUC,OAAV,EAAmB+S,MAAnB,EAA2B;AACnDvT,eAAK,CAACyS,QAAN,GAAiBjS,OAAjB;AACAR,eAAK,CAAC0S,OAAN,GAAgBa,MAAhB;;AACAvT,eAAK,CAACwT,MAAN;AACH,SAJe,CAAhB,CA3CsE,CAgDtE;AACA;;AACA,aAAKF,QAAL,CAAc7gB,IAAd,CAAmB,IAAnB,EAAyB,YAAY,CAAG,CAAxC;AACH;;AACDuf,gBAAU,CAACjb,SAAX,CAAqB0c,qBAArB,GAA6C,YAAY;AACrD,YAAIzT,KAAK,GAAG,IAAZ;;AACA,YAAI0T,UAAU,GAAG,KAAKzB,YAAtB;AACA,eAAO,UAAU0B,MAAV,EAAkB;AAAE,iBAAO3T,KAAK,CAAC4T,eAAN,CAAsBF,UAAU,GAAGC,MAAnC,CAAP;AAAoD,SAA/E;AACH,OAJD;;AAKA3B,gBAAU,CAACjb,SAAX,CAAqBic,kBAArB,GAA0C,UAAUlQ,IAAV,EAAgB;AACtD,eAAOA,IAAI,CAACO,IAAL,KAAc,MAAM,IAA3B;AACH,OAFD;;AAGA2O,gBAAU,CAACjb,SAAX,CAAqByc,MAArB,GAA8B,YAAY;AACtC,YAAI,KAAKP,MAAL,KAAgB9U,iBAAiB,CAACC,OAAtC,EAA+C;AAC3C;AACA;AACH;;AACD,YAAI,KAAKmU,QAAL,KAAkB,IAAtB,EAA4B;AACxB;AACH;;AACD,YAAI,KAAKQ,UAAT,EAAqB;AACjB,cAAI,KAAKT,UAAL,KAAoB,IAAxB,EAA8B;AAC1B,iBAAKuB,gBAAL;AACH,WAFD,MAGK;AACD,gBAAI,KAAK3B,kBAAT,EAA6B;AACzB,mBAAK4B,YAAL;AACH,aAFD,MAGK;AACD,kBAAI,KAAK3B,oBAAT,EAA+B;AAC3B;AACA,qBAAK4B,cAAL;AACH,eAHD,MAIK;AACD,qBAAKC,eAAL;AACH;AACJ;AACJ;AACJ,SAlBD,MAmBK;AACD,eAAKC,cAAL;AACH;AACJ,OA9BD;;AA+BAjC,gBAAU,CAACjb,SAAX,CAAqBmd,aAArB,GAAqC,UAAUC,QAAV,EAAoB;AACrD,YAAInU,KAAK,GAAG,IAAZ,CADqD,CAErD;;;AACA,aAAK4S,YAAL,CAAkBwB,YAAlB,GAAiC3hB,IAAjC,CAAsC,UAAU4hB,SAAV,EAAqB;AACvD,kBAAQrU,KAAK,CAACiT,MAAd;AACI,iBAAK9U,iBAAiB,CAACC,OAAvB;AACI+V,sBAAQ,CAACE,SAAD,CAAR;AACA;;AACJ,iBAAKlW,iBAAiB,CAACK,SAAvB;AACIwB,mBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAAChG,QAApC;;AACA;;AACJ,iBAAKgG,iBAAiB,CAACE,OAAvB;AACI2B,mBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAACG,MAApC;;AACA;AATR;AAWH,SAZD;AAaH,OAhBD,CAjGwC,CAkHxC;;;AACA0T,gBAAU,CAACjb,SAAX,CAAqB8c,gBAArB,GAAwC,YAAY;AAChD,YAAI7T,KAAK,GAAG,IAAZ;;AACA,aAAKkU,aAAL,CAAmB,UAAUG,SAAV,EAAqB;AACpC,cAAIpH,WAAW,GAAGgC,qBAAqB,CAACjP,KAAK,CAAC4S,YAAP,EAAqB5S,KAAK,CAAC6S,SAA3B,EAAsC7S,KAAK,CAAC4I,SAA5C,EAAuD5I,KAAK,CAAC8S,KAA7D,EAAoE9S,KAAK,CAACqO,SAA1E,CAAvC;;AACA,cAAIiG,aAAa,GAAGtU,KAAK,CAAC4S,YAAN,CAAmB2B,WAAnB,CAA+BtH,WAA/B,EAA4CoH,SAA5C,CAApB;;AACArU,eAAK,CAACuS,QAAN,GAAiB+B,aAAjB;AACAA,uBAAa,CAACE,UAAd,GAA2B/hB,IAA3B,CAAgC,UAAUiH,GAAV,EAAe;AAC3CsG,iBAAK,CAACuS,QAAN,GAAiB,IAAjB;AACAvS,iBAAK,CAACsS,UAAN,GAAmB5Y,GAAnB;AACAsG,iBAAK,CAACkS,kBAAN,GAA2B,KAA3B;;AACAlS,iBAAK,CAACmT,oBAAN;AACH,WALD,EAKGnT,KAAK,CAACkT,aALT;AAMH,SAVD;AAWH,OAbD;;AAcAlB,gBAAU,CAACjb,SAAX,CAAqB+c,YAArB,GAAoC,YAAY;AAC5C,YAAI9T,KAAK,GAAG,IAAZ,CAD4C,CAE5C;;;AACA,YAAItG,GAAG,GAAG,KAAK4Y,UAAf;AACA,aAAK4B,aAAL,CAAmB,UAAUG,SAAV,EAAqB;AACpC,cAAIpH,WAAW,GAAGkC,wBAAwB,CAACnP,KAAK,CAAC4S,YAAP,EAAqB5S,KAAK,CAAC6S,SAA3B,EAAsCnZ,GAAtC,EAA2CsG,KAAK,CAAC8S,KAAjD,CAA1C;;AACA,cAAI2B,aAAa,GAAGzU,KAAK,CAAC4S,YAAN,CAAmB2B,WAAnB,CAA+BtH,WAA/B,EAA4CoH,SAA5C,CAApB;;AACArU,eAAK,CAACuS,QAAN,GAAiBkC,aAAjB;AACAA,uBAAa,CAACD,UAAd,GAA2B/hB,IAA3B,CAAgC,UAAU8O,MAAV,EAAkB;AAC9CA,kBAAM,GAAGA,MAAT;AACAvB,iBAAK,CAACuS,QAAN,GAAiB,IAAjB;;AACAvS,iBAAK,CAAC4T,eAAN,CAAsBrS,MAAM,CAACoN,OAA7B;;AACA3O,iBAAK,CAACkS,kBAAN,GAA2B,KAA3B;;AACA,gBAAI3Q,MAAM,CAACsN,SAAX,EAAsB;AAClB7O,mBAAK,CAACmS,oBAAN,GAA6B,IAA7B;AACH;;AACDnS,iBAAK,CAACmT,oBAAN;AACH,WATD,EASGnT,KAAK,CAACkT,aATT;AAUH,SAdD;AAeH,OAnBD;;AAoBAlB,gBAAU,CAACjb,SAAX,CAAqBid,eAArB,GAAuC,YAAY;AAC/C,YAAIhU,KAAK,GAAG,IAAZ;;AACA,YAAIwP,SAAS,GAAGF,wBAAwB,GAAG,KAAKkD,gBAAhD;AACA,YAAIjR,MAAM,GAAG,IAAImN,qBAAJ,CAA0B,KAAKuD,YAA/B,EAA6C,KAAKa,KAAL,CAAWzP,IAAX,EAA7C,CAAb,CAH+C,CAI/C;;AACA,YAAI3J,GAAG,GAAG,KAAK4Y,UAAf;AACA,aAAK4B,aAAL,CAAmB,UAAUG,SAAV,EAAqB;AACpC,cAAIpH,WAAJ;;AACA,cAAI;AACAA,uBAAW,GAAGsC,uBAAuB,CAACvP,KAAK,CAAC6S,SAAP,EAAkB7S,KAAK,CAAC4S,YAAxB,EAAsClZ,GAAtC,EAA2CsG,KAAK,CAAC8S,KAAjD,EAAwDtD,SAAxD,EAAmExP,KAAK,CAAC4I,SAAzE,EAAoFrH,MAApF,EAA4FvB,KAAK,CAACyT,qBAAN,EAA5F,CAArC;AACH,WAFD,CAGA,OAAOvhB,CAAP,EAAU;AACN8N,iBAAK,CAACqS,MAAN,GAAengB,CAAf;;AACA8N,iBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAACM,KAApC;;AACA;AACH;;AACD,cAAIiW,aAAa,GAAG1U,KAAK,CAAC4S,YAAN,CAAmB2B,WAAnB,CAA+BtH,WAA/B,EAA4CoH,SAA5C,CAApB;;AACArU,eAAK,CAACuS,QAAN,GAAiBmC,aAAjB;AACAA,uBAAa,CACRF,UADL,GAEK/hB,IAFL,CAEU,UAAUkiB,SAAV,EAAqB;AAC3B3U,iBAAK,CAAC4U,mBAAN;;AACA5U,iBAAK,CAACuS,QAAN,GAAiB,IAAjB;;AACAvS,iBAAK,CAAC4T,eAAN,CAAsBe,SAAS,CAAChG,OAAhC;;AACA,gBAAIgG,SAAS,CAAC9F,SAAd,EAAyB;AACrB7O,mBAAK,CAACqO,SAAN,GAAkBsG,SAAS,CAACzgB,QAA5B;;AACA8L,mBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAACI,OAApC;AACH,aAHD,MAIK;AACDyB,mBAAK,CAACmT,oBAAN;AACH;AACJ,WAbD,EAaGnT,KAAK,CAACkT,aAbT;AAcH,SA1BD;AA2BH,OAjCD;;AAkCAlB,gBAAU,CAACjb,SAAX,CAAqB6d,mBAArB,GAA2C,YAAY;AACnD,YAAIC,WAAW,GAAGvF,wBAAwB,GAAG,KAAKkD,gBAAlD,CADmD,CAEnD;;AACA,YAAIqC,WAAW,GAAG,KAAK,IAAL,GAAY,IAA9B,EAAoC;AAChC,eAAKrC,gBAAL,IAAyB,CAAzB;AACH;AACJ,OAND;;AAOAR,gBAAU,CAACjb,SAAX,CAAqBgd,cAArB,GAAsC,YAAY;AAC9C,YAAI/T,KAAK,GAAG,IAAZ;;AACA,aAAKkU,aAAL,CAAmB,UAAUG,SAAV,EAAqB;AACpC,cAAIpH,WAAW,GAAGtZ,WAAW,CAACqM,KAAK,CAAC4S,YAAP,EAAqB5S,KAAK,CAAC6S,SAA3B,EAAsC7S,KAAK,CAAC4I,SAA5C,CAA7B;;AACA,cAAIkM,eAAe,GAAG9U,KAAK,CAAC4S,YAAN,CAAmB2B,WAAnB,CAA+BtH,WAA/B,EAA4CoH,SAA5C,CAAtB;;AACArU,eAAK,CAACuS,QAAN,GAAiBuC,eAAjB;AACAA,yBAAe,CAACN,UAAhB,GAA6B/hB,IAA7B,CAAkC,UAAUyB,QAAV,EAAoB;AAClD8L,iBAAK,CAACuS,QAAN,GAAiB,IAAjB;AACAvS,iBAAK,CAACqO,SAAN,GAAkBna,QAAlB;;AACA8L,iBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAACI,OAApC;AACH,WAJD,EAIGyB,KAAK,CAACqT,qBAJT;AAKH,SATD;AAUH,OAZD;;AAaArB,gBAAU,CAACjb,SAAX,CAAqBkd,cAArB,GAAsC,YAAY;AAC9C,YAAIjU,KAAK,GAAG,IAAZ;;AACA,aAAKkU,aAAL,CAAmB,UAAUG,SAAV,EAAqB;AACpC,cAAIpH,WAAW,GAAGc,eAAe,CAAC/N,KAAK,CAAC4S,YAAP,EAAqB5S,KAAK,CAAC6S,SAA3B,EAAsC7S,KAAK,CAAC4I,SAA5C,EAAuD5I,KAAK,CAAC8S,KAA7D,EAAoE9S,KAAK,CAACqO,SAA1E,CAAjC;;AACA,cAAI0G,gBAAgB,GAAG/U,KAAK,CAAC4S,YAAN,CAAmB2B,WAAnB,CAA+BtH,WAA/B,EAA4CoH,SAA5C,CAAvB;;AACArU,eAAK,CAACuS,QAAN,GAAiBwC,gBAAjB;AACAA,0BAAgB,CAACP,UAAjB,GAA8B/hB,IAA9B,CAAmC,UAAUyB,QAAV,EAAoB;AACnD8L,iBAAK,CAACuS,QAAN,GAAiB,IAAjB;AACAvS,iBAAK,CAACqO,SAAN,GAAkBna,QAAlB;;AACA8L,iBAAK,CAAC4T,eAAN,CAAsB5T,KAAK,CAAC8S,KAAN,CAAYzP,IAAZ,EAAtB;;AACArD,iBAAK,CAACoT,WAAN,CAAkBjV,iBAAiB,CAACI,OAApC;AACH,WALD,EAKGyB,KAAK,CAACkT,aALT;AAMH,SAVD;AAWH,OAbD;;AAcAlB,gBAAU,CAACjb,SAAX,CAAqB6c,eAArB,GAAuC,UAAUoB,WAAV,EAAuB;AAC1D,YAAIC,GAAG,GAAG,KAAKhD,YAAf;AACA,aAAKA,YAAL,GAAoB+C,WAApB,CAF0D,CAG1D;AACA;AACA;;AACA,YAAI,KAAK/C,YAAL,KAAsBgD,GAA1B,EAA+B;AAC3B,eAAKC,gBAAL;AACH;AACJ,OATD;;AAUAlD,gBAAU,CAACjb,SAAX,CAAqBqc,WAArB,GAAmC,UAAUxU,KAAV,EAAiB;AAChD,YAAI,KAAKqU,MAAL,KAAgBrU,KAApB,EAA2B;AACvB;AACH;;AACD,gBAAQA,KAAR;AACI,eAAKT,iBAAiB,CAACK,SAAvB;AACI;AACA;AACA;AACA,iBAAKyU,MAAL,GAAcrU,KAAd;;AACA,gBAAI,KAAK2T,QAAL,KAAkB,IAAtB,EAA4B;AACxB,mBAAKA,QAAL,CAAclgB,MAAd;AACH;;AACD;;AACJ,eAAK8L,iBAAiB,CAACE,OAAvB;AACI;AACA;AACA,iBAAK4U,MAAL,GAAcrU,KAAd;;AACA,gBAAI,KAAK2T,QAAL,KAAkB,IAAtB,EAA4B;AACxB,mBAAKA,QAAL,CAAclgB,MAAd;AACH;;AACD;;AACJ,eAAK8L,iBAAiB,CAACC,OAAvB;AACI;AACA;AACA;AACA,gBAAI+W,SAAS,GAAG,KAAKlC,MAAL,KAAgB9U,iBAAiB,CAACG,MAAlD;AACA,iBAAK2U,MAAL,GAAcrU,KAAd;;AACA,gBAAIuW,SAAJ,EAAe;AACX,mBAAKD,gBAAL;AACA,mBAAK1B,MAAL;AACH;;AACD;;AACJ,eAAKrV,iBAAiB,CAACG,MAAvB;AACI;AACA;AACA,iBAAK2U,MAAL,GAAcrU,KAAd;AACA,iBAAKsW,gBAAL;AACA;;AACJ,eAAK/W,iBAAiB,CAAChG,QAAvB;AACI;AACA;AACA;AACA,iBAAKka,MAAL,GAAc7Y,QAAQ,EAAtB;AACA,iBAAKyZ,MAAL,GAAcrU,KAAd;AACA,iBAAKsW,gBAAL;AACA;;AACJ,eAAK/W,iBAAiB,CAACM,KAAvB;AACI;AACA;AACA;AACA;AACA,iBAAKwU,MAAL,GAAcrU,KAAd;AACA,iBAAKsW,gBAAL;AACA;;AACJ,eAAK/W,iBAAiB,CAACI,OAAvB;AACI;AACA;AACA;AACA;AACA,iBAAK0U,MAAL,GAAcrU,KAAd;AACA,iBAAKsW,gBAAL;AACA;AA1DR;AA4DH,OAhED;;AAiEAlD,gBAAU,CAACjb,SAAX,CAAqBoc,oBAArB,GAA4C,YAAY;AACpD,gBAAQ,KAAKF,MAAb;AACI,eAAK9U,iBAAiB,CAACE,OAAvB;AACI,iBAAK+U,WAAL,CAAiBjV,iBAAiB,CAACG,MAAnC;AACA;;AACJ,eAAKH,iBAAiB,CAACK,SAAvB;AACI,iBAAK4U,WAAL,CAAiBjV,iBAAiB,CAAChG,QAAnC;AACA;;AACJ,eAAKgG,iBAAiB,CAACC,OAAvB;AACI,iBAAKoV,MAAL;AACA;AATR;AAWH,OAZD;;AAaAhe,YAAM,CAAC6B,cAAP,CAAsB2a,UAAU,CAACjb,SAAjC,EAA4C,UAA5C,EAAwD;AACpDO,WAAG,EAAE,eAAY;AACb,cAAI8d,aAAa,GAAGzW,8BAA8B,CAAC,KAAKsU,MAAN,CAAlD;AACA,iBAAO,IAAI7C,kBAAJ,CAAuB,KAAK6B,YAA5B,EAA0C,KAAKa,KAAL,CAAWzP,IAAX,EAA1C,EAA6D+R,aAA7D,EAA4E,KAAK/G,SAAjF,EAA4F,IAA5F,EAAkG,KAAKsE,IAAvG,CAAP;AACH,SAJmD;AAKpDpb,kBAAU,EAAE,KALwC;AAMpDC,oBAAY,EAAE;AANsC,OAAxD;AAQA;;;;;AAIAwa,gBAAU,CAACjb,SAAX,CAAqB3E,EAArB,GAA0B,UAAUiD,IAAV,EAAgB4a,cAAhB,EAAgChe,KAAhC,EAAuCojB,SAAvC,EAAkD;AACxE,iBAASC,aAAT,GAAyB;AACrB,cAAIjgB,IAAI,KAAK4I,SAAS,CAACC,aAAvB,EAAsC;AAClC,kBAAM,uCAAuCD,SAAS,CAACC,aAAjD,GAAiE,IAAvE;AACH;AACJ;;AACD,YAAIqX,qBAAqB,GAAG,kDACxB,yCADJ;AAEA,YAAIC,aAAa,GAAG5D,gBAAgB,CAAC,IAAD,CAAhB,CAAuBhB,SAA3C;AACA,YAAI6E,iBAAiB,GAAGhE,eAAe,CAAC,IAAD,EAAO,IAAP,CAAf,CAA4Bb,SAApD,CATwE,CAUxE;;AACA,iBAAS8E,uBAAT,CAAiC5W,CAAjC,EAAoC;AAChC,cAAI;AACA0W,yBAAa,CAAC1W,CAAD,CAAb;AACA;AACH,WAHD,CAIA,OAAO5M,CAAP,EAAU,CAAG;;AACb,cAAI;AACAujB,6BAAiB,CAAC3W,CAAD,CAAjB;AACA,gBAAI6W,UAAU,GAAG5W,SAAS,CAACD,CAAC,CAAC,MAAD,CAAF,CAAT,IACbC,SAAS,CAACD,CAAC,CAAC,OAAD,CAAF,CADI,IAEbC,SAAS,CAACD,CAAC,CAAC,UAAD,CAAF,CAFb;;AAGA,gBAAI,CAAC6W,UAAL,EAAiB;AACb,oBAAM,EAAN;AACH;;AACD;AACH,WATD,CAUA,OAAOzjB,CAAP,EAAU;AACN,kBAAMqjB,qBAAN;AACH;AACJ;;AACD,YAAIjF,KAAK,GAAG,CACRY,UAAU,CAACoE,aAAD,CADF,EAER7D,eAAe,CAACiE,uBAAD,EAA0B,IAA1B,CAFP,EAGR9D,gBAAgB,CAAC,IAAD,CAHR,EAIRA,gBAAgB,CAAC,IAAD,CAJR,CAAZ;AAMAvB,gBAAQ,CAAC,IAAD,EAAOC,KAAP,EAAc7N,SAAd,CAAR;AACA,YAAIqO,IAAI,GAAG,IAAX;;AACA,iBAAS8E,UAAT,CAAoBtF,KAApB,EAA2B;AACvB,mBAASuF,MAAT,CAAgB5F,cAAhB,EAAgChe,KAAhC,EAAuCE,QAAvC,EAAiD;AAC7C,gBAAIme,KAAK,KAAK,IAAd,EAAoB;AAChBD,sBAAQ,CAAC,IAAD,EAAOC,KAAP,EAAc7N,SAAd,CAAR;AACH;;AACD,gBAAI0N,QAAQ,GAAG,IAAIH,QAAJ,CAAaC,cAAb,EAA6Bhe,KAA7B,EAAoCojB,SAApC,CAAf;AACAvE,gBAAI,CAACgF,YAAL,CAAkB3F,QAAlB;AACA,mBAAO,YAAY;AACfW,kBAAI,CAACiF,eAAL,CAAqB5F,QAArB;AACH,aAFD;AAGH;;AACD,iBAAO0F,MAAP;AACH;;AACD,iBAASG,6BAAT,CAAuClX,CAAvC,EAA0C;AACtC,cAAIA,CAAC,KAAK,IAAV,EAAgB;AACZ,kBAAMyW,qBAAN;AACH;;AACDG,iCAAuB,CAAC5W,CAAD,CAAvB;AACH;;AACD,YAAImX,WAAW,GAAG,CACdxE,eAAe,CAACuE,6BAAD,CADD,EAEdpE,gBAAgB,CAAC,IAAD,CAFF,EAGdA,gBAAgB,CAAC,IAAD,CAHF,CAAlB;AAKA,YAAIsE,QAAQ,GAAG,EAAEnX,SAAS,CAACkR,cAAD,CAAT,IACblR,SAAS,CAAC9M,KAAD,CADI,IAEb8M,SAAS,CAACsW,SAAD,CAFE,CAAf;;AAGA,YAAIa,QAAJ,EAAc;AACV,iBAAON,UAAU,CAACK,WAAD,CAAjB;AACH,SAFD,MAGK;AACD,iBAAOL,UAAU,CAAC,IAAD,CAAV,CAAiB3F,cAAjB,EAAiChe,KAAjC,EAAwCojB,SAAxC,CAAP;AACH;AACJ,OAxED;AAyEA;;;;;;;;AAMArD,gBAAU,CAACjb,SAAX,CAAqBtE,IAArB,GAA4B,UAAU0jB,WAAV,EAAuBC,UAAvB,EAAmC;AAC3D;AACA;AACA,eAAO,KAAK9C,QAAL,CAAc7gB,IAAd,CAAmB0jB,WAAnB,EAAgCC,UAAhC,CAAP;AACH,OAJD;AAKA;;;;;AAGApE,gBAAU,CAACjb,SAAX,YAA6B,UAAUqf,UAAV,EAAsB;AAC/C,eAAO,KAAK3jB,IAAL,CAAU,IAAV,EAAgB2jB,UAAhB,CAAP;AACH,OAFD;AAGA;;;;;AAGApE,gBAAU,CAACjb,SAAX,CAAqB+e,YAArB,GAAoC,UAAU3F,QAAV,EAAoB;AACpD,aAAKiC,UAAL,CAAgBlW,IAAhB,CAAqBiU,QAArB;AACA,aAAKkG,eAAL,CAAqBlG,QAArB;AACH,OAHD;AAIA;;;;;AAGA6B,gBAAU,CAACjb,SAAX,CAAqBgf,eAArB,GAAuC,UAAU5F,QAAV,EAAoB;AACvD,YAAIrU,CAAC,GAAG,KAAKsW,UAAL,CAAgBzV,OAAhB,CAAwBwT,QAAxB,CAAR;;AACA,YAAIrU,CAAC,KAAK,CAAC,CAAX,EAAc;AACV,eAAKsW,UAAL,CAAgBkE,MAAhB,CAAuBxa,CAAvB,EAA0B,CAA1B;AACH;AACJ,OALD;;AAMAkW,gBAAU,CAACjb,SAAX,CAAqBme,gBAArB,GAAwC,YAAY;AAChD,YAAIlV,KAAK,GAAG,IAAZ;;AACA,aAAKuW,cAAL;AACA,YAAIC,SAAS,GAAG,KAAKpE,UAAL,CAAgBlP,KAAhB,EAAhB;AACAsT,iBAAS,CAAChS,OAAV,CAAkB,UAAU2L,QAAV,EAAoB;AAClCnQ,eAAK,CAACqW,eAAN,CAAsBlG,QAAtB;AACH,SAFD;AAGH,OAPD;;AAQA6B,gBAAU,CAACjb,SAAX,CAAqBwf,cAArB,GAAsC,YAAY;AAC9C,YAAI,KAAK9D,QAAL,KAAkB,IAAtB,EAA4B;AACxB,cAAIgE,SAAS,GAAG,IAAhB;;AACA,kBAAQ9X,8BAA8B,CAAC,KAAKsU,MAAN,CAAtC;AACI,iBAAKvU,SAAS,CAACH,OAAf;AACIsT,mBAAK,CAAC,KAAKY,QAAL,CAAc/f,IAAd,CAAmB,IAAnB,EAAyB,KAAKgkB,QAA9B,CAAD,CAAL;AACA;;AACJ,iBAAKhY,SAAS,CAACvG,QAAf;AACA,iBAAKuG,SAAS,CAACD,KAAf;AACI,kBAAIkY,MAAM,GAAG,KAAKjE,OAAlB;AACAb,mBAAK,CAAC8E,MAAM,CAACjkB,IAAP,CAAY,IAAZ,EAAkB,KAAK2f,MAAvB,CAAD,CAAL;AACA;;AACJ;AACIoE,uBAAS,GAAG,KAAZ;AACA;AAXR;;AAaA,cAAIA,SAAJ,EAAe;AACX,iBAAKhE,QAAL,GAAgB,IAAhB;AACA,iBAAKC,OAAL,GAAe,IAAf;AACH;AACJ;AACJ,OArBD;;AAsBAV,gBAAU,CAACjb,SAAX,CAAqBsf,eAArB,GAAuC,UAAUlG,QAAV,EAAoB;AACvD,YAAIiF,aAAa,GAAGzW,8BAA8B,CAAC,KAAKsU,MAAN,CAAlD;;AACA,gBAAQmC,aAAR;AACI,eAAK1W,SAAS,CAACN,OAAf;AACA,eAAKM,SAAS,CAACJ,MAAf;AACI,gBAAI6R,QAAQ,CAACne,IAAb,EAAmB;AACf6f,mBAAK,CAAC1B,QAAQ,CAACne,IAAT,CAAcU,IAAd,CAAmByd,QAAnB,EAA6B,KAAKuG,QAAlC,CAAD,CAAL;AACH;;AACD;;AACJ,eAAKhY,SAAS,CAACH,OAAf;AACI,gBAAI4R,QAAQ,CAAChe,QAAb,EAAuB;AACnB0f,mBAAK,CAAC1B,QAAQ,CAAChe,QAAT,CAAkBO,IAAlB,CAAuByd,QAAvB,CAAD,CAAL;AACH;;AACD;;AACJ,eAAKzR,SAAS,CAACvG,QAAf;AACA,eAAKuG,SAAS,CAACD,KAAf;AACI,gBAAI0R,QAAQ,CAACle,KAAb,EAAoB;AAChB4f,mBAAK,CAAC1B,QAAQ,CAACle,KAAT,CAAeS,IAAf,CAAoByd,QAApB,EAA8B,KAAKkC,MAAnC,CAAD,CAAL;AACH;;AACD;;AACJ;AACI;AACA,gBAAIlC,QAAQ,CAACle,KAAb,EAAoB;AAChB4f,mBAAK,CAAC1B,QAAQ,CAACle,KAAT,CAAeS,IAAf,CAAoByd,QAApB,EAA8B,KAAKkC,MAAnC,CAAD,CAAL;AACH;;AAtBT;AAwBH,OA1BD;AA2BA;;;;;;AAIAL,gBAAU,CAACjb,SAAX,CAAqBnE,MAArB,GAA8B,YAAY;AACtCyd,gBAAQ,CAAC,QAAD,EAAW,EAAX,EAAe5N,SAAf,CAAR;AACA,YAAItG,KAAK,GAAG,KAAK8W,MAAL,KAAgB9U,iBAAiB,CAACG,MAAlC,IACR,KAAK2U,MAAL,KAAgB9U,iBAAiB,CAACE,OADtC;;AAEA,YAAIlC,KAAJ,EAAW;AACP,eAAKiX,WAAL,CAAiBjV,iBAAiB,CAACC,OAAnC;AACH;;AACD,eAAOjC,KAAP;AACH,OARD;AASA;;;;;;AAIA6V,gBAAU,CAACjb,SAAX,CAAqBpE,KAArB,GAA6B,YAAY;AACrC0d,gBAAQ,CAAC,OAAD,EAAU,EAAV,EAAc5N,SAAd,CAAR;AACA,YAAItG,KAAK,GAAG,KAAK8W,MAAL,KAAgB9U,iBAAiB,CAACC,OAA9C;;AACA,YAAIjC,KAAJ,EAAW;AACP,eAAKiX,WAAL,CAAiBjV,iBAAiB,CAACE,OAAnC;AACH;;AACD,eAAOlC,KAAP;AACH,OAPD;AAQA;;;;;;;AAKA6V,gBAAU,CAACjb,SAAX,CAAqB1E,MAArB,GAA8B,YAAY;AACtCge,gBAAQ,CAAC,QAAD,EAAW,EAAX,EAAe5N,SAAf,CAAR;AACA,YAAItG,KAAK,GAAG,KAAK8W,MAAL,KAAgB9U,iBAAiB,CAACC,OAAlC,IACR,KAAK6U,MAAL,KAAgB9U,iBAAiB,CAACE,OADtC;;AAEA,YAAIlC,KAAJ,EAAW;AACP,eAAKiX,WAAL,CAAiBjV,iBAAiB,CAACK,SAAnC;AACH;;AACD,eAAOrC,KAAP;AACH,OARD;;AASA,aAAO6V,UAAP;AACH,KAxgB+B,EAAhC;AA0gBA;;;;;;;;;;;;;;;;;AAgBA;;;;;;;;;;;;;AAWA,QAAI4E,SAAS;AAAG;AAAe,gBAAY;AACvC,eAASA,SAAT,CAAmBrN,WAAnB,EAAgCjE,QAAhC,EAA0C;AACtC,aAAKiE,WAAL,GAAmBA,WAAnB;;AACA,YAAIjE,QAAQ,YAAYV,QAAxB,EAAkC;AAC9B,eAAKU,QAAL,GAAgBA,QAAhB;AACH,SAFD,MAGK;AACD,eAAKA,QAAL,GAAgBV,QAAQ,CAACS,WAAT,CAAqBC,QAArB,CAAhB;AACH;AACJ;AACD;;;;;;;AAKAsR,eAAS,CAAC7f,SAAV,CAAoBqK,QAApB,GAA+B,YAAY;AACvCiP,gBAAQ,CAAC,UAAD,EAAa,EAAb,EAAiB5N,SAAjB,CAAR;AACA,eAAO,UAAU,KAAK6C,QAAL,CAAclM,MAAxB,GAAiC,GAAjC,GAAuC,KAAKkM,QAAL,CAAczR,IAA5D;AACH,OAHD;;AAIA+iB,eAAS,CAAC7f,SAAV,CAAoB8f,MAApB,GAA6B,UAAUtN,WAAV,EAAuBjE,QAAvB,EAAiC;AAC1D,eAAO,IAAIsR,SAAJ,CAAcrN,WAAd,EAA2BjE,QAA3B,CAAP;AACH,OAFD;;AAGAsR,eAAS,CAAC7f,SAAV,CAAoBiS,QAApB,GAA+B,YAAY;AACvC,eAAOD,WAAW,EAAlB;AACH,OAFD;AAGA;;;;;;;AAKA6N,eAAS,CAAC7f,SAAV,CAAoBnD,KAApB,GAA4B,UAAU6T,SAAV,EAAqB;AAC7C4I,gBAAQ,CAAC,OAAD,EAAU,CAACa,UAAU,EAAX,CAAV,EAA0BzO,SAA1B,CAAR;AACA,YAAI+E,OAAO,GAAG5T,KAAK,CAAC,KAAK0R,QAAL,CAAczR,IAAf,EAAqB4T,SAArB,CAAnB;AACA,YAAInC,QAAQ,GAAG,IAAIV,QAAJ,CAAa,KAAKU,QAAL,CAAclM,MAA3B,EAAmCoO,OAAnC,CAAf;AACA,eAAO,KAAKqP,MAAL,CAAY,KAAKtN,WAAjB,EAA8BjE,QAA9B,CAAP;AACH,OALD;;AAMA9P,YAAM,CAAC6B,cAAP,CAAsBuf,SAAS,CAAC7f,SAAhC,EAA2C,QAA3C,EAAqD;AACjD;;;;AAIAO,WAAG,EAAE,eAAY;AACb,cAAIkQ,OAAO,GAAGF,MAAM,CAAC,KAAKhC,QAAL,CAAczR,IAAf,CAApB;;AACA,cAAI2T,OAAO,KAAK,IAAhB,EAAsB;AAClB,mBAAO,IAAP;AACH;;AACD,cAAIlC,QAAQ,GAAG,IAAIV,QAAJ,CAAa,KAAKU,QAAL,CAAclM,MAA3B,EAAmCoO,OAAnC,CAAf;AACA,iBAAO,KAAKqP,MAAL,CAAY,KAAKtN,WAAjB,EAA8BjE,QAA9B,CAAP;AACH,SAZgD;AAajD/N,kBAAU,EAAE,KAbqC;AAcjDC,oBAAY,EAAE;AAdmC,OAArD;AAgBAhC,YAAM,CAAC6B,cAAP,CAAsBuf,SAAS,CAAC7f,SAAhC,EAA2C,MAA3C,EAAmD;AAC/C;;;;AAIAO,WAAG,EAAE,eAAY;AACb,cAAIgO,QAAQ,GAAG,IAAIV,QAAJ,CAAa,KAAKU,QAAL,CAAclM,MAA3B,EAAmC,EAAnC,CAAf;AACA,iBAAO,KAAKyd,MAAL,CAAY,KAAKtN,WAAjB,EAA8BjE,QAA9B,CAAP;AACH,SAR8C;AAS/C/N,kBAAU,EAAE,KATmC;AAU/CC,oBAAY,EAAE;AAViC,OAAnD;AAYAhC,YAAM,CAAC6B,cAAP,CAAsBuf,SAAS,CAAC7f,SAAhC,EAA2C,QAA3C,EAAqD;AACjDO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKgO,QAAL,CAAclM,MAArB;AACH,SAHgD;AAIjD7B,kBAAU,EAAE,KAJqC;AAKjDC,oBAAY,EAAE;AALmC,OAArD;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBuf,SAAS,CAAC7f,SAAhC,EAA2C,UAA3C,EAAuD;AACnDO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKgO,QAAL,CAAczR,IAArB;AACH,SAHkD;AAInD0D,kBAAU,EAAE,KAJuC;AAKnDC,oBAAY,EAAE;AALqC,OAAvD;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBuf,SAAS,CAAC7f,SAAhC,EAA2C,MAA3C,EAAmD;AAC/CO,WAAG,EAAE,eAAY;AACb,iBAAOyQ,aAAa,CAAC,KAAKzC,QAAL,CAAczR,IAAf,CAApB;AACH,SAH8C;AAI/C0D,kBAAU,EAAE,KAJmC;AAK/CC,oBAAY,EAAE;AALiC,OAAnD;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBuf,SAAS,CAAC7f,SAAhC,EAA2C,SAA3C,EAAsD;AAClDO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKiS,WAAL,CAAiBuN,OAAjB,EAAP;AACH,SAHiD;AAIlDvf,kBAAU,EAAE,KAJsC;AAKlDC,oBAAY,EAAE;AALoC,OAAtD;AAOA;;;;;;;AAMAof,eAAS,CAAC7f,SAAV,CAAoB/C,GAApB,GAA0B,UAAUC,IAAV,EAAgBC,QAAhB,EAA0B;AAChD,YAAIA,QAAQ,KAAK,KAAK,CAAtB,EAAyB;AAAEA,kBAAQ,GAAG,IAAX;AAAkB;;AAC7Cmc,gBAAQ,CAAC,KAAD,EAAQ,CAACgB,cAAc,EAAf,EAAmBC,YAAY,CAAC,IAAD,CAA/B,CAAR,EAAgD7O,SAAhD,CAAR;AACA,aAAKsU,YAAL,CAAkB,KAAlB;AACA,eAAO,IAAI/E,UAAJ,CAAe,IAAf,EAAqB,KAAKzI,WAA1B,EAAuC,KAAKjE,QAA5C,EAAsD,KAAK0D,QAAL,EAAtD,EAAuE,IAAI7F,OAAJ,CAAYlP,IAAZ,CAAvE,EAA0FC,QAA1F,CAAP;AACH,OALD;AAMA;;;;;;;;;AAOA0iB,eAAS,CAAC7f,SAAV,CAAoB5C,SAApB,GAAgC,UAAUyH,KAAV,EAAiBxH,MAAjB,EAAyBF,QAAzB,EAAmC;AAC/D,YAAIE,MAAM,KAAK,KAAK,CAApB,EAAuB;AAAEA,gBAAM,GAAGyG,YAAY,CAACC,GAAtB;AAA4B;;AACrDuV,gBAAQ,CAAC,WAAD,EAAc,CAACa,UAAU,EAAX,EAAeA,UAAU,CAAChW,eAAD,EAAkB,IAAlB,CAAzB,EAAkDoW,YAAY,CAAC,IAAD,CAA9D,CAAd,EAAqF7O,SAArF,CAAR;AACA,aAAKsU,YAAL,CAAkB,WAAlB;AACA,YAAI9iB,IAAI,GAAGqH,cAAc,CAAClH,MAAD,EAASwH,KAAT,CAAzB;AACA,YAAIiS,aAAa,GAAGrY,MAAM,CAACsY,MAAP,CAAc,EAAd,EAAkB5Z,QAAlB,CAApB;;AACA,YAAI,CAAC2K,KAAK,CAACgP,aAAa,CAAC,aAAD,CAAd,CAAN,IACAhP,KAAK,CAAC5K,IAAI,CAACoH,WAAN,CADT,EAC6B;AACzBwS,uBAAa,CAAC,aAAD,CAAb,GAA+B5Z,IAAI,CAACoH,WAApC;AACH;;AACD,eAAO,IAAI2W,UAAJ,CAAe,IAAf,EAAqB,KAAKzI,WAA1B,EAAuC,KAAKjE,QAA5C,EAAsD,KAAK0D,QAAL,EAAtD,EAAuE,IAAI7F,OAAJ,CAAYlP,IAAI,CAACA,IAAjB,EAAuB,IAAvB,CAAvE,EAAqG4Z,aAArG,CAAP;AACH,OAXD;AAYA;;;;;;AAIA+I,eAAS,CAAC7f,SAAV,aAA6B,YAAY;AACrC,YAAIiJ,KAAK,GAAG,IAAZ;;AACAqQ,gBAAQ,CAAC,QAAD,EAAW,EAAX,EAAe5N,SAAf,CAAR;AACA,aAAKsU,YAAL,CAAkB,QAAlB;AACA,eAAO,KAAKxN,WAAL,CAAiB6K,YAAjB,GAAgC3hB,IAAhC,CAAqC,UAAU4hB,SAAV,EAAqB;AAC7D,cAAIpH,WAAW,GAAGO,YAAY,CAACxN,KAAK,CAACuJ,WAAP,EAAoBvJ,KAAK,CAACsF,QAA1B,CAA9B;AACA,iBAAOtF,KAAK,CAACuJ,WAAN,CAAkBgL,WAAlB,CAA8BtH,WAA9B,EAA2CoH,SAA3C,EAAsDG,UAAtD,EAAP;AACH,SAHM,CAAP;AAIH,OARD;AASA;;;;;;;;;;;;;;;;;;;AAiBAoC,eAAS,CAAC7f,SAAV,CAAoB1C,OAApB,GAA8B,YAAY;AACtCgc,gBAAQ,CAAC,SAAD,EAAY,EAAZ,EAAgB5N,SAAhB,CAAR;AACA,YAAIuU,WAAW,GAAG;AACd/L,kBAAQ,EAAE,EADI;AAEdC,eAAK,EAAE;AAFO,SAAlB;AAIA,eAAO,KAAK+L,aAAL,CAAmBD,WAAnB,EAAgCvkB,IAAhC,CAAqC,YAAY;AAAE,iBAAOukB,WAAP;AAAqB,SAAxE,CAAP;AACH,OAPD;;AAQAJ,eAAS,CAAC7f,SAAV,CAAoBkgB,aAApB,GAAoC,UAAUD,WAAV,EAAuB5J,SAAvB,EAAkC;AAClE,eAAO,wDAAU,IAAV,EAAgB,KAAK,CAArB,EAAwB,KAAK,CAA7B,EAAgC,YAAY;AAC/C,cAAI8J,GAAJ,EAASC,QAAT;;AACA,cAAI/L,EAAJ,EAAQG,EAAR;;AACA,iBAAO,0DAAY,IAAZ,EAAkB,UAAUC,EAAV,EAAc;AACnC,oBAAQA,EAAE,CAAC4L,KAAX;AACI,mBAAK,CAAL;AACIF,mBAAG,GAAG;AACF;AACA9J,2BAAS,EAAEA;AAFT,iBAAN;AAIA,uBAAO,CAAC;AAAE;AAAH,kBAAc,KAAKF,IAAL,CAAUgK,GAAV,CAAd,CAAP;;AACJ,mBAAK,CAAL;AACIC,wBAAQ,GAAG3L,EAAE,CAAC6L,IAAH,EAAX;;AACA,iBAACjM,EAAE,GAAG4L,WAAW,CAAC/L,QAAlB,EAA4B/O,IAA5B,CAAiCmI,KAAjC,CAAuC+G,EAAvC,EAA2C+L,QAAQ,CAAClM,QAApD;;AACA,iBAACM,EAAE,GAAGyL,WAAW,CAAC9L,KAAlB,EAAyBhP,IAAzB,CAA8BmI,KAA9B,CAAoCkH,EAApC,EAAwC4L,QAAQ,CAACjM,KAAjD;;AACA,oBAAI,EAAEiM,QAAQ,CAAChM,aAAT,IAA0B,IAA5B,CAAJ,EAAuC,OAAO,CAAC;AAAE;AAAH,kBAAc,CAAd,CAAP;AACvC,uBAAO,CAAC;AAAE;AAAH,kBAAc,KAAK8L,aAAL,CAAmBD,WAAnB,EAAgCG,QAAQ,CAAChM,aAAzC,CAAd,CAAP;;AACJ,mBAAK,CAAL;AACIK,kBAAE,CAAC6L,IAAH;;AACA7L,kBAAE,CAAC4L,KAAH,GAAW,CAAX;;AACJ,mBAAK,CAAL;AAAQ,uBAAO,CAAC;AAAE;AAAH,iBAAP;AAhBZ;AAkBH,WAnBM,CAAP;AAoBH,SAvBM,CAAP;AAwBH,OAzBD;AA0BA;;;;;;;;;;;;;;;;;;;;;;AAoBAR,eAAS,CAAC7f,SAAV,CAAoBmW,IAApB,GAA2B,UAAU1Y,OAAV,EAAmB;AAC1C6b,gBAAQ,CAAC,MAAD,EAAS,CAACkB,cAAc,CAAC,IAAD,CAAf,CAAT,EAAiC9O,SAAjC,CAAR;AACA,YAAIqO,IAAI,GAAG,IAAX;AACA,eAAO,KAAKvH,WAAL,CAAiB6K,YAAjB,GAAgC3hB,IAAhC,CAAqC,UAAU4hB,SAAV,EAAqB;AAC7D,cAAIiD,EAAE,GAAG9iB,OAAO,IAAI,EAApB;AACA,cAAIyY,WAAW,GAAGC,IAAI,CAAC4D,IAAI,CAACvH,WAAN,EAAmBuH,IAAI,CAACxL,QAAxB;AACtB;AAAgB,aADM,EACDgS,EAAE,CAAClK,SADF,EACakK,EAAE,CAACjK,UADhB,CAAtB;AAEA,iBAAOyD,IAAI,CAACvH,WAAL,CAAiBgL,WAAjB,CAA6BtH,WAA7B,EAA0CoH,SAA1C,EAAqDG,UAArD,EAAP;AACH,SALM,CAAP;AAMH,OATD;AAUA;;;;;;;AAKAoC,eAAS,CAAC7f,SAAV,CAAoBpD,WAApB,GAAkC,YAAY;AAC1C,YAAIqM,KAAK,GAAG,IAAZ;;AACAqQ,gBAAQ,CAAC,aAAD,EAAgB,EAAhB,EAAoB5N,SAApB,CAAR;AACA,aAAKsU,YAAL,CAAkB,aAAlB;AACA,eAAO,KAAKxN,WAAL,CAAiB6K,YAAjB,GAAgC3hB,IAAhC,CAAqC,UAAU4hB,SAAV,EAAqB;AAC7D,cAAIpH,WAAW,GAAGtZ,WAAW,CAACqM,KAAK,CAACuJ,WAAP,EAAoBvJ,KAAK,CAACsF,QAA1B,EAAoCtF,KAAK,CAACgJ,QAAN,EAApC,CAA7B;AACA,iBAAOhJ,KAAK,CAACuJ,WAAN,CAAkBgL,WAAlB,CAA8BtH,WAA9B,EAA2CoH,SAA3C,EAAsDG,UAAtD,EAAP;AACH,SAHM,CAAP;AAIH,OARD;AASA;;;;;;;;;;;AASAoC,eAAS,CAAC7f,SAAV,CAAoBjD,cAApB,GAAqC,UAAUI,QAAV,EAAoB;AACrD,YAAI8L,KAAK,GAAG,IAAZ;;AACAqQ,gBAAQ,CAAC,gBAAD,EAAmB,CAACiB,YAAY,EAAb,CAAnB,EAAqC7O,SAArC,CAAR;AACA,aAAKsU,YAAL,CAAkB,gBAAlB;AACA,eAAO,KAAKxN,WAAL,CAAiB6K,YAAjB,GAAgC3hB,IAAhC,CAAqC,UAAU4hB,SAAV,EAAqB;AAC7D,cAAIpH,WAAW,GAAGnZ,cAAc,CAACkM,KAAK,CAACuJ,WAAP,EAAoBvJ,KAAK,CAACsF,QAA1B,EAAoCpR,QAApC,EAA8C8L,KAAK,CAACgJ,QAAN,EAA9C,CAAhC;AACA,iBAAOhJ,KAAK,CAACuJ,WAAN,CAAkBgL,WAAlB,CAA8BtH,WAA9B,EAA2CoH,SAA3C,EAAsDG,UAAtD,EAAP;AACH,SAHM,CAAP;AAIH,OARD;AASA;;;;;;AAIAoC,eAAS,CAAC7f,SAAV,CAAoBvD,cAApB,GAAqC,YAAY;AAC7C,YAAIwM,KAAK,GAAG,IAAZ;;AACAqQ,gBAAQ,CAAC,gBAAD,EAAmB,EAAnB,EAAuB5N,SAAvB,CAAR;AACA,aAAKsU,YAAL,CAAkB,gBAAlB;AACA,eAAO,KAAKxN,WAAL,CAAiB6K,YAAjB,GAAgC3hB,IAAhC,CAAqC,UAAU4hB,SAAV,EAAqB;AAC7D,cAAIpH,WAAW,GAAGM,cAAc,CAACvN,KAAK,CAACuJ,WAAP,EAAoBvJ,KAAK,CAACsF,QAA1B,EAAoCtF,KAAK,CAACgJ,QAAN,EAApC,CAAhC;AACA,iBAAOhJ,KAAK,CAACuJ,WAAN,CACFgL,WADE,CACUtH,WADV,EACuBoH,SADvB,EAEFG,UAFE,GAGF/hB,IAHE,CAGG,UAAUiH,GAAV,EAAe;AACrB,gBAAIA,GAAG,KAAK,IAAZ,EAAkB;AACd,oBAAMI,aAAa,EAAnB;AACH;;AACD,mBAAOJ,GAAP;AACH,WARM,CAAP;AASH,SAXM,CAAP;AAYH,OAhBD;;AAiBAkd,eAAS,CAAC7f,SAAV,CAAoBggB,YAApB,GAAmC,UAAUrc,IAAV,EAAgB;AAC/C,YAAI,KAAK4K,QAAL,CAAczR,IAAd,KAAuB,EAA3B,EAA+B;AAC3B,gBAAM4G,oBAAoB,CAACC,IAAD,CAA1B;AACH;AACJ,OAJD;;AAKA,aAAOkc,SAAP;AACH,KApR8B,EAA/B;AAsRA;;;;;;;AAKA,QAAIW,WAAW;AAAG;AAAe,gBAAY;AACzC,eAASA,WAAT,CAAqBtlB,KAArB,EAA4B;AACxB,aAAKqhB,QAAL,GAAgB/S,OAAO,CAACgT,MAAR,CAAethB,KAAf,CAAhB;AACH;AACD;;;AACAslB,iBAAW,CAACxgB,SAAZ,CAAsByd,UAAtB,GAAmC,YAAY;AAC3C,eAAO,KAAKlB,QAAZ;AACH,OAFD;AAGA;;;AACAiE,iBAAW,CAACxgB,SAAZ,CAAsB1E,MAAtB,GAA+B,UAAUmlB,UAAV,EAAsB,CACpD,CADD;;AAEA,aAAOD,WAAP;AACH,KAZgC,EAAjC;;AAcA,QAAIE,UAAU;AAAG;AAAe,gBAAY;AACxC,eAASA,UAAT,GAAsB;AAClB,aAAKtT,GAAL,GAAW,IAAIuT,GAAJ,EAAX;AACA,aAAKC,EAAL,GAAUrhB,gBAAV;AACH;AACD;;;;;;;;AAMAmhB,gBAAU,CAAC1gB,SAAX,CAAqB6gB,UAArB,GAAkC,UAAUC,OAAV,EAAmB;AACjD,YAAI7X,KAAK,GAAG,IAAZ;;AACA,YAAI2X,EAAE,GAAG,KAAKA,EAAd;AACA,aAAKA,EAAL;AACA,aAAKxT,GAAL,CAAST,GAAT,CAAaiU,EAAb,EAAiBE,OAAjB;AACAA,eAAO,CAACrD,UAAR,GAAqB/hB,IAArB,CAA0B,YAAY;AAAE,iBAAOuN,KAAK,CAACmE,GAAN,WAAiBwT,EAAjB,CAAP;AAA8B,SAAtE,EAAwE,YAAY;AAAE,iBAAO3X,KAAK,CAACmE,GAAN,WAAiBwT,EAAjB,CAAP;AAA8B,SAApH;AACH,OAND;AAOA;;;;;AAGAF,gBAAU,CAAC1gB,SAAX,CAAqB+gB,KAArB,GAA6B,YAAY;AACrC,aAAK3T,GAAL,CAASK,OAAT,CAAiB,UAAUuT,CAAV,EAAa;AAC1BA,WAAC,IAAIA,CAAC,CAAC1lB,MAAF,CAAS,IAAT,CAAL;AACH,SAFD;AAGA,aAAK8R,GAAL,CAAS2T,KAAT;AACH,OALD;;AAMA,aAAOL,UAAP;AACH,KA5B+B,EAAhC;AA8BA;;;;;;;;AAMA,QAAIO,WAAW;AAAG;AAAe,gBAAY;AACzC,eAASA,WAAT,CAAqBjjB,GAArB,EAA0BkjB,YAA1B,EAAwCC,KAAxC,EAA+CC,YAA/C,EAA6DrB,OAA7D,EAAsEsB,IAAtE,EAA4E;AACxE,YAAIhN,EAAJ;;AACA,aAAKiN,OAAL,GAAe,IAAf;AACA,aAAKC,MAAL,GAAc,IAAd;AACA,aAAKC,QAAL,GAAgB,KAAhB;AACA,aAAKC,IAAL,GAAYzjB,GAAZ;;AACA,YAAI,KAAKyjB,IAAL,KAAc,IAAlB,EAAwB;AACpB,cAAIhkB,OAAO,GAAG,KAAKgkB,IAAL,CAAUhkB,OAAxB;;AACA,cAAIqK,KAAK,CAACrK,OAAD,CAAT,EAAoB;AAChB,iBAAK6jB,OAAL,GAAeL,WAAW,CAACS,cAAZ,CAA2BjkB,OAA3B,CAAf;AACA,iBAAK8jB,MAAL,GAAc,CAAClN,EAAE,GAAG5W,OAAO,CAACkkB,KAAd,MAAyB,IAAzB,IAAiCtN,EAAE,KAAK,KAAK,CAA7C,GAAiDA,EAAjD,GAAsD,IAApE;AACH;AACJ;;AACD,aAAKuN,aAAL,GAAqBV,YAArB;AACA,aAAKW,gBAAL,GAAwBV,KAAxB;AACA,aAAKW,aAAL,GAAqBV,YAArB;AACA,aAAKW,KAAL,GAAaV,IAAb;AACA,aAAKW,QAAL,GAAgBjC,OAAhB;AACA,aAAKkC,sBAAL,GAA8B5iB,gCAA9B;AACA,aAAK6iB,mBAAL,GAA2B5iB,6BAA3B;AACA,aAAK6iB,WAAL,GAAmB,IAAIzB,UAAJ,EAAnB;AACH;;AACDO,iBAAW,CAACS,cAAZ,GAA6B,UAAUU,MAAV,EAAkB;AAC3C,YAAIhU,YAAY,GAAGgU,MAAM,CAAChjB,yBAAD,CAAN,IAAqC,IAAxD;;AACA,YAAIgP,YAAY,IAAI,IAApB,EAA0B;AACtB,iBAAO,IAAP;AACH;;AACD,YAAIM,GAAG,GAAGb,QAAQ,CAACM,kBAAT,CAA4BC,YAA5B,CAAV;AACA,eAAOM,GAAG,CAACrM,MAAX;AACH,OAPD;;AAQA4e,iBAAW,CAACjhB,SAAZ,CAAsBqd,YAAtB,GAAqC,YAAY;AAC7C,YAAIgF,IAAI,GAAG,KAAKT,aAAL,CAAmBU,YAAnB,CAAgC;AAAE3I,kBAAQ,EAAE;AAAZ,SAAhC,CAAX;;AACA,YAAI0I,IAAJ,EAAU;AACN,iBAAOA,IAAI,CAACE,QAAL,GAAgB7mB,IAAhB,CAAqB,UAAU8mB,QAAV,EAAoB;AAC5C,gBAAIA,QAAQ,KAAK,IAAjB,EAAuB;AACnB,qBAAOA,QAAQ,CAACC,WAAhB;AACH,aAFD,MAGK;AACD,qBAAO,IAAP;AACH;AACJ,WAPM,EAOJ,YAAY;AAAE,mBAAO,IAAP;AAAc,WAPxB,CAAP;AAQH,SATD,MAUK;AACD,iBAAOjZ,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP;AACH;AACJ,OAfD;;AAgBAwX,iBAAW,CAACjhB,SAAZ,CAAsBqC,MAAtB,GAA+B,YAAY;AACvC,YAAI,KAAKmf,QAAT,EAAmB;AACf,gBAAM/d,UAAU,EAAhB;AACH,SAFD,MAGK;AACD,iBAAO,KAAK6d,OAAZ;AACH;AACJ,OAPD;AAQA;;;;;;AAIAL,iBAAW,CAACjhB,SAAZ,CAAsB+f,OAAtB,GAAgC,YAAY;AACxC,eAAO,KAAKiC,QAAZ;AACH,OAFD;AAGA;;;;;;;;;AAOAf,iBAAW,CAACjhB,SAAZ,CAAsB0S,oBAAtB,GAA6C,UAAUhE,GAAV,EAAe;AACxD,eAAO,KAAKmT,gBAAL,CAAsB,IAAtB,EAA4BnT,GAA5B,CAAP;AACH,OAFD;;AAGAuS,iBAAW,CAACjhB,SAAZ,CAAsBwd,WAAtB,GAAoC,UAAUtH,WAAV,EAAuBoH,SAAvB,EAAkC;AAClE,YAAI,CAAC,KAAKkE,QAAV,EAAoB;AAChB,cAAIV,OAAO,GAAG,KAAKgB,aAAL,CAAmB5L,WAAnB,EAAgC,KAAKqL,MAArC,EAA6CjE,SAA7C,EAAwD,KAAKyE,KAA7D,CAAd;AACA,eAAKI,WAAL,CAAiBtB,UAAjB,CAA4BC,OAA5B;AACA,iBAAOA,OAAP;AACH,SAJD,MAKK;AACD,iBAAO,IAAIN,WAAJ,CAAgB/c,UAAU,EAA1B,CAAP;AACH;AACJ,OATD;AAUA;;;;;AAGAwd,iBAAW,CAACjhB,SAAZ,CAAsB0iB,SAAtB,GAAkC,YAAY;AAC1C,aAAKlB,QAAL,GAAgB,IAAhB;AACA,aAAKC,IAAL,GAAY,IAAZ;AACA,aAAKU,WAAL,CAAiBpB,KAAjB;AACH,OAJD;;AAKAE,iBAAW,CAACjhB,SAAZ,CAAsB0X,kBAAtB,GAA2C,YAAY;AACnD,eAAO,KAAKwK,mBAAZ;AACH,OAFD;;AAGAjB,iBAAW,CAACjhB,SAAZ,CAAsB2iB,qBAAtB,GAA8C,UAAUC,IAAV,EAAgB;AAC1D,aAAKV,mBAAL,GAA2BU,IAA3B;AACH,OAFD;;AAGA3B,iBAAW,CAACjhB,SAAZ,CAAsBiW,qBAAtB,GAA8C,YAAY;AACtD,eAAO,KAAKgM,sBAAZ;AACH,OAFD;;AAGAhB,iBAAW,CAACjhB,SAAZ,CAAsB6iB,wBAAtB,GAAiD,UAAUD,IAAV,EAAgB;AAC7D,aAAKX,sBAAL,GAA8BW,IAA9B;AACH,OAFD;;AAGA,aAAO3B,WAAP;AACH,KAvGgC,EAAjC;AAyGA;;;;;;;;;;;;;;;;;AAgBA;;;;;;;;AAMA,aAASjV,KAAT,CAAe+O,CAAf,EAAkBqC,QAAlB,EAA4BrI,OAA5B,EAAqC;AACjC;AACA;AACA,UAAI+N,WAAW,GAAG,CAAlB,CAHiC,CAIjC;AACA;AACA;;AACA,UAAIC,SAAS,GAAG,IAAhB;AACA,UAAIC,UAAU,GAAG,KAAjB;AACA,UAAIC,WAAW,GAAG,CAAlB;;AACA,eAASxgB,QAAT,GAAoB;AAChB,eAAOwgB,WAAW,KAAK,CAAvB;AACH;;AACD,UAAIC,iBAAiB,GAAG,KAAxB,CAbiC,CAcjC;AACA;AACA;;AACA,eAASC,eAAT,GAA2B;AACvB,YAAI3kB,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIiN,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAAC1G,MAAhC,EAAwCyG,EAAE,EAA1C,EAA8C;AAC1CjN,cAAI,CAACiN,EAAD,CAAJ,GAAWC,SAAS,CAACD,EAAD,CAApB;AACH;;AACD,YAAI,CAACyX,iBAAL,EAAwB;AACpBA,2BAAiB,GAAG,IAApB;AACA9F,kBAAQ,CAAC9P,KAAT,CAAe,IAAf,EAAqB9O,IAArB;AACH;AACJ;;AACD,eAAS4kB,aAAT,CAAuBC,MAAvB,EAA+B;AAC3BN,iBAAS,GAAGO,UAAU,CAAC,YAAY;AAC/BP,mBAAS,GAAG,IAAZ;AACAhI,WAAC,CAACjG,OAAD,EAAUrS,QAAQ,EAAlB,CAAD;AACH,SAHqB,EAGnB4gB,MAHmB,CAAtB;AAIH,OAhCgC,CAiCjC;AACA;AACA;;;AACA,eAASvO,OAAT,CAAiByO,OAAjB,EAA0B;AACtB,YAAI/kB,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIiN,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGC,SAAS,CAAC1G,MAAhC,EAAwCyG,EAAE,EAA1C,EAA8C;AAC1CjN,cAAI,CAACiN,EAAE,GAAG,CAAN,CAAJ,GAAeC,SAAS,CAACD,EAAD,CAAxB;AACH;;AACD,YAAIyX,iBAAJ,EAAuB;AACnB;AACH;;AACD,YAAIK,OAAJ,EAAa;AACTJ,yBAAe,CAACK,IAAhB,CAAqBlW,KAArB,CAA2B6V,eAA3B,EAA4C,6DAAe,CAAC,IAAD,EAAOI,OAAP,CAAf,EAAgC/kB,IAAhC,CAA5C;AACA;AACH;;AACD,YAAIilB,QAAQ,GAAGhhB,QAAQ,MAAMugB,UAA7B;;AACA,YAAIS,QAAJ,EAAc;AACVN,yBAAe,CAACK,IAAhB,CAAqBlW,KAArB,CAA2B6V,eAA3B,EAA4C,6DAAe,CAAC,IAAD,EAAOI,OAAP,CAAf,EAAgC/kB,IAAhC,CAA5C;AACA;AACH;;AACD,YAAIskB,WAAW,GAAG,EAAlB,EAAsB;AAClB;AACAA,qBAAW,IAAI,CAAf;AACH;;AACD,YAAIY,UAAJ;;AACA,YAAIT,WAAW,KAAK,CAApB,EAAuB;AACnBA,qBAAW,GAAG,CAAd;AACAS,oBAAU,GAAG,CAAb;AACH,SAHD,MAIK;AACDA,oBAAU,GAAG,CAACZ,WAAW,GAAG3L,IAAI,CAACC,MAAL,EAAf,IAAgC,IAA7C;AACH;;AACDgM,qBAAa,CAACM,UAAD,CAAb;AACH;;AACD,UAAIC,OAAO,GAAG,KAAd;;AACA,eAASC,IAAT,CAAcC,UAAd,EAA0B;AACtB,YAAIF,OAAJ,EAAa;AACT;AACH;;AACDA,eAAO,GAAG,IAAV;;AACA,YAAIT,iBAAJ,EAAuB;AACnB;AACH;;AACD,YAAIH,SAAS,KAAK,IAAlB,EAAwB;AACpB,cAAI,CAACc,UAAL,EAAiB;AACbZ,uBAAW,GAAG,CAAd;AACH;;AACDa,sBAAY,CAACf,SAAD,CAAZ;AACAK,uBAAa,CAAC,CAAD,CAAb;AACH,SAND,MAOK;AACD,cAAI,CAACS,UAAL,EAAiB;AACbZ,uBAAW,GAAG,CAAd;AACH;AACJ;AACJ;;AACDG,mBAAa,CAAC,CAAD,CAAb;AACAE,gBAAU,CAAC,YAAY;AACnBN,kBAAU,GAAG,IAAb;AACAY,YAAI,CAAC,IAAD,CAAJ;AACH,OAHS,EAGP7O,OAHO,CAAV;AAIA,aAAO6O,IAAP;AACH;AACD;;;;;;;;;AAOA,aAASA,IAAT,CAAchD,EAAd,EAAkB;AACdA,QAAE,CAAC,KAAD,CAAF;AACH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;;AAIA,QAAImD,cAAc;AAAG;AAAe,gBAAY;AAC5C,eAASA,cAAT,CAAwBphB,GAAxB,EAA6BmH,MAA7B,EAAqCE,OAArC,EAA8CD,IAA9C,EAAoDoL,YAApD,EAAkEC,oBAAlE,EAAwFgI,QAAxF,EAAkG4G,aAAlG,EAAiHjP,OAAjH,EAA0HG,gBAA1H,EAA4ImM,IAA5I,EAAkJ;AAC9I,YAAIpY,KAAK,GAAG,IAAZ;;AACA,aAAKgb,WAAL,GAAmB,IAAnB;AACA,aAAKC,UAAL,GAAkB,IAAlB;AACA,aAAKxI,QAAL,GAAgB,IAAhB;AACA,aAAKC,OAAL,GAAe,IAAf;AACA,aAAKwI,SAAL,GAAiB,KAAjB;AACA,aAAKC,UAAL,GAAkB,KAAlB;AACA,aAAKC,IAAL,GAAY1hB,GAAZ;AACA,aAAK2hB,OAAL,GAAexa,MAAf;AACA,aAAKya,QAAL,GAAgBva,OAAhB;AACA,aAAKwa,KAAL,GAAaza,IAAb;AACA,aAAK0a,aAAL,GAAqBtP,YAAY,CAAChJ,KAAb,EAArB;AACA,aAAKuY,qBAAL,GAA6BtP,oBAAoB,CAACjJ,KAArB,EAA7B;AACA,aAAKwY,SAAL,GAAiBvH,QAAjB;AACA,aAAKwH,cAAL,GAAsBZ,aAAtB;AACA,aAAKa,iBAAL,GAAyB3P,gBAAzB;AACA,aAAK4P,QAAL,GAAgB/P,OAAhB;AACA,aAAKgN,KAAL,GAAaV,IAAb;AACA,aAAK9E,QAAL,GAAgB,IAAI/S,OAAJ,CAAY,UAAUC,OAAV,EAAmB+S,MAAnB,EAA2B;AACnDvT,eAAK,CAACyS,QAAN,GAAiBjS,OAAjB;AACAR,eAAK,CAAC0S,OAAN,GAAgBa,MAAhB;;AACAvT,eAAK,CAACwT,MAAN;AACH,SAJe,CAAhB;AAKH;AACD;;;;;AAGAsH,oBAAc,CAAC/jB,SAAf,CAAyByc,MAAzB,GAAkC,YAAY;AAC1C,YAAI1C,IAAI,GAAG,IAAX;;AACA,iBAASgL,YAAT,CAAsBC,eAAtB,EAAuCviB,QAAvC,EAAiD;AAC7C,cAAIA,QAAJ,EAAc;AACVuiB,2BAAe,CAAC,KAAD,EAAQ,IAAIC,gBAAJ,CAAqB,KAArB,EAA4B,IAA5B,EAAkC,IAAlC,CAAR,CAAf;AACA;AACH;;AACD,cAAIzP,GAAG,GAAGuE,IAAI,CAACgI,KAAL,CAAW3W,WAAX,EAAV;AACA2O,cAAI,CAACkK,WAAL,GAAmBzO,GAAnB;;AACA,mBAAS0P,gBAAT,CAA0BC,aAA1B,EAAyC;AACrC,gBAAIvI,MAAM,GAAGuI,aAAa,CAACvI,MAA3B;AACA,gBAAI/E,KAAK,GAAGsN,aAAa,CAACC,gBAAd,GAAiCD,aAAa,CAACtN,KAA/C,GAAuD,CAAC,CAApE;;AACA,gBAAIkC,IAAI,CAAC8K,iBAAL,KAA2B,IAA/B,EAAqC;AACjC9K,kBAAI,CAAC8K,iBAAL,CAAuBjI,MAAvB,EAA+B/E,KAA/B;AACH;AACJ;;AACD,cAAIkC,IAAI,CAAC8K,iBAAL,KAA2B,IAA/B,EAAqC;AACjCrP,eAAG,CAAC1K,yBAAJ,CAA8Boa,gBAA9B;AACH,WAhB4C,CAiB7C;;;AACA1P,aAAG,CACE3L,IADL,CACUkQ,IAAI,CAACsK,IADf,EACqBtK,IAAI,CAACuK,OAD1B,EACmCvK,IAAI,CAACyK,KADxC,EAC+CzK,IAAI,CAACwK,QADpD,EAEK7oB,IAFL,CAEU,UAAU8Z,GAAV,EAAe;AACrB,gBAAIuE,IAAI,CAAC8K,iBAAL,KAA2B,IAA/B,EAAqC;AACjCrP,iBAAG,CAACvK,4BAAJ,CAAiCia,gBAAjC;AACH;;AACDnL,gBAAI,CAACkK,WAAL,GAAmB,IAAnB;AACAzO,eAAG,GAAGA,GAAN;AACA,gBAAI6P,SAAS,GAAG7P,GAAG,CAAClL,YAAJ,OAAuBvB,SAAS,CAACO,QAAjD;AACA,gBAAIkB,MAAM,GAAGgL,GAAG,CAACjL,SAAJ,EAAb;;AACA,gBAAI,CAAC8a,SAAD,IAActL,IAAI,CAACuL,kBAAL,CAAwB9a,MAAxB,CAAlB,EAAmD;AAC/C,kBAAI+a,WAAW,GAAG/P,GAAG,CAAClL,YAAJ,OAAuBvB,SAAS,CAACY,KAAnD;AACAqb,6BAAe,CAAC,KAAD,EAAQ,IAAIC,gBAAJ,CAAqB,KAArB,EAA4B,IAA5B,EAAkCM,WAAlC,CAAR,CAAf;AACA;AACH;;AACD,gBAAIC,WAAW,GAAGzL,IAAI,CAAC0K,aAAL,CAAmB7e,OAAnB,CAA2B4E,MAA3B,MAAuC,CAAC,CAA1D;AACAwa,2BAAe,CAAC,IAAD,EAAO,IAAIC,gBAAJ,CAAqBO,WAArB,EAAkChQ,GAAlC,CAAP,CAAf;AACH,WAjBD;AAkBH;AACD;;;;;;AAIA,iBAASiQ,WAAT,CAAqBC,kBAArB,EAAyClb,MAAzC,EAAiD;AAC7C,cAAIf,OAAO,GAAGsQ,IAAI,CAAC2B,QAAnB;AACA,cAAIc,MAAM,GAAGzC,IAAI,CAAC4B,OAAlB;AACA,cAAInG,GAAG,GAAGhL,MAAM,CAACgL,GAAjB;;AACA,cAAIhL,MAAM,CAACmb,cAAX,EAA2B;AACvB,gBAAI;AACA,kBAAIC,MAAM,GAAG7L,IAAI,CAAC4K,SAAL,CAAenP,GAAf,EAAoBA,GAAG,CAAC/K,eAAJ,EAApB,CAAb;;AACA,kBAAIzC,SAAS,CAAC4d,MAAD,CAAb,EAAuB;AACnBnc,uBAAO,CAACmc,MAAD,CAAP;AACH,eAFD,MAGK;AACDnc,uBAAO;AACV;AACJ,aARD,CASA,OAAOtO,CAAP,EAAU;AACNqhB,oBAAM,CAACrhB,CAAD,CAAN;AACH;AACJ,WAbD,MAcK;AACD,gBAAIqa,GAAG,KAAK,IAAZ,EAAkB;AACd,kBAAIK,GAAG,GAAG3T,OAAO,EAAjB;AACA2T,iBAAG,CAACzV,qBAAJ,CAA0BoV,GAAG,CAAC/K,eAAJ,EAA1B;;AACA,kBAAIsP,IAAI,CAAC6K,cAAT,EAAyB;AACrBpI,sBAAM,CAACzC,IAAI,CAAC6K,cAAL,CAAoBpP,GAApB,EAAyBK,GAAzB,CAAD,CAAN;AACH,eAFD,MAGK;AACD2G,sBAAM,CAAC3G,GAAD,CAAN;AACH;AACJ,aATD,MAUK;AACD,kBAAIrL,MAAM,CAAC/H,QAAX,EAAqB;AACjB,oBAAIoT,GAAG,GAAGkE,IAAI,CAACqK,UAAL,GAAkB3gB,UAAU,EAA5B,GAAiChB,QAAQ,EAAnD;AACA+Z,sBAAM,CAAC3G,GAAD,CAAN;AACH,eAHD,MAIK;AACD,oBAAIA,GAAG,GAAGrT,kBAAkB,EAA5B;AACAga,sBAAM,CAAC3G,GAAD,CAAN;AACH;AACJ;AACJ;AACJ;;AACD,YAAI,KAAKsO,SAAT,EAAoB;AAChBsB,qBAAW,CAAC,KAAD,EAAQ,IAAIR,gBAAJ,CAAqB,KAArB,EAA4B,IAA5B,EAAkC,IAAlC,CAAR,CAAX;AACH,SAFD,MAGK;AACD,eAAKf,UAAL,GAAkBlY,KAAK,CAAC+Y,YAAD,EAAeU,WAAf,EAA4B,KAAKX,QAAjC,CAAvB;AACH;AACJ,OA1FD;AA2FA;;;AACAf,oBAAc,CAAC/jB,SAAf,CAAyByd,UAAzB,GAAsC,YAAY;AAC9C,eAAO,KAAKlB,QAAZ;AACH,OAFD;AAGA;;;AACAwH,oBAAc,CAAC/jB,SAAf,CAAyB1E,MAAzB,GAAkC,UAAUuqB,SAAV,EAAqB;AACnD,aAAK1B,SAAL,GAAiB,IAAjB;AACA,aAAKC,UAAL,GAAkByB,SAAS,IAAI,KAA/B;;AACA,YAAI,KAAK3B,UAAL,KAAoB,IAAxB,EAA8B;AAC1BN,cAAI,CAAC,KAAKM,UAAN,CAAJ;AACH;;AACD,YAAI,KAAKD,WAAL,KAAqB,IAAzB,EAA+B;AAC3B,eAAKA,WAAL,CAAiBtZ,KAAjB;AACH;AACJ,OATD;;AAUAoZ,oBAAc,CAAC/jB,SAAf,CAAyBslB,kBAAzB,GAA8C,UAAU9a,MAAV,EAAkB;AAC5D;AACA;AACA,YAAIsb,iBAAiB,GAAGtb,MAAM,IAAI,GAAV,IAAiBA,MAAM,GAAG,GAAlD;AACA,YAAIub,eAAe,GAAG,CAClB;AACA,WAFkB,EAGlB;AACA,WAJkB,CAAtB;AAMA,YAAIC,gBAAgB,GAAGD,eAAe,CAACngB,OAAhB,CAAwB4E,MAAxB,MAAoC,CAAC,CAA5D;AACA,YAAIyb,0BAA0B,GAAG,KAAKvB,qBAAL,CAA2B9e,OAA3B,CAAmC4E,MAAnC,MAA+C,CAAC,CAAjF;AACA,eAAOsb,iBAAiB,IAAIE,gBAArB,IAAyCC,0BAAhD;AACH,OAbD;;AAcA,aAAOlC,cAAP;AACH,KAtJmC,EAApC;AAuJA;;;;;;;AAKA,QAAIkB,gBAAgB;AAAG;AAAe,gBAAY;AAC9C,eAASA,gBAAT,CAA0BU,cAA1B,EAA0CnQ,GAA1C,EAA+C/S,QAA/C,EAAyD;AACrD,aAAKkjB,cAAL,GAAsBA,cAAtB;AACA,aAAKnQ,GAAL,GAAWA,GAAX;AACA,aAAK/S,QAAL,GAAgB,CAAC,CAACA,QAAlB;AACH;;AACD,aAAOwiB,gBAAP;AACH,KAPqC,EAAtC;;AAQA,aAASiB,cAAT,CAAwBlc,OAAxB,EAAiCsT,SAAjC,EAA4C;AACxC,UAAIA,SAAS,KAAK,IAAd,IAAsBA,SAAS,CAACtY,MAAV,GAAmB,CAA7C,EAAgD;AAC5CgF,eAAO,CAAC,eAAD,CAAP,GAA2B,cAAcsT,SAAzC;AACH;AACJ;;AACD,aAAS6I,iBAAT,CAA2Bnc,OAA3B,EAAoC;AAChC,UAAIiF,OAAO,GAAG,OAAO,oDAAP,KAAoB,WAApB,GAAkC,qDAASmX,WAA3C,GAAyD,YAAvE;AACApc,aAAO,CAAC,4BAAD,CAAP,GAAwC,WAAWiF,OAAnD;AACH;;AACD,aAASoX,eAAT,CAAyBrc,OAAzB,EAAkC2X,KAAlC,EAAyC;AACrC,UAAIA,KAAJ,EAAW;AACP3X,eAAO,CAAC,kBAAD,CAAP,GAA8B2X,KAA9B;AACH;AACJ;AACD;;;;;AAGA,aAASnE,WAAT,CAAqBtH,WAArB,EAAkCyL,KAAlC,EAAyCrE,SAAzC,EAAoD+D,IAApD,EAA0D;AACtD,UAAIhQ,SAAS,GAAGF,eAAe,CAAC+E,WAAW,CAAClB,SAAb,CAA/B;AACA,UAAIrS,GAAG,GAAGuT,WAAW,CAACvT,GAAZ,GAAkB0O,SAA5B;AACA,UAAIrH,OAAO,GAAGvL,MAAM,CAACsY,MAAP,CAAc,EAAd,EAAkBb,WAAW,CAAClM,OAA9B,CAAd;AACAqc,qBAAe,CAACrc,OAAD,EAAU2X,KAAV,CAAf;AACAuE,oBAAc,CAAClc,OAAD,EAAUsT,SAAV,CAAd;AACA6I,uBAAiB,CAACnc,OAAD,CAAjB;AACA,aAAO,IAAI+Z,cAAJ,CAAmBphB,GAAnB,EAAwBuT,WAAW,CAACpM,MAApC,EAA4CE,OAA5C,EAAqDkM,WAAW,CAACnM,IAAjE,EAAuEmM,WAAW,CAACf,YAAnF,EAAiGe,WAAW,CAACd,oBAA7G,EAAmIc,WAAW,CAACpB,OAA/I,EAAwJoB,WAAW,CAACjB,YAApK,EAAkLiB,WAAW,CAACnB,OAA9L,EAAuMmB,WAAW,CAAChB,gBAAnN,EAAqOmM,IAArO,CAAP;AACH;AAED;;;;;;;;;;;;;;;;;AAgBA;;;;;;;;AAMA,QAAIiF,OAAO;AAAG;AAAe,gBAAY;AACrC,eAASA,OAAT,CAAiBtoB,GAAjB,EAAsBkjB,YAAtB,EAAoCG,IAApC,EAA0C1e,GAA1C,EAA+C;AAC3C,aAAK2e,OAAL,GAAe,IAAf;;AACA,iBAASH,KAAT,CAAe3O,WAAf,EAA4B9D,GAA5B,EAAiC;AAC7B,iBAAO,IAAImR,SAAJ,CAAcrN,WAAd,EAA2B9D,GAA3B,CAAP;AACH;;AACD,aAAKmN,YAAL,GAAoB,IAAIoF,WAAJ,CAAgBjjB,GAAhB,EAAqBkjB,YAArB,EAAmCC,KAAnC,EAA0C3D,WAA1C,EAAuD,IAAvD,EAA6D6D,IAA7D,CAApB;AACA,aAAKI,IAAL,GAAYzjB,GAAZ;;AACA,YAAI2E,GAAG,IAAI,IAAX,EAAiB;AACb,eAAK2e,OAAL,GAAezT,QAAQ,CAACM,kBAAT,CAA4BxL,GAA5B,CAAf;AACH,SAFD,MAGK;AACD,cAAI4jB,iBAAiB,GAAG,KAAK1K,YAAL,CAAkBxZ,MAAlB,EAAxB;;AACA,cAAIkkB,iBAAiB,IAAI,IAAzB,EAA+B;AAC3B,iBAAKjF,OAAL,GAAe,IAAIzT,QAAJ,CAAa0Y,iBAAb,EAAgC,EAAhC,CAAf;AACH;AACJ;;AACD,aAAKC,UAAL,GAAkB,IAAIC,gBAAJ,CAAqB,IAArB,CAAlB;AACH;AACD;;;;;;AAIAH,aAAO,CAACtmB,SAAR,CAAkB1D,GAAlB,GAAwB,UAAUQ,IAAV,EAAgB;AACpC,iBAAS+c,SAAT,CAAmB/c,IAAnB,EAAyB;AACrB,cAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;AAC1B,kBAAM,uBAAN;AACH;;AACD,cAAI,kBAAkB4pB,IAAlB,CAAuB5pB,IAAvB,CAAJ,EAAkC;AAC9B,kBAAM,4DAAN;AACH;AACJ;;AACDwc,gBAAQ,CAAC,KAAD,EAAQ,CAACa,UAAU,CAACN,SAAD,EAAY,IAAZ,CAAX,CAAR,EAAuCnO,SAAvC,CAAR;;AACA,YAAI,KAAK4V,OAAL,IAAgB,IAApB,EAA0B;AACtB,gBAAM,IAAIzV,KAAJ,CAAU,gDAAV,CAAN;AACH;;AACD,YAAIvP,GAAG,GAAG,IAAIujB,SAAJ,CAAc,KAAKhE,YAAnB,EAAiC,KAAKyF,OAAtC,CAAV;;AACA,YAAIxkB,IAAI,IAAI,IAAZ,EAAkB;AACd,iBAAOR,GAAG,CAACO,KAAJ,CAAUC,IAAV,CAAP;AACH,SAFD,MAGK;AACD,iBAAOR,GAAP;AACH;AACJ,OApBD;AAqBA;;;;;;AAIAgqB,aAAO,CAACtmB,SAAR,CAAkB2mB,UAAlB,GAA+B,UAAUhkB,GAAV,EAAe;AAC1C,iBAASkX,SAAT,CAAmB9R,CAAnB,EAAsB;AAClB,cAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B;AACvB,kBAAM,uBAAN;AACH;;AACD,cAAI,CAAC,kBAAkB2e,IAAlB,CAAuB3e,CAAvB,CAAL,EAAgC;AAC5B,kBAAM,0DAAN;AACH;;AACD,cAAI;AACA8F,oBAAQ,CAACS,WAAT,CAAqBvG,CAArB;AACH,WAFD,CAGA,OAAO5M,CAAP,EAAU;AACN,kBAAM,iDAAN;AACH;AACJ;;AACDme,gBAAQ,CAAC,YAAD,EAAe,CAACa,UAAU,CAACN,SAAD,EAAY,KAAZ,CAAX,CAAf,EAA+CnO,SAA/C,CAAR;AACA,eAAO,IAAImU,SAAJ,CAAc,KAAKhE,YAAnB,EAAiClZ,GAAjC,CAAP;AACH,OAjBD;;AAkBAlE,YAAM,CAAC6B,cAAP,CAAsBgmB,OAAO,CAACtmB,SAA9B,EAAyC,oBAAzC,EAA+D;AAC3DO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKsb,YAAL,CAAkBnE,kBAAlB,EAAP;AACH,SAH0D;AAI3DlX,kBAAU,EAAE,KAJ+C;AAK3DC,oBAAY,EAAE;AAL6C,OAA/D;;AAOA6lB,aAAO,CAACtmB,SAAR,CAAkB2iB,qBAAlB,GAA0C,UAAUC,IAAV,EAAgB;AACtDtJ,gBAAQ,CAAC,uBAAD,EAA0B,CAACmB,qBAAqB,EAAtB,CAA1B,EAAqD/O,SAArD,CAAR;AACA,aAAKmQ,YAAL,CAAkB8G,qBAAlB,CAAwCC,IAAxC;AACH,OAHD;;AAIA0D,aAAO,CAACtmB,SAAR,CAAkB6iB,wBAAlB,GAA6C,UAAUD,IAAV,EAAgB;AACzDtJ,gBAAQ,CAAC,0BAAD,EAA6B,CAACmB,qBAAqB,EAAtB,CAA7B,EAAwD/O,SAAxD,CAAR;AACA,aAAKmQ,YAAL,CAAkBgH,wBAAlB,CAA2CD,IAA3C;AACH,OAHD;;AAIAnkB,YAAM,CAAC6B,cAAP,CAAsBgmB,OAAO,CAACtmB,SAA9B,EAAyC,KAAzC,EAAgD;AAC5CO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKkhB,IAAZ;AACH,SAH2C;AAI5CjhB,kBAAU,EAAE,KAJgC;AAK5CC,oBAAY,EAAE;AAL8B,OAAhD;AAOAhC,YAAM,CAAC6B,cAAP,CAAsBgmB,OAAO,CAACtmB,SAA9B,EAAyC,UAAzC,EAAqD;AACjDO,WAAG,EAAE,eAAY;AACb,iBAAO,KAAKimB,UAAZ;AACH,SAHgD;AAIjDhmB,kBAAU,EAAE,KAJqC;AAKjDC,oBAAY,EAAE;AALmC,OAArD;AAOA,aAAO6lB,OAAP;AACH,KAhG4B,EAA7B;AAiGA;;;;;AAGA,QAAIG,gBAAgB;AAAG;AAAe,gBAAY;AAC9C,eAASA,gBAAT,CAA0B1G,OAA1B,EAAmC;AAC/B,aAAKiC,QAAL,GAAgBjC,OAAhB;AACH;AACD;;;;;;AAIA0G,sBAAgB,CAACzmB,SAAjB,aAAoC,YAAY;AAC5C,aAAKgiB,QAAL,CAAcnG,YAAd,CAA2B6G,SAA3B;AACA,eAAOlZ,OAAO,CAACC,OAAR,EAAP;AACH,OAHD;;AAIA,aAAOgd,gBAAP;AACH,KAbqC,EAAtC;;AAeA,QAAI9iB,IAAI,GAAG,mBAAX;AACA,QAAIsL,OAAO,GAAG,QAAd;AAEA;;;;;;;;;;;;;;;;;AAgBA;;;;AAGA,QAAI2X,YAAY,GAAG,SAAnB;;AACA,aAASjoB,OAAT,CAAiBkoB,SAAjB,EAA4BlkB,GAA5B,EAAiC;AAC7B;AACA,UAAI3E,GAAG,GAAG6oB,SAAS,CAACC,WAAV,CAAsB,KAAtB,EAA6BxE,YAA7B,EAAV;AACA,UAAIpB,YAAY,GAAG2F,SAAS,CAACC,WAAV,CAAsB,eAAtB,CAAnB;AACA,aAAO,IAAIR,OAAJ,CAAYtoB,GAAZ,EAAiBkjB,YAAjB,EAA+B,IAAI/V,SAAJ,EAA/B,EAAgDxI,GAAhD,CAAP;AACH;;AACD,aAASokB,eAAT,CAAyBC,QAAzB,EAAmC;AAC/B,UAAIC,gBAAgB,GAAG;AACnB;AACAtf,iBAAS,EAAEA,SAFQ;AAGnBT,iBAAS,EAAEA,SAHQ;AAInBpD,oBAAY,EAAEA,YAJK;AAKnBojB,eAAO,EAAEZ,OALU;AAMnBzG,iBAAS,EAAEA;AANQ,OAAvB;AAQAmH,cAAQ,CAACG,QAAT,CAAkBC,iBAAlB,CAAoC,IAAI,6DAAJ,CAAcR,YAAd,EAA4BjoB,OAA5B,EAAqC;AAAS;AAA9C,QAC/B0oB,eAD+B,CACfJ,gBADe,EAE/BK,oBAF+B,CAEV,IAFU,CAApC;AAGAN,cAAQ,CAACO,eAAT,CAAyB5jB,IAAzB,EAA+BsL,OAA/B;AACH;;AACD8X,mBAAe,CAAC,oDAAD,CAAf,C,CAGA;;;;;;;;;;;;;;;;;ACr/GA;AAAA;;;AAAA;AAAA;AAAA,0D,CACA","file":"default~edit-products-edit-products-module~edit-profile-edit-profile-module~offers-provider-offers-p~31cc0df5-es5.js","sourcesContent":["import { Observable, of, from } from 'rxjs';\nimport { map, observeOn, switchMap } from 'rxjs/operators';\nimport { InjectionToken, Injectable, Inject, Optional, PLATFORM_ID, NgZone, ɵɵdefineInjectable, ɵɵinject, NgModule } from '@angular/core';\nimport { ɵAngularFireSchedulers, ɵkeepUnstableUntilFirstFactory, ɵfirebaseAppFactory, FIREBASE_OPTIONS, FIREBASE_APP_NAME } from '@angular/fire';\nimport 'firebase/storage';\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n/**\n * @param {?} task\n * @return {?}\n */\nimport * as ɵngcc0 from '@angular/core';\nfunction fromTask(task) {\n    return new Observable((/**\n     * @param {?} subscriber\n     * @return {?}\n     */\n    subscriber => {\n        /** @type {?} */\n        const progress = (/**\n         * @param {?} snap\n         * @return {?}\n         */\n        (snap) => subscriber.next(snap));\n        /** @type {?} */\n        const error = (/**\n         * @param {?} e\n         * @return {?}\n         */\n        e => subscriber.error(e));\n        /** @type {?} */\n        const complete = (/**\n         * @return {?}\n         */\n        () => subscriber.complete());\n        task.on('state_changed', progress, error, complete);\n        return (/**\n         * @return {?}\n         */\n        () => task.cancel());\n    }));\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n/**\n * @record\n */\nfunction AngularFireUploadTask() { }\nif (false) {\n    /** @type {?} */\n    AngularFireUploadTask.prototype.task;\n    /**\n     * @return {?}\n     */\n    AngularFireUploadTask.prototype.snapshotChanges = function () { };\n    /**\n     * @return {?}\n     */\n    AngularFireUploadTask.prototype.percentageChanges = function () { };\n    /**\n     * @return {?}\n     */\n    AngularFireUploadTask.prototype.pause = function () { };\n    /**\n     * @return {?}\n     */\n    AngularFireUploadTask.prototype.cancel = function () { };\n    /**\n     * @return {?}\n     */\n    AngularFireUploadTask.prototype.resume = function () { };\n    /**\n     * @param {?=} onFulfilled\n     * @param {?=} onRejected\n     * @return {?}\n     */\n    AngularFireUploadTask.prototype.then = function (onFulfilled, onRejected) { };\n    /**\n     * @param {?} onRejected\n     * @return {?}\n     */\n    AngularFireUploadTask.prototype.catch = function (onRejected) { };\n}\n/**\n * Create an AngularFireUploadTask from a regular UploadTask from the Storage SDK.\n * This method creates an observable of the upload and returns on object that provides\n * multiple methods for controlling and monitoring the file upload.\n * @param {?} task\n * @return {?}\n */\nfunction createUploadTask(task) {\n    /** @type {?} */\n    const inner$ = fromTask(task);\n    return {\n        task,\n        then: task.then.bind(task),\n        catch: task.catch.bind(task),\n        pause: task.pause.bind(task),\n        cancel: task.cancel.bind(task),\n        resume: task.resume.bind(task),\n        snapshotChanges: (/**\n         * @return {?}\n         */\n        () => inner$),\n        percentageChanges: (/**\n         * @return {?}\n         */\n        () => inner$.pipe(map((/**\n         * @param {?} s\n         * @return {?}\n         */\n        s => s.bytesTransferred / s.totalBytes * 100))))\n    };\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n/**\n * @record\n */\nfunction AngularFireStorageReference() { }\nif (false) {\n    /**\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.getDownloadURL = function () { };\n    /**\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.getMetadata = function () { };\n    /**\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.delete = function () { };\n    /**\n     * @param {?} path\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.child = function (path) { };\n    /**\n     * @param {?} meta\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.updateMetadata = function (meta) { };\n    /**\n     * @param {?} data\n     * @param {?=} metadata\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.put = function (data, metadata) { };\n    /**\n     * @param {?} data\n     * @param {?=} format\n     * @param {?=} metadata\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.putString = function (data, format, metadata) { };\n    /**\n     * @return {?}\n     */\n    AngularFireStorageReference.prototype.listAll = function () { };\n}\n/**\n * Create an AngularFire wrapped Storage Reference. This object\n * creates observable methods from promise based methods.\n * @param {?} ref\n * @param {?} schedulers\n * @param {?} keepUnstableUntilFirst\n * @return {?}\n */\nfunction createStorageRef(ref, schedulers, keepUnstableUntilFirst) {\n    return {\n        getDownloadURL: (/**\n         * @return {?}\n         */\n        () => of(undefined).pipe(observeOn(schedulers.outsideAngular), switchMap((/**\n         * @return {?}\n         */\n        () => ref.getDownloadURL())), keepUnstableUntilFirst)),\n        getMetadata: (/**\n         * @return {?}\n         */\n        () => of(undefined).pipe(observeOn(schedulers.outsideAngular), switchMap((/**\n         * @return {?}\n         */\n        () => ref.getMetadata())), keepUnstableUntilFirst)),\n        delete: (/**\n         * @return {?}\n         */\n        () => from(ref.delete())),\n        child: (/**\n         * @param {?} path\n         * @return {?}\n         */\n        (path) => createStorageRef(ref.child(path), schedulers, keepUnstableUntilFirst)),\n        updateMetadata: (/**\n         * @param {?} meta\n         * @return {?}\n         */\n        (meta) => from(ref.updateMetadata(meta))),\n        put: (/**\n         * @param {?} data\n         * @param {?=} metadata\n         * @return {?}\n         */\n        (data, metadata) => {\n            /** @type {?} */\n            const task = ref.put(data, metadata);\n            return createUploadTask(task);\n        }),\n        putString: (/**\n         * @param {?} data\n         * @param {?=} format\n         * @param {?=} metadata\n         * @return {?}\n         */\n        (data, format, metadata) => {\n            /** @type {?} */\n            const task = ref.putString(data, format, metadata);\n            return createUploadTask(task);\n        }),\n        listAll: (/**\n         * @return {?}\n         */\n        () => from(ref.listAll()))\n    };\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst BUCKET = new InjectionToken('angularfire2.storageBucket');\n/**\n * AngularFireStorage Service\n *\n * This service is the main entry point for this feature module. It provides\n * an API for uploading and downloading binary files from Cloud Storage for\n * Firebase.\n */\nclass AngularFireStorage {\n    /**\n     * @param {?} options\n     * @param {?} nameOrConfig\n     * @param {?} storageBucket\n     * @param {?} platformId\n     * @param {?} zone\n     */\n    constructor(options, nameOrConfig, storageBucket, \n    // tslint:disable-next-line:ban-types\n    platformId, zone) {\n        this.schedulers = new ɵAngularFireSchedulers(zone);\n        this.keepUnstableUntilFirst = ɵkeepUnstableUntilFirstFactory(this.schedulers);\n        this.storage = zone.runOutsideAngular((/**\n         * @return {?}\n         */\n        () => {\n            /** @type {?} */\n            const app = ɵfirebaseAppFactory(options, zone, nameOrConfig);\n            return app.storage(storageBucket || undefined);\n        }));\n    }\n    /**\n     * @param {?} path\n     * @return {?}\n     */\n    ref(path) {\n        return createStorageRef(this.storage.ref(path), this.schedulers, this.keepUnstableUntilFirst);\n    }\n    /**\n     * @param {?} path\n     * @param {?} data\n     * @param {?=} metadata\n     * @return {?}\n     */\n    upload(path, data, metadata) {\n        /** @type {?} */\n        const storageRef = this.storage.ref(path);\n        /** @type {?} */\n        const ref = createStorageRef(storageRef, this.schedulers, this.keepUnstableUntilFirst);\n        return ref.put(data, metadata);\n    }\n}\nAngularFireStorage.ɵfac = function AngularFireStorage_Factory(t) { return new (t || AngularFireStorage)(ɵngcc0.ɵɵinject(FIREBASE_OPTIONS), ɵngcc0.ɵɵinject(FIREBASE_APP_NAME, 8), ɵngcc0.ɵɵinject(BUCKET, 8), ɵngcc0.ɵɵinject(PLATFORM_ID), ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };\n/** @nocollapse */\nAngularFireStorage.ctorParameters = () => [\n    { type: undefined, decorators: [{ type: Inject, args: [FIREBASE_OPTIONS,] }] },\n    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [FIREBASE_APP_NAME,] }] },\n    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [BUCKET,] }] },\n    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },\n    { type: NgZone }\n];\n/** @nocollapse */ AngularFireStorage.ɵprov = ɵɵdefineInjectable({ factory: function AngularFireStorage_Factory() { return new AngularFireStorage(ɵɵinject(FIREBASE_OPTIONS), ɵɵinject(FIREBASE_APP_NAME, 8), ɵɵinject(BUCKET, 8), ɵɵinject(PLATFORM_ID), ɵɵinject(NgZone)); }, token: AngularFireStorage, providedIn: \"any\" });\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(AngularFireStorage, [{\n        type: Injectable,\n        args: [{\n                providedIn: 'any'\n            }]\n    }], function () { return [{ type: undefined, decorators: [{\n                type: Inject,\n                args: [FIREBASE_OPTIONS]\n            }] }, { type: undefined, decorators: [{\n                type: Optional\n            }, {\n                type: Inject,\n                args: [FIREBASE_APP_NAME]\n            }] }, { type: undefined, decorators: [{\n                type: Optional\n            }, {\n                type: Inject,\n                args: [BUCKET]\n            }] }, { type: Object, decorators: [{\n                type: Inject,\n                args: [PLATFORM_ID]\n            }] }, { type: ɵngcc0.NgZone }]; }, null); })();\nif (false) {\n    /** @type {?} */\n    AngularFireStorage.prototype.storage;\n    /** @type {?} */\n    AngularFireStorage.prototype.keepUnstableUntilFirst;\n    /** @type {?} */\n    AngularFireStorage.prototype.schedulers;\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\nclass AngularFireStorageModule {\n}\nAngularFireStorageModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: AngularFireStorageModule });\nAngularFireStorageModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function AngularFireStorageModule_Factory(t) { return new (t || AngularFireStorageModule)(); }, providers: [AngularFireStorage] });\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(AngularFireStorageModule, [{\n        type: NgModule,\n        args: [{\n                providers: [AngularFireStorage]\n            }]\n    }], null, null); })();\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\n */\n\nexport { AngularFireStorage, AngularFireStorageModule, BUCKET, createStorageRef, createUploadTask, fromTask };\n\n//# sourceMappingURL=angular-fire-storage.js.map","import firebase from '@firebase/app';\nimport { __awaiter, __generator, __spreadArrays } from 'tslib';\nimport { Component } from '@firebase/component';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Constants used in the Firebase Storage library.\r\n */\r\n/**\r\n * Domain name for firebase storage.\r\n */\r\nvar DEFAULT_HOST = 'firebasestorage.googleapis.com';\r\n/**\r\n * The key in Firebase config json for the storage bucket.\r\n */\r\nvar CONFIG_STORAGE_BUCKET_KEY = 'storageBucket';\r\n/**\r\n * 2 minutes\r\n *\r\n * The timeout for all operations except upload.\r\n */\r\nvar DEFAULT_MAX_OPERATION_RETRY_TIME = 2 * 60 * 1000;\r\n/**\r\n * 10 minutes\r\n *\r\n * The timeout for upload.\r\n */\r\nvar DEFAULT_MAX_UPLOAD_RETRY_TIME = 10 * 60 * 1000;\r\n/**\r\n * This is the value of Number.MIN_SAFE_INTEGER, which is not well supported\r\n * enough for us to use it directly.\r\n */\r\nvar MIN_SAFE_INTEGER = -9007199254740991;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar FirebaseStorageError = /** @class */ (function () {\r\n    function FirebaseStorageError(code, message) {\r\n        this.code_ = prependCode(code);\r\n        this.message_ = 'Firebase Storage: ' + message;\r\n        this.serverResponse_ = null;\r\n        this.name_ = 'FirebaseError';\r\n    }\r\n    FirebaseStorageError.prototype.codeProp = function () {\r\n        return this.code;\r\n    };\r\n    FirebaseStorageError.prototype.codeEquals = function (code) {\r\n        return prependCode(code) === this.codeProp();\r\n    };\r\n    FirebaseStorageError.prototype.serverResponseProp = function () {\r\n        return this.serverResponse_;\r\n    };\r\n    FirebaseStorageError.prototype.setServerResponseProp = function (serverResponse) {\r\n        this.serverResponse_ = serverResponse;\r\n    };\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"name\", {\r\n        get: function () {\r\n            return this.name_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"code\", {\r\n        get: function () {\r\n            return this.code_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"message\", {\r\n        get: function () {\r\n            return this.message_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"serverResponse\", {\r\n        get: function () {\r\n            return this.serverResponse_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return FirebaseStorageError;\r\n}());\r\nvar Code = {\r\n    // Shared between all platforms\r\n    UNKNOWN: 'unknown',\r\n    OBJECT_NOT_FOUND: 'object-not-found',\r\n    BUCKET_NOT_FOUND: 'bucket-not-found',\r\n    PROJECT_NOT_FOUND: 'project-not-found',\r\n    QUOTA_EXCEEDED: 'quota-exceeded',\r\n    UNAUTHENTICATED: 'unauthenticated',\r\n    UNAUTHORIZED: 'unauthorized',\r\n    RETRY_LIMIT_EXCEEDED: 'retry-limit-exceeded',\r\n    INVALID_CHECKSUM: 'invalid-checksum',\r\n    CANCELED: 'canceled',\r\n    // JS specific\r\n    INVALID_EVENT_NAME: 'invalid-event-name',\r\n    INVALID_URL: 'invalid-url',\r\n    INVALID_DEFAULT_BUCKET: 'invalid-default-bucket',\r\n    NO_DEFAULT_BUCKET: 'no-default-bucket',\r\n    CANNOT_SLICE_BLOB: 'cannot-slice-blob',\r\n    SERVER_FILE_WRONG_SIZE: 'server-file-wrong-size',\r\n    NO_DOWNLOAD_URL: 'no-download-url',\r\n    INVALID_ARGUMENT: 'invalid-argument',\r\n    INVALID_ARGUMENT_COUNT: 'invalid-argument-count',\r\n    APP_DELETED: 'app-deleted',\r\n    INVALID_ROOT_OPERATION: 'invalid-root-operation',\r\n    INVALID_FORMAT: 'invalid-format',\r\n    INTERNAL_ERROR: 'internal-error'\r\n};\r\nfunction prependCode(code) {\r\n    return 'storage/' + code;\r\n}\r\nfunction unknown() {\r\n    var message = 'An unknown error occurred, please check the error payload for ' +\r\n        'server response.';\r\n    return new FirebaseStorageError(Code.UNKNOWN, message);\r\n}\r\nfunction objectNotFound(path) {\r\n    return new FirebaseStorageError(Code.OBJECT_NOT_FOUND, \"Object '\" + path + \"' does not exist.\");\r\n}\r\nfunction quotaExceeded(bucket) {\r\n    return new FirebaseStorageError(Code.QUOTA_EXCEEDED, \"Quota for bucket '\" +\r\n        bucket +\r\n        \"' exceeded, please view quota on \" +\r\n        'https://firebase.google.com/pricing/.');\r\n}\r\nfunction unauthenticated() {\r\n    var message = 'User is not authenticated, please authenticate using Firebase ' +\r\n        'Authentication and try again.';\r\n    return new FirebaseStorageError(Code.UNAUTHENTICATED, message);\r\n}\r\nfunction unauthorized(path) {\r\n    return new FirebaseStorageError(Code.UNAUTHORIZED, \"User does not have permission to access '\" + path + \"'.\");\r\n}\r\nfunction retryLimitExceeded() {\r\n    return new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED, 'Max retry time for operation exceeded, please try again.');\r\n}\r\nfunction canceled() {\r\n    return new FirebaseStorageError(Code.CANCELED, 'User canceled the upload/download.');\r\n}\r\nfunction invalidUrl(url) {\r\n    return new FirebaseStorageError(Code.INVALID_URL, \"Invalid URL '\" + url + \"'.\");\r\n}\r\nfunction invalidDefaultBucket(bucket) {\r\n    return new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET, \"Invalid default bucket '\" + bucket + \"'.\");\r\n}\r\nfunction cannotSliceBlob() {\r\n    return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB, 'Cannot slice blob for upload. Please retry the upload.');\r\n}\r\nfunction serverFileWrongSize() {\r\n    return new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE, 'Server recorded incorrect upload file size, please retry the upload.');\r\n}\r\nfunction noDownloadURL() {\r\n    return new FirebaseStorageError(Code.NO_DOWNLOAD_URL, 'The given file does not have any download URLs.');\r\n}\r\nfunction invalidArgument(index, fnName, message) {\r\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT, 'Invalid argument in `' + fnName + '` at index ' + index + ': ' + message);\r\n}\r\nfunction invalidArgumentCount(argMin, argMax, fnName, real) {\r\n    var countPart;\r\n    var plural;\r\n    if (argMin === argMax) {\r\n        countPart = argMin;\r\n        plural = argMin === 1 ? 'argument' : 'arguments';\r\n    }\r\n    else {\r\n        countPart = 'between ' + argMin + ' and ' + argMax;\r\n        plural = 'arguments';\r\n    }\r\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT_COUNT, 'Invalid argument count in `' +\r\n        fnName +\r\n        '`: Expected ' +\r\n        countPart +\r\n        ' ' +\r\n        plural +\r\n        ', received ' +\r\n        real +\r\n        '.');\r\n}\r\nfunction appDeleted() {\r\n    return new FirebaseStorageError(Code.APP_DELETED, 'The Firebase app was deleted.');\r\n}\r\n/**\r\n * @param name The name of the operation that was invalid.\r\n */\r\nfunction invalidRootOperation(name) {\r\n    return new FirebaseStorageError(Code.INVALID_ROOT_OPERATION, \"The operation '\" +\r\n        name +\r\n        \"' cannot be performed on a root reference, create a non-root \" +\r\n        \"reference using child, such as .child('file.png').\");\r\n}\r\n/**\r\n * @param format The format that was not valid.\r\n * @param message A message describing the format violation.\r\n */\r\nfunction invalidFormat(format, message) {\r\n    return new FirebaseStorageError(Code.INVALID_FORMAT, \"String does not match format '\" + format + \"': \" + message);\r\n}\r\n/**\r\n * @param message A message describing the internal error.\r\n */\r\nfunction internalError(message) {\r\n    throw new FirebaseStorageError(Code.INTERNAL_ERROR, 'Internal error: ' + message);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar StringFormat = {\r\n    RAW: 'raw',\r\n    BASE64: 'base64',\r\n    BASE64URL: 'base64url',\r\n    DATA_URL: 'data_url'\r\n};\r\nfunction formatValidator(stringFormat) {\r\n    switch (stringFormat) {\r\n        case StringFormat.RAW:\r\n        case StringFormat.BASE64:\r\n        case StringFormat.BASE64URL:\r\n        case StringFormat.DATA_URL:\r\n            return;\r\n        default:\r\n            throw ('Expected one of the event types: [' +\r\n                StringFormat.RAW +\r\n                ', ' +\r\n                StringFormat.BASE64 +\r\n                ', ' +\r\n                StringFormat.BASE64URL +\r\n                ', ' +\r\n                StringFormat.DATA_URL +\r\n                '].');\r\n    }\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar StringData = /** @class */ (function () {\r\n    function StringData(data, contentType) {\r\n        this.data = data;\r\n        this.contentType = contentType || null;\r\n    }\r\n    return StringData;\r\n}());\r\nfunction dataFromString(format, stringData) {\r\n    switch (format) {\r\n        case StringFormat.RAW:\r\n            return new StringData(utf8Bytes_(stringData));\r\n        case StringFormat.BASE64:\r\n        case StringFormat.BASE64URL:\r\n            return new StringData(base64Bytes_(format, stringData));\r\n        case StringFormat.DATA_URL:\r\n            return new StringData(dataURLBytes_(stringData), dataURLContentType_(stringData));\r\n        // do nothing\r\n    }\r\n    // assert(false);\r\n    throw unknown();\r\n}\r\nfunction utf8Bytes_(value) {\r\n    var b = [];\r\n    for (var i = 0; i < value.length; i++) {\r\n        var c = value.charCodeAt(i);\r\n        if (c <= 127) {\r\n            b.push(c);\r\n        }\r\n        else {\r\n            if (c <= 2047) {\r\n                b.push(192 | (c >> 6), 128 | (c & 63));\r\n            }\r\n            else {\r\n                if ((c & 64512) === 55296) {\r\n                    // The start of a surrogate pair.\r\n                    var valid = i < value.length - 1 && (value.charCodeAt(i + 1) & 64512) === 56320;\r\n                    if (!valid) {\r\n                        // The second surrogate wasn't there.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        var hi = c;\r\n                        var lo = value.charCodeAt(++i);\r\n                        c = 65536 | ((hi & 1023) << 10) | (lo & 1023);\r\n                        b.push(240 | (c >> 18), 128 | ((c >> 12) & 63), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n                else {\r\n                    if ((c & 64512) === 56320) {\r\n                        // Invalid low surrogate.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        b.push(224 | (c >> 12), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return new Uint8Array(b);\r\n}\r\nfunction percentEncodedBytes_(value) {\r\n    var decoded;\r\n    try {\r\n        decoded = decodeURIComponent(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(StringFormat.DATA_URL, 'Malformed data URL.');\r\n    }\r\n    return utf8Bytes_(decoded);\r\n}\r\nfunction base64Bytes_(format, value) {\r\n    switch (format) {\r\n        case StringFormat.BASE64: {\r\n            var hasMinus = value.indexOf('-') !== -1;\r\n            var hasUnder = value.indexOf('_') !== -1;\r\n            if (hasMinus || hasUnder) {\r\n                var invalidChar = hasMinus ? '-' : '_';\r\n                throw invalidFormat(format, \"Invalid character '\" +\r\n                    invalidChar +\r\n                    \"' found: is it base64url encoded?\");\r\n            }\r\n            break;\r\n        }\r\n        case StringFormat.BASE64URL: {\r\n            var hasPlus = value.indexOf('+') !== -1;\r\n            var hasSlash = value.indexOf('/') !== -1;\r\n            if (hasPlus || hasSlash) {\r\n                var invalidChar = hasPlus ? '+' : '/';\r\n                throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64 encoded?\");\r\n            }\r\n            value = value.replace(/-/g, '+').replace(/_/g, '/');\r\n            break;\r\n        }\r\n        // do nothing\r\n    }\r\n    var bytes;\r\n    try {\r\n        bytes = atob(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(format, 'Invalid character found');\r\n    }\r\n    var array = new Uint8Array(bytes.length);\r\n    for (var i = 0; i < bytes.length; i++) {\r\n        array[i] = bytes.charCodeAt(i);\r\n    }\r\n    return array;\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar DataURLParts = /** @class */ (function () {\r\n    function DataURLParts(dataURL) {\r\n        this.base64 = false;\r\n        this.contentType = null;\r\n        var matches = dataURL.match(/^data:([^,]+)?,/);\r\n        if (matches === null) {\r\n            throw invalidFormat(StringFormat.DATA_URL, \"Must be formatted 'data:[<mediatype>][;base64],<data>\");\r\n        }\r\n        var middle = matches[1] || null;\r\n        if (middle != null) {\r\n            this.base64 = endsWith(middle, ';base64');\r\n            this.contentType = this.base64\r\n                ? middle.substring(0, middle.length - ';base64'.length)\r\n                : middle;\r\n        }\r\n        this.rest = dataURL.substring(dataURL.indexOf(',') + 1);\r\n    }\r\n    return DataURLParts;\r\n}());\r\nfunction dataURLBytes_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    if (parts.base64) {\r\n        return base64Bytes_(StringFormat.BASE64, parts.rest);\r\n    }\r\n    else {\r\n        return percentEncodedBytes_(parts.rest);\r\n    }\r\n}\r\nfunction dataURLContentType_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    return parts.contentType;\r\n}\r\nfunction endsWith(s, end) {\r\n    var longEnough = s.length >= end.length;\r\n    if (!longEnough) {\r\n        return false;\r\n    }\r\n    return s.substring(s.length - end.length) === end;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TaskEvent = {\r\n    /** Triggered whenever the task changes or progress is updated. */\r\n    STATE_CHANGED: 'state_changed'\r\n};\r\nvar InternalTaskState = {\r\n    RUNNING: 'running',\r\n    PAUSING: 'pausing',\r\n    PAUSED: 'paused',\r\n    SUCCESS: 'success',\r\n    CANCELING: 'canceling',\r\n    CANCELED: 'canceled',\r\n    ERROR: 'error'\r\n};\r\nvar TaskState = {\r\n    /** The task is currently transferring data. */\r\n    RUNNING: 'running',\r\n    /** The task was paused by the user. */\r\n    PAUSED: 'paused',\r\n    /** The task completed successfully. */\r\n    SUCCESS: 'success',\r\n    /** The task was canceled. */\r\n    CANCELED: 'canceled',\r\n    /** The task failed with an error. */\r\n    ERROR: 'error'\r\n};\r\nfunction taskStateFromInternalTaskState(state) {\r\n    switch (state) {\r\n        case InternalTaskState.RUNNING:\r\n        case InternalTaskState.PAUSING:\r\n        case InternalTaskState.CANCELING:\r\n            return TaskState.RUNNING;\r\n        case InternalTaskState.PAUSED:\r\n            return TaskState.PAUSED;\r\n        case InternalTaskState.SUCCESS:\r\n            return TaskState.SUCCESS;\r\n        case InternalTaskState.CANCELED:\r\n            return TaskState.CANCELED;\r\n        case InternalTaskState.ERROR:\r\n            return TaskState.ERROR;\r\n        default:\r\n            // TODO(andysoto): assert(false);\r\n            return TaskState.ERROR;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @return False if the object is undefined or null, true otherwise.\r\n */\r\nfunction isDef(p) {\r\n    return p != null;\r\n}\r\nfunction isJustDef(p) {\r\n    return p !== void 0;\r\n}\r\nfunction isFunction(p) {\r\n    return typeof p === 'function';\r\n}\r\nfunction isObject(p) {\r\n    return typeof p === 'object';\r\n}\r\nfunction isNonNullObject(p) {\r\n    return isObject(p) && p !== null;\r\n}\r\nfunction isNonArrayObject(p) {\r\n    return isObject(p) && !Array.isArray(p);\r\n}\r\nfunction isString(p) {\r\n    return typeof p === 'string' || p instanceof String;\r\n}\r\nfunction isInteger(p) {\r\n    return isNumber(p) && Number.isInteger(p);\r\n}\r\nfunction isNumber(p) {\r\n    return typeof p === 'number' || p instanceof Number;\r\n}\r\nfunction isNativeBlob(p) {\r\n    return isNativeBlobDefined() && p instanceof Blob;\r\n}\r\nfunction isNativeBlobDefined() {\r\n    return typeof Blob !== 'undefined';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @enum{number}\r\n */\r\nvar ErrorCode;\r\n(function (ErrorCode) {\r\n    ErrorCode[ErrorCode[\"NO_ERROR\"] = 0] = \"NO_ERROR\";\r\n    ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 1] = \"NETWORK_ERROR\";\r\n    ErrorCode[ErrorCode[\"ABORT\"] = 2] = \"ABORT\";\r\n})(ErrorCode || (ErrorCode = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * We use this instead of goog.net.XhrIo because goog.net.XhrIo is hyuuuuge and\r\n * doesn't work in React Native on Android.\r\n */\r\nvar NetworkXhrIo = /** @class */ (function () {\r\n    function NetworkXhrIo() {\r\n        var _this = this;\r\n        this.sent_ = false;\r\n        this.xhr_ = new XMLHttpRequest();\r\n        this.errorCode_ = ErrorCode.NO_ERROR;\r\n        this.sendPromise_ = new Promise(function (resolve) {\r\n            _this.xhr_.addEventListener('abort', function () {\r\n                _this.errorCode_ = ErrorCode.ABORT;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('error', function () {\r\n                _this.errorCode_ = ErrorCode.NETWORK_ERROR;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('load', function () {\r\n                resolve(_this);\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.send = function (url, method, body, headers) {\r\n        if (this.sent_) {\r\n            throw internalError('cannot .send() more than once');\r\n        }\r\n        this.sent_ = true;\r\n        this.xhr_.open(method, url, true);\r\n        if (isDef(headers)) {\r\n            for (var key in headers) {\r\n                if (headers.hasOwnProperty(key)) {\r\n                    this.xhr_.setRequestHeader(key, headers[key].toString());\r\n                }\r\n            }\r\n        }\r\n        if (isDef(body)) {\r\n            this.xhr_.send(body);\r\n        }\r\n        else {\r\n            this.xhr_.send();\r\n        }\r\n        return this.sendPromise_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getErrorCode = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getErrorCode() before sending');\r\n        }\r\n        return this.errorCode_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getStatus = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getStatus() before sending');\r\n        }\r\n        try {\r\n            return this.xhr_.status;\r\n        }\r\n        catch (e) {\r\n            return -1;\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseText = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getResponseText() before sending');\r\n        }\r\n        return this.xhr_.responseText;\r\n    };\r\n    /**\r\n     * Aborts the request.\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.abort = function () {\r\n        this.xhr_.abort();\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseHeader = function (header) {\r\n        return this.xhr_.getResponseHeader(header);\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.addUploadProgressListener = function (listener) {\r\n        if (isDef(this.xhr_.upload)) {\r\n            this.xhr_.upload.addEventListener('progress', listener);\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.removeUploadProgressListener = function (listener) {\r\n        if (isDef(this.xhr_.upload)) {\r\n            this.xhr_.upload.removeEventListener('progress', listener);\r\n        }\r\n    };\r\n    return NetworkXhrIo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Factory-like class for creating XhrIo instances.\r\n */\r\nvar XhrIoPool = /** @class */ (function () {\r\n    function XhrIoPool() {\r\n    }\r\n    XhrIoPool.prototype.createXhrIo = function () {\r\n        return new NetworkXhrIo();\r\n    };\r\n    return XhrIoPool;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getBlobBuilder() {\r\n    if (typeof BlobBuilder !== 'undefined') {\r\n        return BlobBuilder;\r\n    }\r\n    else if (typeof WebKitBlobBuilder !== 'undefined') {\r\n        return WebKitBlobBuilder;\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\n/**\r\n * Concatenates one or more values together and converts them to a Blob.\r\n *\r\n * @param args The values that will make up the resulting blob.\r\n * @return The blob.\r\n */\r\nfunction getBlob() {\r\n    var args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        args[_i] = arguments[_i];\r\n    }\r\n    var BlobBuilder = getBlobBuilder();\r\n    if (BlobBuilder !== undefined) {\r\n        var bb = new BlobBuilder();\r\n        for (var i = 0; i < args.length; i++) {\r\n            bb.append(args[i]);\r\n        }\r\n        return bb.getBlob();\r\n    }\r\n    else {\r\n        if (isNativeBlobDefined()) {\r\n            return new Blob(args);\r\n        }\r\n        else {\r\n            throw Error(\"This browser doesn't seem to support creating Blobs\");\r\n        }\r\n    }\r\n}\r\n/**\r\n * Slices the blob. The returned blob contains data from the start byte\r\n * (inclusive) till the end byte (exclusive). Negative indices cannot be used.\r\n *\r\n * @param blob The blob to be sliced.\r\n * @param start Index of the starting byte.\r\n * @param end Index of the ending byte.\r\n * @return The blob slice or null if not supported.\r\n */\r\nfunction sliceBlob(blob, start, end) {\r\n    if (blob.webkitSlice) {\r\n        return blob.webkitSlice(start, end);\r\n    }\r\n    else if (blob.mozSlice) {\r\n        return blob.mozSlice(start, end);\r\n    }\r\n    else if (blob.slice) {\r\n        return blob.slice(start, end);\r\n    }\r\n    return null;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param opt_elideCopy If true, doesn't copy mutable input data\r\n *     (e.g. Uint8Arrays). Pass true only if you know the objects will not be\r\n *     modified after this blob's construction.\r\n */\r\nvar FbsBlob = /** @class */ (function () {\r\n    function FbsBlob(data, elideCopy) {\r\n        var size = 0;\r\n        var blobType = '';\r\n        if (isNativeBlob(data)) {\r\n            this.data_ = data;\r\n            size = data.size;\r\n            blobType = data.type;\r\n        }\r\n        else if (data instanceof ArrayBuffer) {\r\n            if (elideCopy) {\r\n                this.data_ = new Uint8Array(data);\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.byteLength);\r\n                this.data_.set(new Uint8Array(data));\r\n            }\r\n            size = this.data_.length;\r\n        }\r\n        else if (data instanceof Uint8Array) {\r\n            if (elideCopy) {\r\n                this.data_ = data;\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.length);\r\n                this.data_.set(data);\r\n            }\r\n            size = data.length;\r\n        }\r\n        this.size_ = size;\r\n        this.type_ = blobType;\r\n    }\r\n    FbsBlob.prototype.size = function () {\r\n        return this.size_;\r\n    };\r\n    FbsBlob.prototype.type = function () {\r\n        return this.type_;\r\n    };\r\n    FbsBlob.prototype.slice = function (startByte, endByte) {\r\n        if (isNativeBlob(this.data_)) {\r\n            var realBlob = this.data_;\r\n            var sliced = sliceBlob(realBlob, startByte, endByte);\r\n            if (sliced === null) {\r\n                return null;\r\n            }\r\n            return new FbsBlob(sliced);\r\n        }\r\n        else {\r\n            var slice = new Uint8Array(this.data_.buffer, startByte, endByte - startByte);\r\n            return new FbsBlob(slice, true);\r\n        }\r\n    };\r\n    FbsBlob.getBlob = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (isNativeBlobDefined()) {\r\n            var blobby = args.map(function (val) {\r\n                if (val instanceof FbsBlob) {\r\n                    return val.data_;\r\n                }\r\n                else {\r\n                    return val;\r\n                }\r\n            });\r\n            return new FbsBlob(getBlob.apply(null, blobby));\r\n        }\r\n        else {\r\n            var uint8Arrays = args.map(function (val) {\r\n                if (isString(val)) {\r\n                    return dataFromString(StringFormat.RAW, val).data;\r\n                }\r\n                else {\r\n                    // Blobs don't exist, so this has to be a Uint8Array.\r\n                    return val.data_;\r\n                }\r\n            });\r\n            var finalLength_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                finalLength_1 += array.byteLength;\r\n            });\r\n            var merged_1 = new Uint8Array(finalLength_1);\r\n            var index_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                for (var i = 0; i < array.length; i++) {\r\n                    merged_1[index_1++] = array[i];\r\n                }\r\n            });\r\n            return new FbsBlob(merged_1, true);\r\n        }\r\n    };\r\n    FbsBlob.prototype.uploadData = function () {\r\n        return this.data_;\r\n    };\r\n    return FbsBlob;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n */\r\nvar Location = /** @class */ (function () {\r\n    function Location(bucket, path) {\r\n        this.bucket = bucket;\r\n        this.path_ = path;\r\n    }\r\n    Object.defineProperty(Location.prototype, \"path\", {\r\n        get: function () {\r\n            return this.path_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Location.prototype, \"isRoot\", {\r\n        get: function () {\r\n            return this.path.length === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Location.prototype.fullServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o/' + encode(this.path);\r\n    };\r\n    Location.prototype.bucketOnlyServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o';\r\n    };\r\n    Location.makeFromBucketSpec = function (bucketString) {\r\n        var bucketLocation;\r\n        try {\r\n            bucketLocation = Location.makeFromUrl(bucketString);\r\n        }\r\n        catch (e) {\r\n            // Not valid URL, use as-is. This lets you put bare bucket names in\r\n            // config.\r\n            return new Location(bucketString, '');\r\n        }\r\n        if (bucketLocation.path === '') {\r\n            return bucketLocation;\r\n        }\r\n        else {\r\n            throw invalidDefaultBucket(bucketString);\r\n        }\r\n    };\r\n    Location.makeFromUrl = function (url) {\r\n        var location = null;\r\n        var bucketDomain = '([A-Za-z0-9.\\\\-_]+)';\r\n        function gsModify(loc) {\r\n            if (loc.path.charAt(loc.path.length - 1) === '/') {\r\n                loc.path_ = loc.path_.slice(0, -1);\r\n            }\r\n        }\r\n        var gsPath = '(/(.*))?$';\r\n        var gsRegex = new RegExp('^gs://' + bucketDomain + gsPath, 'i');\r\n        var gsIndices = { bucket: 1, path: 3 };\r\n        function httpModify(loc) {\r\n            loc.path_ = decodeURIComponent(loc.path);\r\n        }\r\n        var version = 'v[A-Za-z0-9_]+';\r\n        var firebaseStorageHost = DEFAULT_HOST.replace(/[.]/g, '\\\\.');\r\n        var firebaseStoragePath = '(/([^?#]*).*)?$';\r\n        var firebaseStorageRegExp = new RegExp(\"^https?://\" + firebaseStorageHost + \"/\" + version + \"/b/\" + bucketDomain + \"/o\" + firebaseStoragePath, 'i');\r\n        var firebaseStorageIndices = { bucket: 1, path: 3 };\r\n        var cloudStorageHost = '(?:storage.googleapis.com|storage.cloud.google.com)';\r\n        var cloudStoragePath = '([^?#]*)';\r\n        var cloudStorageRegExp = new RegExp(\"^https?://\" + cloudStorageHost + \"/\" + bucketDomain + \"/\" + cloudStoragePath, 'i');\r\n        var cloudStorageIndices = { bucket: 1, path: 2 };\r\n        var groups = [\r\n            { regex: gsRegex, indices: gsIndices, postModify: gsModify },\r\n            {\r\n                regex: firebaseStorageRegExp,\r\n                indices: firebaseStorageIndices,\r\n                postModify: httpModify\r\n            },\r\n            {\r\n                regex: cloudStorageRegExp,\r\n                indices: cloudStorageIndices,\r\n                postModify: httpModify\r\n            }\r\n        ];\r\n        for (var i = 0; i < groups.length; i++) {\r\n            var group = groups[i];\r\n            var captures = group.regex.exec(url);\r\n            if (captures) {\r\n                var bucketValue = captures[group.indices.bucket];\r\n                var pathValue = captures[group.indices.path];\r\n                if (!pathValue) {\r\n                    pathValue = '';\r\n                }\r\n                location = new Location(bucketValue, pathValue);\r\n                group.postModify(location);\r\n                break;\r\n            }\r\n        }\r\n        if (location == null) {\r\n            throw invalidUrl(url);\r\n        }\r\n        return location;\r\n    };\r\n    return Location;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the Object resulting from parsing the given JSON, or null if the\r\n * given string does not represent a JSON object.\r\n */\r\nfunction jsonObjectOrNull(s) {\r\n    var obj;\r\n    try {\r\n        obj = JSON.parse(s);\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n    if (isNonArrayObject(obj)) {\r\n        return obj;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Contains helper methods for manipulating paths.\r\n */\r\n/**\r\n * @return Null if the path is already at the root.\r\n */\r\nfunction parent(path) {\r\n    if (path.length === 0) {\r\n        return null;\r\n    }\r\n    var index = path.lastIndexOf('/');\r\n    if (index === -1) {\r\n        return '';\r\n    }\r\n    var newPath = path.slice(0, index);\r\n    return newPath;\r\n}\r\nfunction child(path, childPath) {\r\n    var canonicalChildPath = childPath\r\n        .split('/')\r\n        .filter(function (component) { return component.length > 0; })\r\n        .join('/');\r\n    if (path.length === 0) {\r\n        return canonicalChildPath;\r\n    }\r\n    else {\r\n        return path + '/' + canonicalChildPath;\r\n    }\r\n}\r\n/**\r\n * Returns the last component of a path.\r\n * '/foo/bar' -> 'bar'\r\n * '/foo/bar/baz/' -> 'baz/'\r\n * '/a' -> 'a'\r\n */\r\nfunction lastComponent(path) {\r\n    var index = path.lastIndexOf('/', path.length - 2);\r\n    if (index === -1) {\r\n        return path;\r\n    }\r\n    else {\r\n        return path.slice(index + 1);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction makeUrl(urlPart) {\r\n    return \"https://\" + DEFAULT_HOST + \"/v0\" + urlPart;\r\n}\r\nfunction makeQueryString(params) {\r\n    var encode = encodeURIComponent;\r\n    var queryPart = '?';\r\n    for (var key in params) {\r\n        if (params.hasOwnProperty(key)) {\r\n            // @ts-ignore TODO: remove once typescript is upgraded to 3.5.x\r\n            var nextPart = encode(key) + '=' + encode(params[key]);\r\n            queryPart = queryPart + nextPart + '&';\r\n        }\r\n    }\r\n    // Chop off the extra '&' or '?' on the end\r\n    queryPart = queryPart.slice(0, -1);\r\n    return queryPart;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction noXform_(metadata, value) {\r\n    return value;\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar Mapping = /** @class */ (function () {\r\n    function Mapping(server, local, writable, xform) {\r\n        this.server = server;\r\n        this.local = local || server;\r\n        this.writable = !!writable;\r\n        this.xform = xform || noXform_;\r\n    }\r\n    return Mapping;\r\n}());\r\nvar mappings_ = null;\r\nfunction xformPath(fullPath) {\r\n    if (!isString(fullPath) || fullPath.length < 2) {\r\n        return fullPath;\r\n    }\r\n    else {\r\n        return lastComponent(fullPath);\r\n    }\r\n}\r\nfunction getMappings() {\r\n    if (mappings_) {\r\n        return mappings_;\r\n    }\r\n    var mappings = [];\r\n    mappings.push(new Mapping('bucket'));\r\n    mappings.push(new Mapping('generation'));\r\n    mappings.push(new Mapping('metageneration'));\r\n    mappings.push(new Mapping('name', 'fullPath', true));\r\n    function mappingsXformPath(_metadata, fullPath) {\r\n        return xformPath(fullPath);\r\n    }\r\n    var nameMapping = new Mapping('name');\r\n    nameMapping.xform = mappingsXformPath;\r\n    mappings.push(nameMapping);\r\n    /**\r\n     * Coerces the second param to a number, if it is defined.\r\n     */\r\n    function xformSize(_metadata, size) {\r\n        if (isDef(size)) {\r\n            return Number(size);\r\n        }\r\n        else {\r\n            return size;\r\n        }\r\n    }\r\n    var sizeMapping = new Mapping('size');\r\n    sizeMapping.xform = xformSize;\r\n    mappings.push(sizeMapping);\r\n    mappings.push(new Mapping('timeCreated'));\r\n    mappings.push(new Mapping('updated'));\r\n    mappings.push(new Mapping('md5Hash', null, true));\r\n    mappings.push(new Mapping('cacheControl', null, true));\r\n    mappings.push(new Mapping('contentDisposition', null, true));\r\n    mappings.push(new Mapping('contentEncoding', null, true));\r\n    mappings.push(new Mapping('contentLanguage', null, true));\r\n    mappings.push(new Mapping('contentType', null, true));\r\n    mappings.push(new Mapping('metadata', 'customMetadata', true));\r\n    mappings_ = mappings;\r\n    return mappings_;\r\n}\r\nfunction addRef(metadata, authWrapper) {\r\n    function generateRef() {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var loc = new Location(bucket, path);\r\n        return authWrapper.makeStorageReference(loc);\r\n    }\r\n    Object.defineProperty(metadata, 'ref', { get: generateRef });\r\n}\r\nfunction fromResource(authWrapper, resource, mappings) {\r\n    var metadata = {};\r\n    metadata['type'] = 'file';\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\r\n    }\r\n    addRef(metadata, authWrapper);\r\n    return metadata;\r\n}\r\nfunction fromResourceString(authWrapper, resourceString, mappings) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromResource(authWrapper, resource, mappings);\r\n}\r\nfunction downloadUrlFromResourceString(metadata, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    if (!isString(obj['downloadTokens'])) {\r\n        // This can happen if objects are uploaded through GCS and retrieved\r\n        // through list, so we don't want to throw an Error.\r\n        return null;\r\n    }\r\n    var tokens = obj['downloadTokens'];\r\n    if (tokens.length === 0) {\r\n        return null;\r\n    }\r\n    var encode = encodeURIComponent;\r\n    var tokensList = tokens.split(',');\r\n    var urls = tokensList.map(function (token) {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\r\n        var base = makeUrl(urlPart);\r\n        var queryString = makeQueryString({\r\n            alt: 'media',\r\n            token: token\r\n        });\r\n        return base + queryString;\r\n    });\r\n    return urls[0];\r\n}\r\nfunction toResourceString(metadata, mappings) {\r\n    var resource = {};\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        if (mapping.writable) {\r\n            resource[mapping.server] = metadata[mapping.local];\r\n        }\r\n    }\r\n    return JSON.stringify(resource);\r\n}\r\nfunction metadataValidator(p) {\r\n    if (!isObject(p) || !p) {\r\n        throw 'Expected Metadata object.';\r\n    }\r\n    for (var key in p) {\r\n        if (p.hasOwnProperty(key)) {\r\n            var val = p[key];\r\n            if (key === 'customMetadata') {\r\n                if (!isObject(val)) {\r\n                    throw 'Expected object for \\'customMetadata\\' mapping.';\r\n                }\r\n            }\r\n            else {\r\n                if (isNonNullObject(val)) {\r\n                    throw \"Mapping for '\" + key + \"' cannot be an object.\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MAX_RESULTS_KEY = 'maxResults';\r\nvar MAX_MAX_RESULTS = 1000;\r\nvar PAGE_TOKEN_KEY = 'pageToken';\r\nvar PREFIXES_KEY = 'prefixes';\r\nvar ITEMS_KEY = 'items';\r\nfunction fromBackendResponse(authWrapper, bucket, resource) {\r\n    var listResult = {\r\n        prefixes: [],\r\n        items: [],\r\n        nextPageToken: resource['nextPageToken']\r\n    };\r\n    if (resource[PREFIXES_KEY]) {\r\n        for (var _i = 0, _a = resource[PREFIXES_KEY]; _i < _a.length; _i++) {\r\n            var path = _a[_i];\r\n            var pathWithoutTrailingSlash = path.replace(/\\/$/, '');\r\n            var reference = authWrapper.makeStorageReference(new Location(bucket, pathWithoutTrailingSlash));\r\n            listResult.prefixes.push(reference);\r\n        }\r\n    }\r\n    if (resource[ITEMS_KEY]) {\r\n        for (var _b = 0, _c = resource[ITEMS_KEY]; _b < _c.length; _b++) {\r\n            var item = _c[_b];\r\n            var reference = authWrapper.makeStorageReference(new Location(bucket, item['name']));\r\n            listResult.items.push(reference);\r\n        }\r\n    }\r\n    return listResult;\r\n}\r\nfunction fromResponseString(authWrapper, bucket, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromBackendResponse(authWrapper, bucket, resource);\r\n}\r\nfunction listOptionsValidator(p) {\r\n    if (!isObject(p) || !p) {\r\n        throw 'Expected ListOptions object.';\r\n    }\r\n    for (var key in p) {\r\n        if (key === MAX_RESULTS_KEY) {\r\n            if (!isInteger(p[MAX_RESULTS_KEY]) ||\r\n                p[MAX_RESULTS_KEY] <= 0) {\r\n                throw 'Expected maxResults to be a positive number.';\r\n            }\r\n            if (p[MAX_RESULTS_KEY] > 1000) {\r\n                throw \"Expected maxResults to be less than or equal to \" + MAX_MAX_RESULTS + \".\";\r\n            }\r\n        }\r\n        else if (key === PAGE_TOKEN_KEY) {\r\n            if (p[PAGE_TOKEN_KEY] && !isString(p[PAGE_TOKEN_KEY])) {\r\n                throw 'Expected pageToken to be string.';\r\n            }\r\n        }\r\n        else {\r\n            throw 'Unknown option: ' + key;\r\n        }\r\n    }\r\n}\n\nvar RequestInfo = /** @class */ (function () {\r\n    function RequestInfo(url, method, \r\n    /**\r\n     * Returns the value with which to resolve the request's promise. Only called\r\n     * if the request is successful. Throw from this function to reject the\r\n     * returned Request's promise with the thrown error.\r\n     * Note: The XhrIo passed to this function may be reused after this callback\r\n     * returns. Do not keep a reference to it in any way.\r\n     */\r\n    handler, timeout) {\r\n        this.url = url;\r\n        this.method = method;\r\n        this.handler = handler;\r\n        this.timeout = timeout;\r\n        this.urlParams = {};\r\n        this.headers = {};\r\n        this.body = null;\r\n        this.errorHandler = null;\r\n        /**\r\n         * Called with the current number of bytes uploaded and total size (-1 if not\r\n         * computable) of the request body (i.e. used to report upload progress).\r\n         */\r\n        this.progressCallback = null;\r\n        this.successCodes = [200];\r\n        this.additionalRetryCodes = [];\r\n    }\r\n    return RequestInfo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws the UNKNOWN FirebaseStorageError if cndn is false.\r\n */\r\nfunction handlerCheck(cndn) {\r\n    if (!cndn) {\r\n        throw unknown();\r\n    }\r\n}\r\nfunction metadataHandler(authWrapper, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(authWrapper, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return metadata;\r\n    }\r\n    return handler;\r\n}\r\nfunction listHandler(authWrapper, bucket) {\r\n    function handler(xhr, text) {\r\n        var listResult = fromResponseString(authWrapper, bucket, text);\r\n        handlerCheck(listResult !== null);\r\n        return listResult;\r\n    }\r\n    return handler;\r\n}\r\nfunction downloadUrlHandler(authWrapper, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(authWrapper, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return downloadUrlFromResourceString(metadata, text);\r\n    }\r\n    return handler;\r\n}\r\nfunction sharedErrorHandler(location) {\r\n    function errorHandler(xhr, err) {\r\n        var newErr;\r\n        if (xhr.getStatus() === 401) {\r\n            newErr = unauthenticated();\r\n        }\r\n        else {\r\n            if (xhr.getStatus() === 402) {\r\n                newErr = quotaExceeded(location.bucket);\r\n            }\r\n            else {\r\n                if (xhr.getStatus() === 403) {\r\n                    newErr = unauthorized(location.path);\r\n                }\r\n                else {\r\n                    newErr = err;\r\n                }\r\n            }\r\n        }\r\n        newErr.setServerResponseProp(err.serverResponseProp());\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction objectErrorHandler(location) {\r\n    var shared = sharedErrorHandler(location);\r\n    function errorHandler(xhr, err) {\r\n        var newErr = shared(xhr, err);\r\n        if (xhr.getStatus() === 404) {\r\n            newErr = objectNotFound(location.path);\r\n        }\r\n        newErr.setServerResponseProp(err.serverResponseProp());\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction getMetadata(authWrapper, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(authWrapper, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction list(authWrapper, location, delimiter, pageToken, maxResults) {\r\n    var urlParams = {};\r\n    if (location.isRoot) {\r\n        urlParams['prefix'] = '';\r\n    }\r\n    else {\r\n        urlParams['prefix'] = location.path + '/';\r\n    }\r\n    if (delimiter && delimiter.length > 0) {\r\n        urlParams['delimiter'] = delimiter;\r\n    }\r\n    if (pageToken) {\r\n        urlParams['pageToken'] = pageToken;\r\n    }\r\n    if (maxResults) {\r\n        urlParams['maxResults'] = maxResults;\r\n    }\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, listHandler(authWrapper, location.bucket), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction getDownloadUrl(authWrapper, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, downloadUrlHandler(authWrapper, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction updateMetadata(authWrapper, location, metadata, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'PATCH';\r\n    var body = toResourceString(metadata, mappings);\r\n    var headers = { 'Content-Type': 'application/json; charset=utf-8' };\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(authWrapper, mappings), timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction deleteObject(authWrapper, location) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'DELETE';\r\n    var timeout = authWrapper.maxOperationRetryTime();\r\n    function handler(_xhr, _text) { }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.successCodes = [200, 204];\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction determineContentType_(metadata, blob) {\r\n    return ((metadata && metadata['contentType']) ||\r\n        (blob && blob.type()) ||\r\n        'application/octet-stream');\r\n}\r\nfunction metadataForUpload_(location, blob, metadata) {\r\n    var metadataClone = Object.assign({}, metadata);\r\n    metadataClone['fullPath'] = location.path;\r\n    metadataClone['size'] = blob.size();\r\n    if (!metadataClone['contentType']) {\r\n        metadataClone['contentType'] = determineContentType_(null, blob);\r\n    }\r\n    return metadataClone;\r\n}\r\nfunction multipartUpload(authWrapper, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'multipart'\r\n    };\r\n    function genBoundary() {\r\n        var str = '';\r\n        for (var i = 0; i < 2; i++) {\r\n            str = str + Math.random().toString().slice(2);\r\n        }\r\n        return str;\r\n    }\r\n    var boundary = genBoundary();\r\n    headers['Content-Type'] = 'multipart/related; boundary=' + boundary;\r\n    var metadata_ = metadataForUpload_(location, blob, metadata);\r\n    var metadataString = toResourceString(metadata_, mappings);\r\n    var preBlobPart = '--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: application/json; charset=utf-8\\r\\n\\r\\n' +\r\n        metadataString +\r\n        '\\r\\n--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: ' +\r\n        metadata_['contentType'] +\r\n        '\\r\\n\\r\\n';\r\n    var postBlobPart = '\\r\\n--' + boundary + '--';\r\n    var body = FbsBlob.getBlob(preBlobPart, blob, postBlobPart);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    var urlParams = { name: metadata_['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(authWrapper, mappings), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param current The number of bytes that have been uploaded so far.\r\n * @param total The total number of bytes in the upload.\r\n * @param opt_finalized True if the server has finished the upload.\r\n * @param opt_metadata The upload metadata, should\r\n *     only be passed if opt_finalized is true.\r\n * @struct\r\n */\r\nvar ResumableUploadStatus = /** @class */ (function () {\r\n    function ResumableUploadStatus(current, total, finalized, metadata) {\r\n        this.current = current;\r\n        this.total = total;\r\n        this.finalized = !!finalized;\r\n        this.metadata = metadata || null;\r\n    }\r\n    return ResumableUploadStatus;\r\n}());\r\nfunction checkResumeHeader_(xhr, allowed) {\r\n    var status = null;\r\n    try {\r\n        status = xhr.getResponseHeader('X-Goog-Upload-Status');\r\n    }\r\n    catch (e) {\r\n        handlerCheck(false);\r\n    }\r\n    var allowedStatus = allowed || ['active'];\r\n    handlerCheck(!!status && allowedStatus.indexOf(status) !== -1);\r\n    return status;\r\n}\r\nfunction createResumableUpload(authWrapper, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var metadataForUpload = metadataForUpload_(location, blob, metadata);\r\n    var urlParams = { name: metadataForUpload['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'resumable',\r\n        'X-Goog-Upload-Command': 'start',\r\n        'X-Goog-Upload-Header-Content-Length': blob.size(),\r\n        'X-Goog-Upload-Header-Content-Type': metadataForUpload['contentType'],\r\n        'Content-Type': 'application/json; charset=utf-8'\r\n    };\r\n    var body = toResourceString(metadataForUpload, mappings);\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    function handler(xhr) {\r\n        checkResumeHeader_(xhr);\r\n        var url;\r\n        try {\r\n            url = xhr.getResponseHeader('X-Goog-Upload-URL');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        handlerCheck(isString(url));\r\n        return url;\r\n    }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n */\r\nfunction getResumableUploadStatus(authWrapper, location, url, blob) {\r\n    var headers = { 'X-Goog-Upload-Command': 'query' };\r\n    function handler(xhr) {\r\n        var status = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var sizeString = null;\r\n        try {\r\n            sizeString = xhr.getResponseHeader('X-Goog-Upload-Size-Received');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        if (!sizeString) {\r\n            // null or empty string\r\n            handlerCheck(false);\r\n        }\r\n        var size = Number(sizeString);\r\n        handlerCheck(!isNaN(size));\r\n        return new ResumableUploadStatus(size, blob.size(), status === 'final');\r\n    }\r\n    var method = 'POST';\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * Any uploads via the resumable upload API must transfer a number of bytes\r\n * that is a multiple of this number.\r\n */\r\nvar resumableUploadChunkSize = 256 * 1024;\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n * @param chunkSize Number of bytes to upload.\r\n * @param status The previous status.\r\n *     If not passed or null, we start from the beginning.\r\n * @throws fbs.Error If the upload is already complete, the passed in status\r\n *     has a final size inconsistent with the blob, or the blob cannot be sliced\r\n *     for upload.\r\n */\r\nfunction continueResumableUpload(location, authWrapper, url, blob, chunkSize, mappings, status, progressCallback) {\r\n    // TODO(andysoto): standardize on internal asserts\r\n    // assert(!(opt_status && opt_status.finalized));\r\n    var status_ = new ResumableUploadStatus(0, 0);\r\n    if (status) {\r\n        status_.current = status.current;\r\n        status_.total = status.total;\r\n    }\r\n    else {\r\n        status_.current = 0;\r\n        status_.total = blob.size();\r\n    }\r\n    if (blob.size() !== status_.total) {\r\n        throw serverFileWrongSize();\r\n    }\r\n    var bytesLeft = status_.total - status_.current;\r\n    var bytesToUpload = bytesLeft;\r\n    if (chunkSize > 0) {\r\n        bytesToUpload = Math.min(bytesToUpload, chunkSize);\r\n    }\r\n    var startByte = status_.current;\r\n    var endByte = startByte + bytesToUpload;\r\n    var uploadCommand = bytesToUpload === bytesLeft ? 'upload, finalize' : 'upload';\r\n    var headers = {\r\n        'X-Goog-Upload-Command': uploadCommand,\r\n        'X-Goog-Upload-Offset': status_.current\r\n    };\r\n    var body = blob.slice(startByte, endByte);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    function handler(xhr, text) {\r\n        // TODO(andysoto): Verify the MD5 of each uploaded range:\r\n        // the 'x-range-md5' header comes back with status code 308 responses.\r\n        // We'll only be able to bail out though, because you can't re-upload a\r\n        // range that you previously uploaded.\r\n        var uploadStatus = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var newCurrent = status_.current + bytesToUpload;\r\n        var size = blob.size();\r\n        var metadata;\r\n        if (uploadStatus === 'final') {\r\n            metadata = metadataHandler(authWrapper, mappings)(xhr, text);\r\n        }\r\n        else {\r\n            metadata = null;\r\n        }\r\n        return new ResumableUploadStatus(newCurrent, size, uploadStatus === 'final', metadata);\r\n    }\r\n    var method = 'POST';\r\n    var timeout = authWrapper.maxUploadRetryTime();\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.progressCallback = progressCallback || null;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n */\r\nvar Observer = /** @class */ (function () {\r\n    function Observer(nextOrObserver, error, complete) {\r\n        var asFunctions = isFunction(nextOrObserver) ||\r\n            isDef(error) ||\r\n            isDef(complete);\r\n        if (asFunctions) {\r\n            this.next = nextOrObserver;\r\n            this.error = error || null;\r\n            this.complete = complete || null;\r\n        }\r\n        else {\r\n            var observer = nextOrObserver;\r\n            this.next = observer.next || null;\r\n            this.error = observer.error || null;\r\n            this.complete = observer.complete || null;\r\n        }\r\n    }\r\n    return Observer;\r\n}());\n\nvar UploadTaskSnapshot = /** @class */ (function () {\r\n    function UploadTaskSnapshot(bytesTransferred, totalBytes, state, metadata, task, ref) {\r\n        this.bytesTransferred = bytesTransferred;\r\n        this.totalBytes = totalBytes;\r\n        this.state = state;\r\n        this.metadata = metadata;\r\n        this.task = task;\r\n        this.ref = ref;\r\n    }\r\n    return UploadTaskSnapshot;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param name Name of the function.\r\n * @param specs Argument specs.\r\n * @param passed The actual arguments passed to the function.\r\n * @throws {fbs.Error} If the arguments are invalid.\r\n */\r\nfunction validate(name, specs, passed) {\r\n    var minArgs = specs.length;\r\n    var maxArgs = specs.length;\r\n    for (var i = 0; i < specs.length; i++) {\r\n        if (specs[i].optional) {\r\n            minArgs = i;\r\n            break;\r\n        }\r\n    }\r\n    var validLength = minArgs <= passed.length && passed.length <= maxArgs;\r\n    if (!validLength) {\r\n        throw invalidArgumentCount(minArgs, maxArgs, name, passed.length);\r\n    }\r\n    for (var i = 0; i < passed.length; i++) {\r\n        try {\r\n            specs[i].validator(passed[i]);\r\n        }\r\n        catch (e) {\r\n            if (e instanceof Error) {\r\n                throw invalidArgument(i, name, e.message);\r\n            }\r\n            else {\r\n                throw invalidArgument(i, name, e);\r\n            }\r\n        }\r\n    }\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar ArgSpec = /** @class */ (function () {\r\n    function ArgSpec(validator, optional) {\r\n        var self = this;\r\n        this.validator = function (p) {\r\n            if (self.optional && !isJustDef(p)) {\r\n                return;\r\n            }\r\n            validator(p);\r\n        };\r\n        this.optional = !!optional;\r\n    }\r\n    return ArgSpec;\r\n}());\r\nfunction and_(v1, v2) {\r\n    return function (p) {\r\n        v1(p);\r\n        v2(p);\r\n    };\r\n}\r\nfunction stringSpec(validator, optional) {\r\n    function stringValidator(p) {\r\n        if (!isString(p)) {\r\n            throw 'Expected string.';\r\n        }\r\n    }\r\n    var chainedValidator;\r\n    if (validator) {\r\n        chainedValidator = and_(stringValidator, validator);\r\n    }\r\n    else {\r\n        chainedValidator = stringValidator;\r\n    }\r\n    return new ArgSpec(chainedValidator, optional);\r\n}\r\nfunction uploadDataSpec() {\r\n    function validator(p) {\r\n        var valid = p instanceof Uint8Array ||\r\n            p instanceof ArrayBuffer ||\r\n            (isNativeBlobDefined() && p instanceof Blob);\r\n        if (!valid) {\r\n            throw 'Expected Blob or File.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator);\r\n}\r\nfunction metadataSpec(optional) {\r\n    return new ArgSpec(metadataValidator, optional);\r\n}\r\nfunction listOptionSpec(optional) {\r\n    return new ArgSpec(listOptionsValidator, optional);\r\n}\r\nfunction nonNegativeNumberSpec() {\r\n    function validator(p) {\r\n        var valid = isNumber(p) && p >= 0;\r\n        if (!valid) {\r\n            throw 'Expected a number 0 or greater.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator);\r\n}\r\nfunction looseObjectSpec(validator, optional) {\r\n    function isLooseObjectValidator(p) {\r\n        var isLooseObject = p === null || (isDef(p) && p instanceof Object);\r\n        if (!isLooseObject) {\r\n            throw 'Expected an Object.';\r\n        }\r\n        if (validator !== undefined && validator !== null) {\r\n            validator(p);\r\n        }\r\n    }\r\n    return new ArgSpec(isLooseObjectValidator, optional);\r\n}\r\nfunction nullFunctionSpec(optional) {\r\n    function validator(p) {\r\n        var valid = p === null || isFunction(p);\r\n        if (!valid) {\r\n            throw 'Expected a Function.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator, optional);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a function that invokes f with its arguments asynchronously as a\r\n * microtask, i.e. as soon as possible after the current script returns back\r\n * into browser code.\r\n */\r\nfunction async(f) {\r\n    return function () {\r\n        var argsToForward = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            argsToForward[_i] = arguments[_i];\r\n        }\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        Promise.resolve().then(function () { return f.apply(void 0, argsToForward); });\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Represents a blob being uploaded. Can be used to pause/resume/cancel the\r\n * upload and manage callbacks for various events.\r\n */\r\nvar UploadTask = /** @class */ (function () {\r\n    /**\r\n     * @param ref The firebaseStorage.Reference object this task came\r\n     *     from, untyped to avoid cyclic dependencies.\r\n     * @param blob The blob to upload.\r\n     */\r\n    function UploadTask(ref, authWrapper, location, mappings, blob, metadata) {\r\n        var _this = this;\r\n        if (metadata === void 0) { metadata = null; }\r\n        this.transferred_ = 0;\r\n        this.needToFetchStatus_ = false;\r\n        this.needToFetchMetadata_ = false;\r\n        this.observers_ = [];\r\n        this.error_ = null;\r\n        this.uploadUrl_ = null;\r\n        this.request_ = null;\r\n        this.chunkMultiplier_ = 1;\r\n        this.resolve_ = null;\r\n        this.reject_ = null;\r\n        this.ref_ = ref;\r\n        this.authWrapper_ = authWrapper;\r\n        this.location_ = location;\r\n        this.blob_ = blob;\r\n        this.metadata_ = metadata;\r\n        this.mappings_ = mappings;\r\n        this.resumable_ = this.shouldDoResumable_(this.blob_);\r\n        this.state_ = InternalTaskState.RUNNING;\r\n        this.errorHandler_ = function (error) {\r\n            _this.request_ = null;\r\n            _this.chunkMultiplier_ = 1;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this.needToFetchStatus_ = true;\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this.error_ = error;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this.metadataErrorHandler_ = function (error) {\r\n            _this.request_ = null;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this.error_ = error;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this.promise_ = new Promise(function (resolve, reject) {\r\n            _this.resolve_ = resolve;\r\n            _this.reject_ = reject;\r\n            _this.start_();\r\n        });\r\n        // Prevent uncaught rejections on the internal promise from bubbling out\r\n        // to the top level with a dummy handler.\r\n        this.promise_.then(null, function () { });\r\n    }\r\n    UploadTask.prototype.makeProgressCallback_ = function () {\r\n        var _this = this;\r\n        var sizeBefore = this.transferred_;\r\n        return function (loaded) { return _this.updateProgress_(sizeBefore + loaded); };\r\n    };\r\n    UploadTask.prototype.shouldDoResumable_ = function (blob) {\r\n        return blob.size() > 256 * 1024;\r\n    };\r\n    UploadTask.prototype.start_ = function () {\r\n        if (this.state_ !== InternalTaskState.RUNNING) {\r\n            // This can happen if someone pauses us in a resume callback, for example.\r\n            return;\r\n        }\r\n        if (this.request_ !== null) {\r\n            return;\r\n        }\r\n        if (this.resumable_) {\r\n            if (this.uploadUrl_ === null) {\r\n                this.createResumable_();\r\n            }\r\n            else {\r\n                if (this.needToFetchStatus_) {\r\n                    this.fetchStatus_();\r\n                }\r\n                else {\r\n                    if (this.needToFetchMetadata_) {\r\n                        // Happens if we miss the metadata on upload completion.\r\n                        this.fetchMetadata_();\r\n                    }\r\n                    else {\r\n                        this.continueUpload_();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.oneShotUpload_();\r\n        }\r\n    };\r\n    UploadTask.prototype.resolveToken_ = function (callback) {\r\n        var _this = this;\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.authWrapper_.getAuthToken().then(function (authToken) {\r\n            switch (_this.state_) {\r\n                case InternalTaskState.RUNNING:\r\n                    callback(authToken);\r\n                    break;\r\n                case InternalTaskState.CANCELING:\r\n                    _this.transition_(InternalTaskState.CANCELED);\r\n                    break;\r\n                case InternalTaskState.PAUSING:\r\n                    _this.transition_(InternalTaskState.PAUSED);\r\n                    break;\r\n            }\r\n        });\r\n    };\r\n    // TODO(andysoto): assert false\r\n    UploadTask.prototype.createResumable_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = createResumableUpload(_this.authWrapper_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\r\n            var createRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = createRequest;\r\n            createRequest.getPromise().then(function (url) {\r\n                _this.request_ = null;\r\n                _this.uploadUrl_ = url;\r\n                _this.needToFetchStatus_ = false;\r\n                _this.completeTransitions_();\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.fetchStatus_ = function () {\r\n        var _this = this;\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this.uploadUrl_;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = getResumableUploadStatus(_this.authWrapper_, _this.location_, url, _this.blob_);\r\n            var statusRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = statusRequest;\r\n            statusRequest.getPromise().then(function (status) {\r\n                status = status;\r\n                _this.request_ = null;\r\n                _this.updateProgress_(status.current);\r\n                _this.needToFetchStatus_ = false;\r\n                if (status.finalized) {\r\n                    _this.needToFetchMetadata_ = true;\r\n                }\r\n                _this.completeTransitions_();\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.continueUpload_ = function () {\r\n        var _this = this;\r\n        var chunkSize = resumableUploadChunkSize * this.chunkMultiplier_;\r\n        var status = new ResumableUploadStatus(this.transferred_, this.blob_.size());\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this.uploadUrl_;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo;\r\n            try {\r\n                requestInfo = continueResumableUpload(_this.location_, _this.authWrapper_, url, _this.blob_, chunkSize, _this.mappings_, status, _this.makeProgressCallback_());\r\n            }\r\n            catch (e) {\r\n                _this.error_ = e;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n                return;\r\n            }\r\n            var uploadRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = uploadRequest;\r\n            uploadRequest\r\n                .getPromise()\r\n                .then(function (newStatus) {\r\n                _this.increaseMultiplier_();\r\n                _this.request_ = null;\r\n                _this.updateProgress_(newStatus.current);\r\n                if (newStatus.finalized) {\r\n                    _this.metadata_ = newStatus.metadata;\r\n                    _this.transition_(InternalTaskState.SUCCESS);\r\n                }\r\n                else {\r\n                    _this.completeTransitions_();\r\n                }\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.increaseMultiplier_ = function () {\r\n        var currentSize = resumableUploadChunkSize * this.chunkMultiplier_;\r\n        // Max chunk size is 32M.\r\n        if (currentSize < 32 * 1024 * 1024) {\r\n            this.chunkMultiplier_ *= 2;\r\n        }\r\n    };\r\n    UploadTask.prototype.fetchMetadata_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = getMetadata(_this.authWrapper_, _this.location_, _this.mappings_);\r\n            var metadataRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = metadataRequest;\r\n            metadataRequest.getPromise().then(function (metadata) {\r\n                _this.request_ = null;\r\n                _this.metadata_ = metadata;\r\n                _this.transition_(InternalTaskState.SUCCESS);\r\n            }, _this.metadataErrorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.oneShotUpload_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = multipartUpload(_this.authWrapper_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\r\n            var multipartRequest = _this.authWrapper_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = multipartRequest;\r\n            multipartRequest.getPromise().then(function (metadata) {\r\n                _this.request_ = null;\r\n                _this.metadata_ = metadata;\r\n                _this.updateProgress_(_this.blob_.size());\r\n                _this.transition_(InternalTaskState.SUCCESS);\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.updateProgress_ = function (transferred) {\r\n        var old = this.transferred_;\r\n        this.transferred_ = transferred;\r\n        // A progress update can make the \"transferred\" value smaller (e.g. a\r\n        // partial upload not completed by server, after which the \"transferred\"\r\n        // value may reset to the value at the beginning of the request).\r\n        if (this.transferred_ !== old) {\r\n            this.notifyObservers_();\r\n        }\r\n    };\r\n    UploadTask.prototype.transition_ = function (state) {\r\n        if (this.state_ === state) {\r\n            return;\r\n        }\r\n        switch (state) {\r\n            case InternalTaskState.CANCELING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                this.state_ = state;\r\n                if (this.request_ !== null) {\r\n                    this.request_.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING);\r\n                this.state_ = state;\r\n                if (this.request_ !== null) {\r\n                    this.request_.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                var wasPaused = this.state_ === InternalTaskState.PAUSED;\r\n                this.state_ = state;\r\n                if (wasPaused) {\r\n                    this.notifyObservers_();\r\n                    this.start_();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.CANCELED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.error_ = canceled();\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.ERROR:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.SUCCESS:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n        }\r\n    };\r\n    UploadTask.prototype.completeTransitions_ = function () {\r\n        switch (this.state_) {\r\n            case InternalTaskState.PAUSING:\r\n                this.transition_(InternalTaskState.PAUSED);\r\n                break;\r\n            case InternalTaskState.CANCELING:\r\n                this.transition_(InternalTaskState.CANCELED);\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                this.start_();\r\n                break;\r\n        }\r\n    };\r\n    Object.defineProperty(UploadTask.prototype, \"snapshot\", {\r\n        get: function () {\r\n            var externalState = taskStateFromInternalTaskState(this.state_);\r\n            return new UploadTaskSnapshot(this.transferred_, this.blob_.size(), externalState, this.metadata_, this, this.ref_);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Adds a callback for an event.\r\n     * @param type The type of event to listen for.\r\n     */\r\n    UploadTask.prototype.on = function (type, nextOrObserver, error, completed) {\r\n        function typeValidator() {\r\n            if (type !== TaskEvent.STATE_CHANGED) {\r\n                throw \"Expected one of the event types: [\" + TaskEvent.STATE_CHANGED + \"].\";\r\n            }\r\n        }\r\n        var nextOrObserverMessage = 'Expected a function or an Object with one of ' +\r\n            '`next`, `error`, `complete` properties.';\r\n        var nextValidator = nullFunctionSpec(true).validator;\r\n        var observerValidator = looseObjectSpec(null, true).validator;\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        function nextOrObserverValidator(p) {\r\n            try {\r\n                nextValidator(p);\r\n                return;\r\n            }\r\n            catch (e) { }\r\n            try {\r\n                observerValidator(p);\r\n                var anyDefined = isJustDef(p['next']) ||\r\n                    isJustDef(p['error']) ||\r\n                    isJustDef(p['complete']);\r\n                if (!anyDefined) {\r\n                    throw '';\r\n                }\r\n                return;\r\n            }\r\n            catch (e) {\r\n                throw nextOrObserverMessage;\r\n            }\r\n        }\r\n        var specs = [\r\n            stringSpec(typeValidator),\r\n            looseObjectSpec(nextOrObserverValidator, true),\r\n            nullFunctionSpec(true),\r\n            nullFunctionSpec(true)\r\n        ];\r\n        validate('on', specs, arguments);\r\n        var self = this;\r\n        function makeBinder(specs) {\r\n            function binder(nextOrObserver, error, complete) {\r\n                if (specs !== null) {\r\n                    validate('on', specs, arguments);\r\n                }\r\n                var observer = new Observer(nextOrObserver, error, completed);\r\n                self.addObserver_(observer);\r\n                return function () {\r\n                    self.removeObserver_(observer);\r\n                };\r\n            }\r\n            return binder;\r\n        }\r\n        function binderNextOrObserverValidator(p) {\r\n            if (p === null) {\r\n                throw nextOrObserverMessage;\r\n            }\r\n            nextOrObserverValidator(p);\r\n        }\r\n        var binderSpecs = [\r\n            looseObjectSpec(binderNextOrObserverValidator),\r\n            nullFunctionSpec(true),\r\n            nullFunctionSpec(true)\r\n        ];\r\n        var typeOnly = !(isJustDef(nextOrObserver) ||\r\n            isJustDef(error) ||\r\n            isJustDef(completed));\r\n        if (typeOnly) {\r\n            return makeBinder(binderSpecs);\r\n        }\r\n        else {\r\n            return makeBinder(null)(nextOrObserver, error, completed);\r\n        }\r\n    };\r\n    /**\r\n     * This object behaves like a Promise, and resolves with its snapshot data\r\n     * when the upload completes.\r\n     * @param onFulfilled The fulfillment callback. Promise chaining works as normal.\r\n     * @param onRejected The rejection callback.\r\n     */\r\n    UploadTask.prototype.then = function (onFulfilled, onRejected) {\r\n        // These casts are needed so that TypeScript can infer the types of the\r\n        // resulting Promise.\r\n        return this.promise_.then(onFulfilled, onRejected);\r\n    };\r\n    /**\r\n     * Equivalent to calling `then(null, onRejected)`.\r\n     */\r\n    UploadTask.prototype.catch = function (onRejected) {\r\n        return this.then(null, onRejected);\r\n    };\r\n    /**\r\n     * Adds the given observer.\r\n     */\r\n    UploadTask.prototype.addObserver_ = function (observer) {\r\n        this.observers_.push(observer);\r\n        this.notifyObserver_(observer);\r\n    };\r\n    /**\r\n     * Removes the given observer.\r\n     */\r\n    UploadTask.prototype.removeObserver_ = function (observer) {\r\n        var i = this.observers_.indexOf(observer);\r\n        if (i !== -1) {\r\n            this.observers_.splice(i, 1);\r\n        }\r\n    };\r\n    UploadTask.prototype.notifyObservers_ = function () {\r\n        var _this = this;\r\n        this.finishPromise_();\r\n        var observers = this.observers_.slice();\r\n        observers.forEach(function (observer) {\r\n            _this.notifyObserver_(observer);\r\n        });\r\n    };\r\n    UploadTask.prototype.finishPromise_ = function () {\r\n        if (this.resolve_ !== null) {\r\n            var triggered = true;\r\n            switch (taskStateFromInternalTaskState(this.state_)) {\r\n                case TaskState.SUCCESS:\r\n                    async(this.resolve_.bind(null, this.snapshot))();\r\n                    break;\r\n                case TaskState.CANCELED:\r\n                case TaskState.ERROR:\r\n                    var toCall = this.reject_;\r\n                    async(toCall.bind(null, this.error_))();\r\n                    break;\r\n                default:\r\n                    triggered = false;\r\n                    break;\r\n            }\r\n            if (triggered) {\r\n                this.resolve_ = null;\r\n                this.reject_ = null;\r\n            }\r\n        }\r\n    };\r\n    UploadTask.prototype.notifyObserver_ = function (observer) {\r\n        var externalState = taskStateFromInternalTaskState(this.state_);\r\n        switch (externalState) {\r\n            case TaskState.RUNNING:\r\n            case TaskState.PAUSED:\r\n                if (observer.next) {\r\n                    async(observer.next.bind(observer, this.snapshot))();\r\n                }\r\n                break;\r\n            case TaskState.SUCCESS:\r\n                if (observer.complete) {\r\n                    async(observer.complete.bind(observer))();\r\n                }\r\n                break;\r\n            case TaskState.CANCELED:\r\n            case TaskState.ERROR:\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this.error_))();\r\n                }\r\n                break;\r\n            default:\r\n                // TODO(andysoto): assert(false);\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this.error_))();\r\n                }\r\n        }\r\n    };\r\n    /**\r\n     * Resumes a paused task. Has no effect on a currently running or failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.resume = function () {\r\n        validate('resume', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.PAUSED ||\r\n            this.state_ === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.RUNNING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Pauses a currently running task. Has no effect on a paused or failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.pause = function () {\r\n        validate('pause', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.RUNNING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.PAUSING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Cancels a currently running or paused task. Has no effect on a complete or\r\n     * failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.cancel = function () {\r\n        validate('cancel', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.RUNNING ||\r\n            this.state_ === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.CANCELING);\r\n        }\r\n        return valid;\r\n    };\r\n    return UploadTask;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provides methods to interact with a bucket in the Firebase Storage service.\r\n * @param location An fbs.location, or the URL at\r\n *     which to base this object, in one of the following forms:\r\n *         gs://<bucket>/<object-path>\r\n *         http[s]://firebasestorage.googleapis.com/\r\n *                     <api-version>/b/<bucket>/o/<object-path>\r\n *     Any query or fragment strings will be ignored in the http[s]\r\n *     format. If no value is passed, the storage object will use a URL based on\r\n *     the project ID of the base firebase.App instance.\r\n */\r\nvar Reference = /** @class */ (function () {\r\n    function Reference(authWrapper, location) {\r\n        this.authWrapper = authWrapper;\r\n        if (location instanceof Location) {\r\n            this.location = location;\r\n        }\r\n        else {\r\n            this.location = Location.makeFromUrl(location);\r\n        }\r\n    }\r\n    /**\r\n     * @return The URL for the bucket and path this object references,\r\n     *     in the form gs://<bucket>/<object-path>\r\n     * @override\r\n     */\r\n    Reference.prototype.toString = function () {\r\n        validate('toString', [], arguments);\r\n        return 'gs://' + this.location.bucket + '/' + this.location.path;\r\n    };\r\n    Reference.prototype.newRef = function (authWrapper, location) {\r\n        return new Reference(authWrapper, location);\r\n    };\r\n    Reference.prototype.mappings = function () {\r\n        return getMappings();\r\n    };\r\n    /**\r\n     * @return A reference to the object obtained by\r\n     *     appending childPath, removing any duplicate, beginning, or trailing\r\n     *     slashes.\r\n     */\r\n    Reference.prototype.child = function (childPath) {\r\n        validate('child', [stringSpec()], arguments);\r\n        var newPath = child(this.location.path, childPath);\r\n        var location = new Location(this.location.bucket, newPath);\r\n        return this.newRef(this.authWrapper, location);\r\n    };\r\n    Object.defineProperty(Reference.prototype, \"parent\", {\r\n        /**\r\n         * @return A reference to the parent of the\r\n         *     current object, or null if the current object is the root.\r\n         */\r\n        get: function () {\r\n            var newPath = parent(this.location.path);\r\n            if (newPath === null) {\r\n                return null;\r\n            }\r\n            var location = new Location(this.location.bucket, newPath);\r\n            return this.newRef(this.authWrapper, location);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"root\", {\r\n        /**\r\n         * @return An reference to the root of this\r\n         *     object's bucket.\r\n         */\r\n        get: function () {\r\n            var location = new Location(this.location.bucket, '');\r\n            return this.newRef(this.authWrapper, location);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"bucket\", {\r\n        get: function () {\r\n            return this.location.bucket;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"fullPath\", {\r\n        get: function () {\r\n            return this.location.path;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"name\", {\r\n        get: function () {\r\n            return lastComponent(this.location.path);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"storage\", {\r\n        get: function () {\r\n            return this.authWrapper.service();\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Uploads a blob to this object's location.\r\n     * @param data The blob to upload.\r\n     * @return An UploadTask that lets you control and\r\n     *     observe the upload.\r\n     */\r\n    Reference.prototype.put = function (data, metadata) {\r\n        if (metadata === void 0) { metadata = null; }\r\n        validate('put', [uploadDataSpec(), metadataSpec(true)], arguments);\r\n        this.throwIfRoot_('put');\r\n        return new UploadTask(this, this.authWrapper, this.location, this.mappings(), new FbsBlob(data), metadata);\r\n    };\r\n    /**\r\n     * Uploads a string to this object's location.\r\n     * @param value The string to upload.\r\n     * @param format The format of the string to upload.\r\n     * @return An UploadTask that lets you control and\r\n     *     observe the upload.\r\n     */\r\n    Reference.prototype.putString = function (value, format, metadata) {\r\n        if (format === void 0) { format = StringFormat.RAW; }\r\n        validate('putString', [stringSpec(), stringSpec(formatValidator, true), metadataSpec(true)], arguments);\r\n        this.throwIfRoot_('putString');\r\n        var data = dataFromString(format, value);\r\n        var metadataClone = Object.assign({}, metadata);\r\n        if (!isDef(metadataClone['contentType']) &&\r\n            isDef(data.contentType)) {\r\n            metadataClone['contentType'] = data.contentType;\r\n        }\r\n        return new UploadTask(this, this.authWrapper, this.location, this.mappings(), new FbsBlob(data.data, true), metadataClone);\r\n    };\r\n    /**\r\n     * Deletes the object at this location.\r\n     * @return A promise that resolves if the deletion succeeds.\r\n     */\r\n    Reference.prototype.delete = function () {\r\n        var _this = this;\r\n        validate('delete', [], arguments);\r\n        this.throwIfRoot_('delete');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = deleteObject(_this.authWrapper, _this.location);\r\n            return _this.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * List all items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * This is a helper method for calling list() repeatedly until there are\r\n     * no more results. The default pagination size is 1000.\r\n     *\r\n     * Note: The results may not be consistent if objects are changed while this\r\n     * operation is running.\r\n     *\r\n     * Warning: listAll may potentially consume too many resources if there are\r\n     * too many results.\r\n     *\r\n     * @return A Promise that resolves with all the items and prefixes under\r\n     *      the current storage reference. `prefixes` contains references to\r\n     *      sub-directories and `items` contains references to objects in this\r\n     *      folder. `nextPageToken` is never returned.\r\n     */\r\n    Reference.prototype.listAll = function () {\r\n        validate('listAll', [], arguments);\r\n        var accumulator = {\r\n            prefixes: [],\r\n            items: []\r\n        };\r\n        return this.listAllHelper(accumulator).then(function () { return accumulator; });\r\n    };\r\n    Reference.prototype.listAllHelper = function (accumulator, pageToken) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var opt, nextPage;\r\n            var _a, _b;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        opt = {\r\n                            // maxResults is 1000 by default.\r\n                            pageToken: pageToken\r\n                        };\r\n                        return [4 /*yield*/, this.list(opt)];\r\n                    case 1:\r\n                        nextPage = _c.sent();\r\n                        (_a = accumulator.prefixes).push.apply(_a, nextPage.prefixes);\r\n                        (_b = accumulator.items).push.apply(_b, nextPage.items);\r\n                        if (!(nextPage.nextPageToken != null)) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.listAllHelper(accumulator, nextPage.nextPageToken)];\r\n                    case 2:\r\n                        _c.sent();\r\n                        _c.label = 3;\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * List items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * List API is only available for Firebase Rules Version 2.\r\n     *\r\n     * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\r\n     * delimited folder structure.\r\n     * Refer to GCS's List API if you want to learn more.\r\n     *\r\n     * To adhere to Firebase Rules's Semantics, Firebase Storage does not\r\n     * support objects whose paths end with \"/\" or contain two consecutive\r\n     * \"/\"s. Firebase Storage List API will filter these unsupported objects.\r\n     * list() may fail if there are too many unsupported objects in the bucket.\r\n     *\r\n     * @param options See ListOptions for details.\r\n     * @return A Promise that resolves with the items and prefixes.\r\n     *      `prefixes` contains references to sub-folders and `items`\r\n     *      contains references to objects in this folder. `nextPageToken`\r\n     *      can be used to get the rest of the results.\r\n     */\r\n    Reference.prototype.list = function (options) {\r\n        validate('list', [listOptionSpec(true)], arguments);\r\n        var self = this;\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var op = options || {};\r\n            var requestInfo = list(self.authWrapper, self.location, \r\n            /*delimiter= */ '/', op.pageToken, op.maxResults);\r\n            return self.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     *     A promise that resolves with the metadata for this object. If this\r\n     *     object doesn't exist or metadata cannot be retreived, the promise is\r\n     *     rejected.\r\n     */\r\n    Reference.prototype.getMetadata = function () {\r\n        var _this = this;\r\n        validate('getMetadata', [], arguments);\r\n        this.throwIfRoot_('getMetadata');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = getMetadata(_this.authWrapper, _this.location, _this.mappings());\r\n            return _this.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * Updates the metadata for this object.\r\n     * @param metadata The new metadata for the object.\r\n     *     Only values that have been explicitly set will be changed. Explicitly\r\n     *     setting a value to null will remove the metadata.\r\n     * @return A promise that resolves\r\n     *     with the new metadata for this object.\r\n     *     @see firebaseStorage.Reference.prototype.getMetadata\r\n     */\r\n    Reference.prototype.updateMetadata = function (metadata) {\r\n        var _this = this;\r\n        validate('updateMetadata', [metadataSpec()], arguments);\r\n        this.throwIfRoot_('updateMetadata');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = updateMetadata(_this.authWrapper, _this.location, metadata, _this.mappings());\r\n            return _this.authWrapper.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * @return A promise that resolves with the download\r\n     *     URL for this object.\r\n     */\r\n    Reference.prototype.getDownloadURL = function () {\r\n        var _this = this;\r\n        validate('getDownloadURL', [], arguments);\r\n        this.throwIfRoot_('getDownloadURL');\r\n        return this.authWrapper.getAuthToken().then(function (authToken) {\r\n            var requestInfo = getDownloadUrl(_this.authWrapper, _this.location, _this.mappings());\r\n            return _this.authWrapper\r\n                .makeRequest(requestInfo, authToken)\r\n                .getPromise()\r\n                .then(function (url) {\r\n                if (url === null) {\r\n                    throw noDownloadURL();\r\n                }\r\n                return url;\r\n            });\r\n        });\r\n    };\r\n    Reference.prototype.throwIfRoot_ = function (name) {\r\n        if (this.location.path === '') {\r\n            throw invalidRootOperation(name);\r\n        }\r\n    };\r\n    return Reference;\r\n}());\n\n/**\r\n * A request whose promise always fails.\r\n * @struct\r\n * @template T\r\n */\r\nvar FailRequest = /** @class */ (function () {\r\n    function FailRequest(error) {\r\n        this.promise_ = Promise.reject(error);\r\n    }\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.cancel = function (_appDelete) {\r\n    };\r\n    return FailRequest;\r\n}());\n\nvar RequestMap = /** @class */ (function () {\r\n    function RequestMap() {\r\n        this.map = new Map();\r\n        this.id = MIN_SAFE_INTEGER;\r\n    }\r\n    /**\r\n     * Registers the given request with this map.\r\n     * The request is unregistered when it completes.\r\n     *\r\n     * @param request The request to register.\r\n     */\r\n    RequestMap.prototype.addRequest = function (request) {\r\n        var _this = this;\r\n        var id = this.id;\r\n        this.id++;\r\n        this.map.set(id, request);\r\n        request.getPromise().then(function () { return _this.map.delete(id); }, function () { return _this.map.delete(id); });\r\n    };\r\n    /**\r\n     * Cancels all registered requests.\r\n     */\r\n    RequestMap.prototype.clear = function () {\r\n        this.map.forEach(function (v) {\r\n            v && v.cancel(true);\r\n        });\r\n        this.map.clear();\r\n    };\r\n    return RequestMap;\r\n}());\n\n/**\r\n * @param app If null, getAuthToken always resolves with null.\r\n * @param service The storage service associated with this auth wrapper.\r\n *     Untyped to avoid circular type dependencies.\r\n * @struct\r\n */\r\nvar AuthWrapper = /** @class */ (function () {\r\n    function AuthWrapper(app, authProvider, maker, requestMaker, service, pool) {\r\n        var _a;\r\n        this.bucket_ = null;\r\n        this.appId_ = null;\r\n        this.deleted_ = false;\r\n        this.app_ = app;\r\n        if (this.app_ !== null) {\r\n            var options = this.app_.options;\r\n            if (isDef(options)) {\r\n                this.bucket_ = AuthWrapper.extractBucket_(options);\r\n                this.appId_ = (_a = options.appId) !== null && _a !== void 0 ? _a : null;\r\n            }\r\n        }\r\n        this.authProvider_ = authProvider;\r\n        this.storageRefMaker_ = maker;\r\n        this.requestMaker_ = requestMaker;\r\n        this.pool_ = pool;\r\n        this.service_ = service;\r\n        this.maxOperationRetryTime_ = DEFAULT_MAX_OPERATION_RETRY_TIME;\r\n        this.maxUploadRetryTime_ = DEFAULT_MAX_UPLOAD_RETRY_TIME;\r\n        this.requestMap_ = new RequestMap();\r\n    }\r\n    AuthWrapper.extractBucket_ = function (config) {\r\n        var bucketString = config[CONFIG_STORAGE_BUCKET_KEY] || null;\r\n        if (bucketString == null) {\r\n            return null;\r\n        }\r\n        var loc = Location.makeFromBucketSpec(bucketString);\r\n        return loc.bucket;\r\n    };\r\n    AuthWrapper.prototype.getAuthToken = function () {\r\n        var auth = this.authProvider_.getImmediate({ optional: true });\r\n        if (auth) {\r\n            return auth.getToken().then(function (response) {\r\n                if (response !== null) {\r\n                    return response.accessToken;\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }, function () { return null; });\r\n        }\r\n        else {\r\n            return Promise.resolve(null);\r\n        }\r\n    };\r\n    AuthWrapper.prototype.bucket = function () {\r\n        if (this.deleted_) {\r\n            throw appDeleted();\r\n        }\r\n        else {\r\n            return this.bucket_;\r\n        }\r\n    };\r\n    /**\r\n     * The service associated with this auth wrapper. Untyped to avoid circular\r\n     * type dependencies.\r\n     */\r\n    AuthWrapper.prototype.service = function () {\r\n        return this.service_;\r\n    };\r\n    /**\r\n     * Returns a new firebaseStorage.Reference object referencing this AuthWrapper\r\n     * at the given Location.\r\n     * @param loc The Location.\r\n     * @return Actually a firebaseStorage.Reference, typing not allowed\r\n     *     because of circular dependency problems.\r\n     */\r\n    AuthWrapper.prototype.makeStorageReference = function (loc) {\r\n        return this.storageRefMaker_(this, loc);\r\n    };\r\n    AuthWrapper.prototype.makeRequest = function (requestInfo, authToken) {\r\n        if (!this.deleted_) {\r\n            var request = this.requestMaker_(requestInfo, this.appId_, authToken, this.pool_);\r\n            this.requestMap_.addRequest(request);\r\n            return request;\r\n        }\r\n        else {\r\n            return new FailRequest(appDeleted());\r\n        }\r\n    };\r\n    /**\r\n     * Stop running requests and prevent more from being created.\r\n     */\r\n    AuthWrapper.prototype.deleteApp = function () {\r\n        this.deleted_ = true;\r\n        this.app_ = null;\r\n        this.requestMap_.clear();\r\n    };\r\n    AuthWrapper.prototype.maxUploadRetryTime = function () {\r\n        return this.maxUploadRetryTime_;\r\n    };\r\n    AuthWrapper.prototype.setMaxUploadRetryTime = function (time) {\r\n        this.maxUploadRetryTime_ = time;\r\n    };\r\n    AuthWrapper.prototype.maxOperationRetryTime = function () {\r\n        return this.maxOperationRetryTime_;\r\n    };\r\n    AuthWrapper.prototype.setMaxOperationRetryTime = function (time) {\r\n        this.maxOperationRetryTime_ = time;\r\n    };\r\n    return AuthWrapper;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param f May be invoked\r\n *     before the function returns.\r\n * @param callback Get all the arguments passed to the function\r\n *     passed to f, including the initial boolean.\r\n */\r\nfunction start(f, callback, timeout) {\r\n    // TODO(andysoto): make this code cleaner (probably refactor into an actual\r\n    // type instead of a bunch of functions with state shared in the closure)\r\n    var waitSeconds = 1;\r\n    // Would type this as \"number\" but that doesn't work for Node so ¯\\_(ツ)_/¯\r\n    // TODO: find a way to exclude Node type definition for storage because storage only works in browser\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    var timeoutId = null;\r\n    var hitTimeout = false;\r\n    var cancelState = 0;\r\n    function canceled() {\r\n        return cancelState === 2;\r\n    }\r\n    var triggeredCallback = false;\r\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\r\n    // the no-explicit-any rule when ESlint releases it.\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    function triggerCallback() {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (!triggeredCallback) {\r\n            triggeredCallback = true;\r\n            callback.apply(null, args);\r\n        }\r\n    }\r\n    function callWithDelay(millis) {\r\n        timeoutId = setTimeout(function () {\r\n            timeoutId = null;\r\n            f(handler, canceled());\r\n        }, millis);\r\n    }\r\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\r\n    // the no-explicit-any rule when ESlint releases it.\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    function handler(success) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (success) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        var mustStop = canceled() || hitTimeout;\r\n        if (mustStop) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        if (waitSeconds < 64) {\r\n            /* TODO(andysoto): don't back off so quickly if we know we're offline. */\r\n            waitSeconds *= 2;\r\n        }\r\n        var waitMillis;\r\n        if (cancelState === 1) {\r\n            cancelState = 2;\r\n            waitMillis = 0;\r\n        }\r\n        else {\r\n            waitMillis = (waitSeconds + Math.random()) * 1000;\r\n        }\r\n        callWithDelay(waitMillis);\r\n    }\r\n    var stopped = false;\r\n    function stop(wasTimeout) {\r\n        if (stopped) {\r\n            return;\r\n        }\r\n        stopped = true;\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (timeoutId !== null) {\r\n            if (!wasTimeout) {\r\n                cancelState = 2;\r\n            }\r\n            clearTimeout(timeoutId);\r\n            callWithDelay(0);\r\n        }\r\n        else {\r\n            if (!wasTimeout) {\r\n                cancelState = 1;\r\n            }\r\n        }\r\n    }\r\n    callWithDelay(0);\r\n    setTimeout(function () {\r\n        hitTimeout = true;\r\n        stop(true);\r\n    }, timeout);\r\n    return stop;\r\n}\r\n/**\r\n * Stops the retry loop from repeating.\r\n * If the function is currently \"in between\" retries, it is invoked immediately\r\n * with the second parameter as \"true\". Otherwise, it will be invoked once more\r\n * after the current invocation finishes iff the current invocation would have\r\n * triggered another retry.\r\n */\r\nfunction stop(id) {\r\n    id(false);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n * @template T\r\n */\r\nvar NetworkRequest = /** @class */ (function () {\r\n    function NetworkRequest(url, method, headers, body, successCodes, additionalRetryCodes, callback, errorCallback, timeout, progressCallback, pool) {\r\n        var _this = this;\r\n        this.pendingXhr_ = null;\r\n        this.backoffId_ = null;\r\n        this.resolve_ = null;\r\n        this.reject_ = null;\r\n        this.canceled_ = false;\r\n        this.appDelete_ = false;\r\n        this.url_ = url;\r\n        this.method_ = method;\r\n        this.headers_ = headers;\r\n        this.body_ = body;\r\n        this.successCodes_ = successCodes.slice();\r\n        this.additionalRetryCodes_ = additionalRetryCodes.slice();\r\n        this.callback_ = callback;\r\n        this.errorCallback_ = errorCallback;\r\n        this.progressCallback_ = progressCallback;\r\n        this.timeout_ = timeout;\r\n        this.pool_ = pool;\r\n        this.promise_ = new Promise(function (resolve, reject) {\r\n            _this.resolve_ = resolve;\r\n            _this.reject_ = reject;\r\n            _this.start_();\r\n        });\r\n    }\r\n    /**\r\n     * Actually starts the retry loop.\r\n     */\r\n    NetworkRequest.prototype.start_ = function () {\r\n        var self = this;\r\n        function doTheRequest(backoffCallback, canceled) {\r\n            if (canceled) {\r\n                backoffCallback(false, new RequestEndStatus(false, null, true));\r\n                return;\r\n            }\r\n            var xhr = self.pool_.createXhrIo();\r\n            self.pendingXhr_ = xhr;\r\n            function progressListener(progressEvent) {\r\n                var loaded = progressEvent.loaded;\r\n                var total = progressEvent.lengthComputable ? progressEvent.total : -1;\r\n                if (self.progressCallback_ !== null) {\r\n                    self.progressCallback_(loaded, total);\r\n                }\r\n            }\r\n            if (self.progressCallback_ !== null) {\r\n                xhr.addUploadProgressListener(progressListener);\r\n            }\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            xhr\r\n                .send(self.url_, self.method_, self.body_, self.headers_)\r\n                .then(function (xhr) {\r\n                if (self.progressCallback_ !== null) {\r\n                    xhr.removeUploadProgressListener(progressListener);\r\n                }\r\n                self.pendingXhr_ = null;\r\n                xhr = xhr;\r\n                var hitServer = xhr.getErrorCode() === ErrorCode.NO_ERROR;\r\n                var status = xhr.getStatus();\r\n                if (!hitServer || self.isRetryStatusCode_(status)) {\r\n                    var wasCanceled = xhr.getErrorCode() === ErrorCode.ABORT;\r\n                    backoffCallback(false, new RequestEndStatus(false, null, wasCanceled));\r\n                    return;\r\n                }\r\n                var successCode = self.successCodes_.indexOf(status) !== -1;\r\n                backoffCallback(true, new RequestEndStatus(successCode, xhr));\r\n            });\r\n        }\r\n        /**\r\n         * @param requestWentThrough True if the request eventually went\r\n         *     through, false if it hit the retry limit or was canceled.\r\n         */\r\n        function backoffDone(requestWentThrough, status) {\r\n            var resolve = self.resolve_;\r\n            var reject = self.reject_;\r\n            var xhr = status.xhr;\r\n            if (status.wasSuccessCode) {\r\n                try {\r\n                    var result = self.callback_(xhr, xhr.getResponseText());\r\n                    if (isJustDef(result)) {\r\n                        resolve(result);\r\n                    }\r\n                    else {\r\n                        resolve();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }\r\n            else {\r\n                if (xhr !== null) {\r\n                    var err = unknown();\r\n                    err.setServerResponseProp(xhr.getResponseText());\r\n                    if (self.errorCallback_) {\r\n                        reject(self.errorCallback_(xhr, err));\r\n                    }\r\n                    else {\r\n                        reject(err);\r\n                    }\r\n                }\r\n                else {\r\n                    if (status.canceled) {\r\n                        var err = self.appDelete_ ? appDeleted() : canceled();\r\n                        reject(err);\r\n                    }\r\n                    else {\r\n                        var err = retryLimitExceeded();\r\n                        reject(err);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (this.canceled_) {\r\n            backoffDone(false, new RequestEndStatus(false, null, true));\r\n        }\r\n        else {\r\n            this.backoffId_ = start(doTheRequest, backoffDone, this.timeout_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.cancel = function (appDelete) {\r\n        this.canceled_ = true;\r\n        this.appDelete_ = appDelete || false;\r\n        if (this.backoffId_ !== null) {\r\n            stop(this.backoffId_);\r\n        }\r\n        if (this.pendingXhr_ !== null) {\r\n            this.pendingXhr_.abort();\r\n        }\r\n    };\r\n    NetworkRequest.prototype.isRetryStatusCode_ = function (status) {\r\n        // The codes for which to retry came from this page:\r\n        // https://cloud.google.com/storage/docs/exponential-backoff\r\n        var isFiveHundredCode = status >= 500 && status < 600;\r\n        var extraRetryCodes = [\r\n            // Request Timeout: web server didn't receive full request in time.\r\n            408,\r\n            // Too Many Requests: you're getting rate-limited, basically.\r\n            429\r\n        ];\r\n        var isExtraRetryCode = extraRetryCodes.indexOf(status) !== -1;\r\n        var isRequestSpecificRetryCode = this.additionalRetryCodes_.indexOf(status) !== -1;\r\n        return isFiveHundredCode || isExtraRetryCode || isRequestSpecificRetryCode;\r\n    };\r\n    return NetworkRequest;\r\n}());\r\n/**\r\n * A collection of information about the result of a network request.\r\n * @param opt_canceled Defaults to false.\r\n * @struct\r\n */\r\nvar RequestEndStatus = /** @class */ (function () {\r\n    function RequestEndStatus(wasSuccessCode, xhr, canceled) {\r\n        this.wasSuccessCode = wasSuccessCode;\r\n        this.xhr = xhr;\r\n        this.canceled = !!canceled;\r\n    }\r\n    return RequestEndStatus;\r\n}());\r\nfunction addAuthHeader_(headers, authToken) {\r\n    if (authToken !== null && authToken.length > 0) {\r\n        headers['Authorization'] = 'Firebase ' + authToken;\r\n    }\r\n}\r\nfunction addVersionHeader_(headers) {\r\n    var version = typeof firebase !== 'undefined' ? firebase.SDK_VERSION : 'AppManager';\r\n    headers['X-Firebase-Storage-Version'] = 'webjs/' + version;\r\n}\r\nfunction addGmpidHeader_(headers, appId) {\r\n    if (appId) {\r\n        headers['X-Firebase-GMPID'] = appId;\r\n    }\r\n}\r\n/**\r\n * @template T\r\n */\r\nfunction makeRequest(requestInfo, appId, authToken, pool) {\r\n    var queryPart = makeQueryString(requestInfo.urlParams);\r\n    var url = requestInfo.url + queryPart;\r\n    var headers = Object.assign({}, requestInfo.headers);\r\n    addGmpidHeader_(headers, appId);\r\n    addAuthHeader_(headers, authToken);\r\n    addVersionHeader_(headers);\r\n    return new NetworkRequest(url, requestInfo.method, headers, requestInfo.body, requestInfo.successCodes, requestInfo.additionalRetryCodes, requestInfo.handler, requestInfo.errorHandler, requestInfo.timeout, requestInfo.progressCallback, pool);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A service that provides firebaseStorage.Reference instances.\r\n * @param opt_url gs:// url to a custom Storage Bucket\r\n *\r\n * @struct\r\n */\r\nvar Service = /** @class */ (function () {\r\n    function Service(app, authProvider, pool, url) {\r\n        this.bucket_ = null;\r\n        function maker(authWrapper, loc) {\r\n            return new Reference(authWrapper, loc);\r\n        }\r\n        this.authWrapper_ = new AuthWrapper(app, authProvider, maker, makeRequest, this, pool);\r\n        this.app_ = app;\r\n        if (url != null) {\r\n            this.bucket_ = Location.makeFromBucketSpec(url);\r\n        }\r\n        else {\r\n            var authWrapperBucket = this.authWrapper_.bucket();\r\n            if (authWrapperBucket != null) {\r\n                this.bucket_ = new Location(authWrapperBucket, '');\r\n            }\r\n        }\r\n        this.internals_ = new ServiceInternals(this);\r\n    }\r\n    /**\r\n     * Returns a firebaseStorage.Reference for the given path in the default\r\n     * bucket.\r\n     */\r\n    Service.prototype.ref = function (path) {\r\n        function validator(path) {\r\n            if (typeof path !== 'string') {\r\n                throw 'Path is not a string.';\r\n            }\r\n            if (/^[A-Za-z]+:\\/\\//.test(path)) {\r\n                throw 'Expected child path but got a URL, use refFromURL instead.';\r\n            }\r\n        }\r\n        validate('ref', [stringSpec(validator, true)], arguments);\r\n        if (this.bucket_ == null) {\r\n            throw new Error('No Storage Bucket defined in Firebase Options.');\r\n        }\r\n        var ref = new Reference(this.authWrapper_, this.bucket_);\r\n        if (path != null) {\r\n            return ref.child(path);\r\n        }\r\n        else {\r\n            return ref;\r\n        }\r\n    };\r\n    /**\r\n     * Returns a firebaseStorage.Reference object for the given absolute URL,\r\n     * which must be a gs:// or http[s]:// URL.\r\n     */\r\n    Service.prototype.refFromURL = function (url) {\r\n        function validator(p) {\r\n            if (typeof p !== 'string') {\r\n                throw 'Path is not a string.';\r\n            }\r\n            if (!/^[A-Za-z]+:\\/\\//.test(p)) {\r\n                throw 'Expected full URL but got a child path, use ref instead.';\r\n            }\r\n            try {\r\n                Location.makeFromUrl(p);\r\n            }\r\n            catch (e) {\r\n                throw 'Expected valid full URL but got an invalid one.';\r\n            }\r\n        }\r\n        validate('refFromURL', [stringSpec(validator, false)], arguments);\r\n        return new Reference(this.authWrapper_, url);\r\n    };\r\n    Object.defineProperty(Service.prototype, \"maxUploadRetryTime\", {\r\n        get: function () {\r\n            return this.authWrapper_.maxUploadRetryTime();\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Service.prototype.setMaxUploadRetryTime = function (time) {\r\n        validate('setMaxUploadRetryTime', [nonNegativeNumberSpec()], arguments);\r\n        this.authWrapper_.setMaxUploadRetryTime(time);\r\n    };\r\n    Service.prototype.setMaxOperationRetryTime = function (time) {\r\n        validate('setMaxOperationRetryTime', [nonNegativeNumberSpec()], arguments);\r\n        this.authWrapper_.setMaxOperationRetryTime(time);\r\n    };\r\n    Object.defineProperty(Service.prototype, \"app\", {\r\n        get: function () {\r\n            return this.app_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Service.prototype, \"INTERNAL\", {\r\n        get: function () {\r\n            return this.internals_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return Service;\r\n}());\r\n/**\r\n * @struct\r\n */\r\nvar ServiceInternals = /** @class */ (function () {\r\n    function ServiceInternals(service) {\r\n        this.service_ = service;\r\n    }\r\n    /**\r\n     * Called when the associated app is deleted.\r\n     * @see {!fbs.AuthWrapper.prototype.deleteApp}\r\n     */\r\n    ServiceInternals.prototype.delete = function () {\r\n        this.service_.authWrapper_.deleteApp();\r\n        return Promise.resolve();\r\n    };\r\n    return ServiceInternals;\r\n}());\n\nvar name = \"@firebase/storage\";\nvar version = \"0.3.39\";\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Type constant for Firebase Storage.\r\n */\r\nvar STORAGE_TYPE = 'storage';\r\nfunction factory(container, url) {\r\n    // Dependencies\r\n    var app = container.getProvider('app').getImmediate();\r\n    var authProvider = container.getProvider('auth-internal');\r\n    return new Service(app, authProvider, new XhrIoPool(), url);\r\n}\r\nfunction registerStorage(instance) {\r\n    var namespaceExports = {\r\n        // no-inline\r\n        TaskState: TaskState,\r\n        TaskEvent: TaskEvent,\r\n        StringFormat: StringFormat,\r\n        Storage: Service,\r\n        Reference: Reference\r\n    };\r\n    instance.INTERNAL.registerComponent(new Component(STORAGE_TYPE, factory, \"PUBLIC\" /* PUBLIC */)\r\n        .setServiceProps(namespaceExports)\r\n        .setMultipleInstances(true));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterStorage(firebase);\n\nexport { registerStorage };\n//# sourceMappingURL=index.esm.js.map\n","import '@firebase/storage';\n//# sourceMappingURL=index.esm.js.map\n"]}