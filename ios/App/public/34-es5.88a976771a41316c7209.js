function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{hg08:function(t,e,n){"use strict";n.r(e),n.d(e,"ChatPageModule",(function(){return U}));var i=n("ofXK"),s=n("3Pt+"),c=n("TEn/"),o=n("tyNb"),r=n("mrSG"),a=n("XNiG"),l=n("wd/R"),u=n("fXoL"),f=n("I/3d"),d=n("H+bZ"),g=n("b6Qw"),h=["scrollMe"],b=["scrollMe2"];function p(t,e){if(1&t&&(u.Wb(0,"h6",21),u.Jc(1),u.Vb()),2&t){var n=u.ic().$implicit,i=u.ic();u.Db(1),u.Kc(i.dataUsers[n.receptor].name||"")}}function m(t,e){if(1&t&&(u.Wb(0,"span"),u.Jc(1),u.Vb()),2&t){var n=u.ic().$implicit,i=u.ic();u.Db(1),u.Kc(i.getNotification(n.id))}}var v=function(t){return{"bg-color7":t}};function C(t,e){if(1&t){var n=u.Xb();u.Wb(0,"div",14),u.ec("click",(function(){u.zc(n);var t=e.$implicit;return u.ic().getMessages(t.receptor)})),u.Wb(1,"div",15),u.Sb(2,"img",16),u.Vb(),u.Wb(3,"div",17),u.Hc(4,p,2,1,"h6",18),u.Hc(5,m,2,1,"span",19),u.Wb(6,"p",20),u.Jc(7),u.Vb(),u.Vb(),u.Vb()}if(2&t){var i=e.$implicit,s=u.ic();u.oc("ngClass",u.sc(5,v,i.receptor==s.currentReceptor)),u.Db(2),u.oc("src",s.dataUsers[i.receptor]&&s.dataUsers[i.receptor].imageprofile?s.dataUsers[i.receptor].imageprofile:"/assets/img/partials/user.svg",u.Bc),u.Db(2),u.oc("ngIf",s.dataUsers[i.receptor]),u.Db(1),u.oc("ngIf",0!=s.getNotification(i.id)),u.Db(2),u.Kc(s.formatDate(i.date))}}function M(t,e){if(1&t&&(u.Wb(0,"h6",21),u.Jc(1),u.Vb()),2&t){var n=u.ic().$implicit,i=u.ic(2);u.Db(1),u.Kc(i.dataUsers[n.receptor].name||"")}}function w(t,e){if(1&t&&(u.Wb(0,"span"),u.Jc(1),u.Vb()),2&t){var n=u.ic().$implicit,i=u.ic(2);u.Db(1),u.Kc(i.getNotification(n.id))}}function x(t,e){if(1&t){var n=u.Xb();u.Wb(0,"div",24),u.ec("click",(function(){u.zc(n);var t=e.$implicit;return u.ic(2).getMessages(t.receptor)})),u.Wb(1,"div",15),u.Sb(2,"img",16),u.Vb(),u.Wb(3,"div",17),u.Hc(4,M,2,1,"h6",18),u.Hc(5,w,2,1,"span",19),u.Wb(6,"p",20),u.Jc(7),u.Vb(),u.Vb(),u.Vb()}if(2&t){var i=e.$implicit,s=u.ic(2);u.oc("ngClass",u.sc(5,v,i.receptor==s.currentReceptor)),u.Db(2),u.oc("src",s.dataUsers[i.receptor]&&s.dataUsers[i.receptor].imageprofile?s.dataUsers[i.receptor].imageprofile:"/assets/img/partials/user.svg",u.Bc),u.Db(2),u.oc("ngIf",s.dataUsers[i.receptor]),u.Db(1),u.oc("ngIf",0!=s.getNotification(i.id)),u.Db(2),u.Kc(s.formatDate(i.date))}}function y(t,e){if(1&t&&(u.Wb(0,"div",22),u.Hc(1,x,8,7,"div",23),u.jc(2,"async"),u.Vb()),2&t){var n=u.ic();u.Db(1),u.oc("ngForOf",u.kc(2,1,n.chats))}}var _=function(t,e){return{"justify-content-end":t,"justify-content-start":e}},k=function(t,e){return{"bg-color1":t,"bg-color7":e}};function O(t,e){if(1&t&&(u.Wb(0,"div",25),u.Wb(1,"div",26),u.Wb(2,"div",27),u.Wb(3,"p",28),u.Jc(4),u.Vb(),u.Vb(),u.Wb(5,"div",27),u.Wb(6,"span",29),u.Jc(7),u.Vb(),u.Vb(),u.Vb(),u.Vb()),2&t){var n=e.$implicit,i=u.ic();u.oc("ngClass",u.tc(4,_,i.user.user.id==n.id,i.user.user.id!=n.id)),u.Db(1),u.oc("ngClass",u.tc(7,k,i.user.user.id==n.id,i.user.user.id!=n.id)),u.Db(3),u.Kc(n.message),u.Db(3),u.Kc(i.formatDate(n.date))}}function V(t,e){if(1&t&&(u.Wb(0,"div",25),u.Wb(1,"div",26),u.Wb(2,"div",27),u.Wb(3,"p",28),u.Jc(4),u.Vb(),u.Vb(),u.Wb(5,"div",27),u.Wb(6,"span",29),u.Jc(7),u.Vb(),u.Vb(),u.Vb(),u.Vb()),2&t){var n=e.$implicit,i=u.ic(2);u.oc("ngClass",u.tc(4,_,i.user.user.id==n.id,i.user.user.id!=n.id)),u.Db(1),u.oc("ngClass",u.tc(7,k,i.user.user.id==n.id,i.user.user.id!=n.id)),u.Db(3),u.Kc(n.message),u.Db(3),u.Kc(i.formatDate(n.date))}}function W(t,e){if(1&t){var n=u.Xb();u.Wb(0,"div",30),u.Wb(1,"div",31),u.Wb(2,"button",32),u.ec("click",(function(){return u.zc(n),u.ic().listChatActive=!0})),u.Jc(3,"VOLVER A CHATS"),u.Vb(),u.Vb(),u.Wb(4,"div",33,34),u.Hc(6,V,8,10,"div",7),u.jc(7,"async"),u.Vb(),u.Wb(8,"div",35),u.Wb(9,"div",36),u.Wb(10,"input",10),u.ec("ngModelChange",(function(t){return u.zc(n),u.ic().textMessage=t})),u.Vb(),u.Vb(),u.Wb(11,"div",37),u.Wb(12,"button",38),u.ec("keyup.enter",(function(){return u.zc(n),u.ic().sendMessage()}))("click",(function(){return u.zc(n),u.ic().sendMessage()})),u.hc(),u.Wb(13,"svg",39),u.Wb(14,"g",40),u.Sb(15,"path",41),u.Wb(16,"g",42),u.Sb(17,"path",43),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Vb()}if(2&t){var i=u.ic();u.Db(6),u.oc("ngForOf",u.kc(7,2,i.messages)),u.Db(4),u.oc("ngModel",i.textMessage)}}var P,j,D,R=[{path:"",component:(P=function(){function t(e,n,i,s,c){var o=this;_classCallCheck(this,t),this.firestore=e,this.api=n,this.cookie=i,this.router=s,this.route=c,this.dataUsers=[],this.textMessage="",this.listChatActive=!0,this.noti=[],this.eventsSubject=new a.a,this.validateSession(),this.id=this.route.snapshot.paramMap.get("id")?this.route.snapshot.paramMap.get("id"):"0",e.collection("chatnotification_"+this.user.user.id).valueChanges().subscribe((function(t){o.api.c("Notifications",t),o.noti=t})),this.chats=e.collection("chatlist_"+this.user.user.id,(function(t){return t.orderBy("date","desc")})).valueChanges(),this.chats.forEach((function(t){o.api.c("Chats",t),t.forEach((function(t){o.api.c("Chats item ",t),o.getNameReceptop(t.receptor)}))})),l.locale("es")}return _createClass(t,[{key:"invertChatid",value:function(t){var e=t.split("_");return e[0]+"_"+e[2]+"_"+e[1]}},{key:"getNotification",value:function(t){for(var e=0,n=0;n<this.noti.length;n++)this.noti[n].id==this.invertChatid(t)&&e++;return e}},{key:"ngAfterViewInit",value:function(){this.scrollContainer=!!this.scrollMe&&this.scrollMe.nativeElement,this.scrollContainer2=!!this.scrollMe2&&this.scrollMe2.nativeElement}},{key:"ngOnInit",value:function(){var t=this;0!=this.id&&setTimeout((function(){t.getMessages(t.id)}),2e3)}},{key:"validateSession",value:function(){localStorage.getItem("ud")&&""!=localStorage.getItem("ud")?(this.user=JSON.parse(localStorage.getItem("ud")),this.api.c("user",this.user)):this.router.navigate(["/login"])}},{key:"formatDate",value:function(t){return l(t.toDate()).calendar()}},{key:"getNameReceptop",value:function(t){var e=this;this.api.api({service:"get-data-user-by-id",token:this.user.token,userid:t}).subscribe((function(n){e.api.c("getNameReceptop",n),e.dataUsers[t]=n,e.dataUsers=e.dataUsers,e.api.c("dataUsers",e.dataUsers)}),(function(t){e.api.c("getProducts error",t)}))}},{key:"getMessages",value:function(t){return Object(r.__awaiter)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,s,c,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this,this.listChatActive=!1,i="chat_"+this.user.user.id+"_"+t,s="chat_"+t+"_"+this.user.user.id,c="chatnotification_"+this.user.user.id,this.firestore.collection(i).get().subscribe((function(e){return Object(r.__awaiter)(o,void 0,void 0,regeneratorRuntime.mark((function o(){var a=this;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:this.firestore.collection(c).get().subscribe((function(e){e.docs.forEach((function(e){return Object(r.__awaiter)(a,void 0,void 0,regeneratorRuntime.mark((function n(){var i=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.firestore.collection(c).doc(e.id).get().subscribe((function(e){return Object(r.__awaiter)(i,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e.data().id=="chat_"+t+"_"+this.user.user.id,!n.t0){n.next=4;break}return n.next=4,this.firestore.collection(c).doc(e.id).delete();case 4:case"end":return n.stop()}}),n,this)})))}));case 1:case"end":return n.stop()}}),n,this)})))}))})),this.messages=0!=e.size?this.firestore.collection(i,(function(t){return t.orderBy("date")})).valueChanges():this.firestore.collection(s,(function(t){return t.orderBy("date")})).valueChanges(),this.messages.subscribe((function(t){setTimeout((function(){n.scrollToBottom()}),2e3)}));case 1:case"end":return o.stop()}}),o,this)})))})),this.currentReceptor=t;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"sendMessage",value:function(){this.api.sendMessage({message:this.textMessage,useridOri:this.user.user.id,useridDes:this.currentReceptor}),this.textMessage="",this.scrollToBottom()}},{key:"scrollToBottom",value:function(){this.scrollContainer=!!this.scrollMe&&this.scrollMe.nativeElement,this.scrollContainer2=!!this.scrollMe2&&this.scrollMe2.nativeElement,this.scrollContainer&&this.scrollContainer.scroll({top:this.scrollContainer.scrollHeight,left:0,behavior:"smooth"}),this.scrollContainer2&&this.scrollContainer2.scroll({top:this.scrollContainer2.scrollHeight,left:0,behavior:"smooth"})}}]),t}(),P.\u0275fac=function(t){return new(t||P)(u.Rb(f.a),u.Rb(d.a),u.Rb(g.a),u.Rb(o.j),u.Rb(o.a))},P.\u0275cmp=u.Lb({type:P,selectors:[["app-chat"]],viewQuery:function(t,e){var n;1&t&&(u.Oc(h,!0),u.Oc(b,!0)),2&t&&(u.vc(n=u.fc())&&(e.scrollMe=n.first),u.vc(n=u.fc())&&(e.scrollMe2=n.first))},decls:18,vars:9,consts:[[1,"row","m-0","justify-content-center","align-items-start","vw-100"],[1,"d-none","d-xl-flex","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","align-items-start"],["class","itemChatList cursor  rounded p-2 pl-3 pr-3 mt-3 row m-0 justify-content-center align-items-center",3,"ngClass","click",4,"ngFor","ngForOf"],["class","d-flex d-xl-none chats bg-color2 pl-3 pr-3 overflow-auto pb-3 col-12 align-items-start flex-column justify-content-start",4,"ngIf"],[1,"d-none","d-xl-flex","messages","flex-1","overflow-hidden","flex-column","align-items-center","justify-content-between"],[1,"display-chat","overflow-auto","w-100","align-items-center"],["scrollMe",""],["class","row m-0 col-12 mt-3 mb-3",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-chat","col-12","row","m-0","justify-content-center"],[1,"col-10","mt-3"],["type","text",1,"pl-4","col-12","rounded-pill","shadow-lg",3,"ngModel","ngModelChange"],[1,"flex-1","mt-3"],[1,"btn1","rounded-pill",3,"keyup.enter","click"],["class","d-flex d-xl-none messages flex-1 overflow-hidden d-flex flex-column align-items-center justify-content-between",4,"ngIf"],[1,"itemChatList","cursor","rounded","p-2","pl-3","pr-3","mt-3","row","m-0","justify-content-center","align-items-center",3,"ngClass","click"],[1,"col-2","row","m-0","justify-content-center","align-items-center"],["width","40","alt","",3,"src"],[1,"chatlistitem","flex-1","pl-3"],["class","f-11 font-700",4,"ngIf"],[4,"ngIf"],[1,"f-10","p-0","m-0"],[1,"f-11","font-700"],[1,"d-flex","d-xl-none","chats","bg-color2","pl-3","pr-3","overflow-auto","pb-3","col-12","align-items-start","flex-column","justify-content-start"],["class","w-100 itemChatList cursor  rounded p-2 pl-3 pr-3 mt-3 row m-0 justify-content-center align-items-center",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"w-100","itemChatList","cursor","rounded","p-2","pl-3","pr-3","mt-3","row","m-0","justify-content-center","align-items-center",3,"ngClass","click"],[1,"row","m-0","col-12","mt-3","mb-3",3,"ngClass"],[1,"parraf","p-2","pr-3","pl-3","rounded","shadow",3,"ngClass"],[1,"row","justify-content-end","m-0"],[1,"f-11"],[1,"f-10"],[1,"d-flex","d-xl-none","messages","flex-1","overflow-hidden","d-flex","flex-column","align-items-center","justify-content-between"],[1,"col-12","bg-color2","row","m-0","justify-content-center","p-4"],[1,"btn2","pt-2","pb-2","pl-5","pr-5","f-17","font-900",3,"click"],[1,"display-chat2","overflow-auto","w-100","align-items-center"],["scrollMe2",""],[1,"input-chat2","col-12","row","m-0","justify-content-center"],[1,"flex-1","mt-3","p-0"],[1,"mt-3","p-0"],[1,"btnSend","bg-color2","pl-2","pr-2","rounded-pill","row","m-0","justify-content-center","align-items-center","border-0","ml-2",3,"keyup.enter","click"],["xmlns","http://www.w3.org/2000/svg","x","0px","y","0px","width","30","height","30","viewBox","0 0 172 172",2,"fill","#000000"],["fill","none","fill-rule","nonzero","stroke","none","stroke-width","1","stroke-linecap","butt","stroke-linejoin","miter","stroke-miterlimit","10","stroke-dasharray","","stroke-dashoffset","0","font-family","none","font-weight","none","font-size","none","text-anchor","none",2,"mix-blend-mode","normal"],["d","M0,172v-172h172v172z","fill","none"],["fill","#ffffff"],["d","M149.06667,17.2c-0.55025,0.00377 -1.09709,0.08674 -1.6237,0.24635c-0.15501,0.04207 -0.30818,0.09064 -0.45911,0.14557l-126.05495,40.08854v0.02239c-2.23962,0.83573 -3.72568,2.97333 -3.72891,5.3638c0.00425,2.00222 1.05271,3.85719 2.76589,4.89349l38.30807,30.39114l75.73151,-60.35677l-60.35677,75.73151l30.36875,38.28567c1.0349,1.7286 2.90117,2.78714 4.91589,2.78828c2.39047,-0.00322 4.52807,-1.48928 5.3638,-3.72891h0.02239l40.12214,-126.16692c0.041,-0.11449 0.07834,-0.23027 0.11198,-0.34714c0.15961,-0.52661 0.24258,-1.07345 0.24636,-1.6237c0,-3.16643 -2.5669,-5.73333 -5.73333,-5.73333z"]],template:function(t,e){1&t&&(u.Wb(0,"ion-content"),u.Wb(1,"div",0),u.Wb(2,"div",1),u.Hc(3,C,8,7,"div",2),u.jc(4,"async"),u.Vb(),u.Hc(5,y,3,3,"div",3),u.Wb(6,"div",4),u.Wb(7,"div",5,6),u.Hc(9,O,8,10,"div",7),u.jc(10,"async"),u.Vb(),u.Wb(11,"div",8),u.Wb(12,"div",9),u.Wb(13,"input",10),u.ec("ngModelChange",(function(t){return e.textMessage=t})),u.Vb(),u.Vb(),u.Wb(14,"div",11),u.Wb(15,"button",12),u.ec("keyup.enter",(function(){return e.sendMessage()}))("click",(function(){return e.sendMessage()})),u.Jc(16,"Enviar"),u.Vb(),u.Vb(),u.Vb(),u.Vb(),u.Hc(17,W,18,4,"div",13),u.Vb(),u.Vb()),2&t&&(u.Db(3),u.oc("ngForOf",u.kc(4,5,e.chats)),u.Db(2),u.oc("ngIf",e.listChatActive),u.Db(4),u.oc("ngForOf",u.kc(10,7,e.messages)),u.Db(4),u.oc("ngModel",e.textMessage),u.Db(4),u.oc("ngIf",!e.listChatActive))},directives:[c.d,i.k,i.l,s.b,s.f,s.g,i.j],pipes:[i.b],styles:['.chats[_ngcontent-%COMP%]{height:93.5vh}.itemChatList[_ngcontent-%COMP%]{background-color:#fff}.bg-color7[_ngcontent-%COMP%]{background-color:#d1d1d1!important}.messages[_ngcontent-%COMP%]{position:relative}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]{min-height:80vh;max-height:80vh}.messages[_ngcontent-%COMP%]   .display-chat[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]{min-height:84vh;max-height:84vh;padding-bottom:120px}.messages[_ngcontent-%COMP%]   .display-chat2[_ngcontent-%COMP%]   .parraf[_ngcontent-%COMP%]{max-width:90%}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]{min-height:15vh}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat[_ngcontent-%COMP%]   .btn1[_ngcontent-%COMP%]{min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]{position:absolute;bottom:4em}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:2px solid #ffe266;min-height:50px}.messages[_ngcontent-%COMP%]   .input-chat2[_ngcontent-%COMP%]   .btnSend[_ngcontent-%COMP%]{min-height:50px;min-width:50px;max-width:50px}.listItem[_ngcontent-%COMP%]{background-color:"gray"!important}.chatlistitem[_ngcontent-%COMP%]{position:relative}.chatlistitem[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;min-width:18px;max-width:18px;min-height:18px;max-height:18px;background-color:red;color:#fff;z-index:2;top:0;right:0;border-radius:50%;display:flex;justify-content:center;align-items:center}']}),P)}],I=((D=function t(){_classCallCheck(this,t)}).\u0275mod=u.Pb({type:D}),D.\u0275inj=u.Ob({factory:function(t){return new(t||D)},imports:[[o.l.forChild(R)],o.l]}),D),U=((j=function t(){_classCallCheck(this,t)}).\u0275mod=u.Pb({type:j}),j.\u0275inj=u.Ob({factory:function(t){return new(t||j)},imports:[[i.c,s.c,c.o,I]]}),j)}}]);